<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Loading Data and Documentation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="Lab1_Exploratory_Data_Analysis_files/libs/clipboard/clipboard.min.js"></script>
<script src="Lab1_Exploratory_Data_Analysis_files/libs/quarto-html/quarto.js"></script>
<script src="Lab1_Exploratory_Data_Analysis_files/libs/quarto-html/popper.min.js"></script>
<script src="Lab1_Exploratory_Data_Analysis_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Lab1_Exploratory_Data_Analysis_files/libs/quarto-html/anchor.min.js"></script>
<link href="Lab1_Exploratory_Data_Analysis_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Lab1_Exploratory_Data_Analysis_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Lab1_Exploratory_Data_Analysis_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Lab1_Exploratory_Data_Analysis_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Lab1_Exploratory_Data_Analysis_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Loading Data and Documentation</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div id="ef44a1bc" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-02-20T20:02:29.369251Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-02-20T20:02:29.368813Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-02-20T20:02:29.583179Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-02-20T20:02:29.582508Z&quot;}" data-execution_count="5">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> display</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="load-data" class="level3">
<h3 class="anchored" data-anchor-id="load-data">Load Data</h3>
<div id="bb646bc7-bf1f-48e4-855c-61d0dadabe47" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-02-20T20:02:29.585744Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-02-20T20:02:29.585523Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-02-20T20:02:29.852518Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-02-20T20:02:29.851981Z&quot;}" data-execution_count="6">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the data into a DataFrame</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>data_file_path <span class="op">=</span> <span class="st">"../data/TBI PUD 10-08-2013.csv"</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>df_data <span class="op">=</span> pd.read_csv(data_file_path)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>df_original <span class="op">=</span> df_data</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>df_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">PatNum</th>
<th data-quarto-table-cell-role="th">EmplType</th>
<th data-quarto-table-cell-role="th">Certification</th>
<th data-quarto-table-cell-role="th">InjuryMech</th>
<th data-quarto-table-cell-role="th">High_impact_InjSev</th>
<th data-quarto-table-cell-role="th">Amnesia_verb</th>
<th data-quarto-table-cell-role="th">LOCSeparate</th>
<th data-quarto-table-cell-role="th">LocLen</th>
<th data-quarto-table-cell-role="th">Seiz</th>
<th data-quarto-table-cell-role="th">SeizOccur</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">Finding20</th>
<th data-quarto-table-cell-role="th">Finding21</th>
<th data-quarto-table-cell-role="th">Finding22</th>
<th data-quarto-table-cell-role="th">Finding23</th>
<th data-quarto-table-cell-role="th">DeathTBI</th>
<th data-quarto-table-cell-role="th">HospHead</th>
<th data-quarto-table-cell-role="th">HospHeadPosCT</th>
<th data-quarto-table-cell-role="th">Intub24Head</th>
<th data-quarto-table-cell-role="th">Neurosurgery</th>
<th data-quarto-table-cell-role="th">PosIntFinal</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>3.0</td>
<td>3</td>
<td>11.0</td>
<td>2.0</td>
<td>0.0</td>
<td>0.0</td>
<td>92.0</td>
<td>0.0</td>
<td>92.0</td>
<td>...</td>
<td>92</td>
<td>92</td>
<td>92</td>
<td>92</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2</td>
<td>5.0</td>
<td>3</td>
<td>8.0</td>
<td>2.0</td>
<td>0.0</td>
<td>0.0</td>
<td>92.0</td>
<td>0.0</td>
<td>92.0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3</td>
<td>5.0</td>
<td>3</td>
<td>5.0</td>
<td>2.0</td>
<td>NaN</td>
<td>NaN</td>
<td>92.0</td>
<td>NaN</td>
<td>92.0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>1.0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>4</td>
<td>5.0</td>
<td>3</td>
<td>6.0</td>
<td>1.0</td>
<td>91.0</td>
<td>0.0</td>
<td>92.0</td>
<td>0.0</td>
<td>92.0</td>
<td>...</td>
<td>92</td>
<td>92</td>
<td>92</td>
<td>92</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>5</td>
<td>3.0</td>
<td>3</td>
<td>12.0</td>
<td>2.0</td>
<td>91.0</td>
<td>0.0</td>
<td>92.0</td>
<td>0.0</td>
<td>92.0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43394</td>
<td>43395</td>
<td>5.0</td>
<td>3</td>
<td>8.0</td>
<td>2.0</td>
<td>0.0</td>
<td>0.0</td>
<td>92.0</td>
<td>0.0</td>
<td>92.0</td>
<td>...</td>
<td>92</td>
<td>92</td>
<td>92</td>
<td>92</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43395</td>
<td>43396</td>
<td>5.0</td>
<td>3</td>
<td>6.0</td>
<td>1.0</td>
<td>91.0</td>
<td>0.0</td>
<td>92.0</td>
<td>0.0</td>
<td>92.0</td>
<td>...</td>
<td>92</td>
<td>92</td>
<td>92</td>
<td>92</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43396</td>
<td>43397</td>
<td>5.0</td>
<td>3</td>
<td>7.0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>92.0</td>
<td>0.0</td>
<td>92.0</td>
<td>...</td>
<td>92</td>
<td>92</td>
<td>92</td>
<td>92</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43397</td>
<td>43398</td>
<td>5.0</td>
<td>1</td>
<td>8.0</td>
<td>2.0</td>
<td>0.0</td>
<td>0.0</td>
<td>92.0</td>
<td>0.0</td>
<td>92.0</td>
<td>...</td>
<td>92</td>
<td>92</td>
<td>92</td>
<td>92</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43398</td>
<td>43399</td>
<td>5.0</td>
<td>90</td>
<td>8.0</td>
<td>3.0</td>
<td>0.0</td>
<td>0.0</td>
<td>92.0</td>
<td>0.0</td>
<td>92.0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
</tbody>
</table>

<p>43399 rows × 125 columns</p>
</div>
</div>
</div>
</section>
<section id="load-documentation" class="level3">
<h3 class="anchored" data-anchor-id="load-documentation">Load Documentation</h3>
<div id="87197fa6-2d3a-4dab-8a71-cba888091f57" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-02-20T20:02:29.854563Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-02-20T20:02:29.854277Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-02-20T20:02:29.954482Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-02-20T20:02:29.953904Z&quot;}" data-execution_count="7">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Documentation</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>documentation_file_path <span class="op">=</span> <span class="st">"../data/TBI PUD Documentation 10-08-2013.xlsx"</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>df_doc <span class="op">=</span> pd.read_excel(documentation_file_path)[<span class="dv">9</span>:]</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the first row as column headers</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>df_doc.columns <span class="op">=</span> df_doc.iloc[<span class="dv">0</span>]  <span class="co"># Assign the first row as column names</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>df_doc <span class="op">=</span> df_doc[<span class="dv">1</span>:].reset_index(drop<span class="op">=</span><span class="va">True</span>)  <span class="co"># Remove the first row and reset index</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>df_doc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">9</th>
<th data-quarto-table-cell-role="th">Variable Name</th>
<th data-quarto-table-cell-role="th">Label/Description</th>
<th data-quarto-table-cell-role="th">Format Name and Values</th>
<th data-quarto-table-cell-role="th">Notes</th>
<th data-quarto-table-cell-role="th">NaN</th>
<th data-quarto-table-cell-role="th">NaN</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>PatNum</td>
<td>Patient Number</td>
<td>Numeric</td>
<td>A randomly generated number that uniquely iden...</td>
<td>x</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>EmplType</td>
<td>Position of physician completing data sheet</td>
<td>EmplType\n1 Nurse Practitioner\n2 Physic...</td>
<td>An attending or fellow physician reviewed all ...</td>
<td>x</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Certification</td>
<td>Certification of physician completing the form</td>
<td>CertType\n1 Emergency Medicine\n2 Pediatri...</td>
<td>NaN</td>
<td>x</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>InjuryMech</td>
<td>Injury mechanism</td>
<td>InjMech\n1 Occupant in motor vehicle \n ...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>High_impact_InjSev</td>
<td>Severity of injury mechanism</td>
<td>InjSev\n1 Low\n2 Moderate\n3 High</td>
<td>Injury Severity based on the injury mechanism ...</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">120</td>
<td>HospHead</td>
<td>Hospitalized for 2 or more nights due to head ...</td>
<td>YesNo\n0 No\n1 Yes</td>
<td>NaN</td>
<td>x</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">121</td>
<td>HospHeadPosCT</td>
<td>Hospitalized for 2 or more nights due to head ...</td>
<td>YesNo\n0 No\n1 Yes</td>
<td>The hospitalization had to be due to the traum...</td>
<td>RES</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">122</td>
<td>Intub24Head</td>
<td>Intubated greater than 24 hours for head trauma</td>
<td>YesNo\n0 No\n1 Yes</td>
<td>NaN</td>
<td>RES</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">123</td>
<td>Neurosurgery</td>
<td>Neurosurgery</td>
<td>YesNo\n0 No\n1 Yes</td>
<td>NaN</td>
<td>RES</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">124</td>
<td>PosIntFinal</td>
<td>Clinically-important traumatic brain injury</td>
<td>YesNo\n0 No\n1 Yes</td>
<td>Clinically-important TBI was defined as having...</td>
<td>MAIN RES</td>
<td>NaN</td>
</tr>
</tbody>
</table>

<p>125 rows × 6 columns</p>
</div>
</div>
</div>
</section>
<section id="let-us-inspect-and-clean-each-data-item-of-interest-individually" class="level1">
<h1>Let us inspect and clean each data item of interest individually</h1>
<div id="1965613d-ec9f-4afb-abde-edbed9630cdc" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-02-20T20:02:29.956762Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-02-20T20:02:29.956450Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-02-20T20:02:29.962036Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-02-20T20:02:29.961444Z&quot;}" data-execution_count="8">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_variable_info(variable_name, df_data, df_doc<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Given a variable name (column title from df_data), this function returns:</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co">    - The full column from df_data as a DataFrame.</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">    - The corresponding row from df_doc where 'Variable Name' matches, also as a DataFrame.</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters:</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co">        variable_name (str): The name of the variable (column title from df_data).</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co">        df_data (pd.DataFrame): The main dataset.</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co">        df_doc (pd.DataFrame): The documentation dataset. If None, will just return column.</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co">    Displays:</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co">    - Data column for format and variable</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co">    - Data information and notes</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="co">    - The full column from df_data</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> variable_name <span class="kw">not</span> <span class="kw">in</span> df_data.columns:</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"'</span><span class="sc">{</span>variable_name<span class="sc">}</span><span class="ss">' not found in df_data columns."</span>)</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the full column and format it as a DataFrame</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>    column_data <span class="op">=</span> pd.DataFrame(df_data[variable_name])</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find the corresponding row in df_doc</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(df_doc <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>):</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>        doc_row <span class="op">=</span> df_doc[df_doc[<span class="st">"Variable Name"</span>] <span class="op">==</span> variable_name]</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Display both DataFrames</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Data Column for '</span><span class="sc">{</span>variable_name<span class="sc">}</span><span class="ss">':"</span>)</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>    display(column_data)</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Documentation Row for '</span><span class="sc">{</span>variable_name<span class="sc">}</span><span class="ss">':"</span>)</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(df_doc <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>):</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>        display(doc_row)</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(df_doc <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>):</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Extract the 'Notes' column if it exists</span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>        notes_value <span class="op">=</span> doc_row[<span class="st">"Notes"</span>].values[<span class="dv">0</span>] <span class="cf">if</span> <span class="st">"Notes"</span> <span class="kw">in</span> df_doc.columns <span class="kw">and</span> <span class="kw">not</span> doc_row.empty <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Extract the 'Label/Description' column if it exists</span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>        desc_value <span class="op">=</span> doc_row[<span class="st">"Label/Description"</span>].values[<span class="dv">0</span>] <span class="cf">if</span> <span class="st">"Label/Description"</span> <span class="kw">in</span> df_doc.columns <span class="kw">and</span> <span class="kw">not</span> doc_row.empty <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Extract the 'Format Name and Values' column if it exists</span></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>        format_value <span class="op">=</span> doc_row[<span class="st">"Format Name and Values"</span>].values[<span class="dv">0</span>] <span class="cf">if</span> <span class="st">"Format Name and Values"</span> <span class="kw">in</span> df_doc.columns <span class="kw">and</span> <span class="kw">not</span> doc_row.empty <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Returned Notes:"</span>)</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(notes_value)</span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Returned Label/Description:"</span>)</span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(desc_value)</span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Returned Format Name and Values:"</span>)</span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(format_value)</span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df_data[variable_name]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="94bb7125" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-02-20T20:02:29.964371Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-02-20T20:02:29.963948Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-02-20T20:02:29.967722Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-02-20T20:02:29.966842Z&quot;}" data-execution_count="9">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_frequency_table(data_column):</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Given a Pandas Series (data column), this function returns a frequency table, </span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">    including NaN values.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters:</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co">        data_column (pd.Series): A column from a DataFrame.</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co">        pd.DataFrame: A frequency table with unique values and their counts.</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(data_column, pd.Series):</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">TypeError</span>(<span class="st">"Input must be a Pandas Series (a single column from a DataFrame)."</span>)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute frequency table including NaN values</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    freq_table <span class="op">=</span> data_column.value_counts(dropna<span class="op">=</span><span class="va">False</span>).reset_index()</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    freq_table.columns <span class="op">=</span> [<span class="st">"Value"</span>, <span class="st">"Frequency"</span>]  <span class="co"># Rename columns</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> freq_table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="96bec40e" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-02-20T20:02:29.970207Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-02-20T20:02:29.969823Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-02-20T20:02:29.974068Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-02-20T20:02:29.973491Z&quot;}" data-execution_count="10">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> list_column_data_types(df):</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Lists the unique data types present in each column of a DataFrame.</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co">        df (pd.DataFrame): The input DataFrame.</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co">        pd.DataFrame: A DataFrame with columns ['Column', 'Data_Types'].</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    column_types <span class="op">=</span> []</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> column <span class="kw">in</span> df.columns:</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>        unique_types <span class="op">=</span> <span class="bu">set</span>(df[column].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="bu">type</span>(x).<span class="va">__name__</span> <span class="cf">if</span> pd.notna(x) <span class="cf">else</span> <span class="st">'NaN'</span>))</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>        column_types.append({<span class="st">'Column'</span>: column, <span class="st">'Data_Types'</span>: <span class="st">', '</span>.join(unique_types)})</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.DataFrame(column_types)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="testing-functions-and-exploring-data-types" class="level1">
<h1>Testing Functions and Exploring Data Types</h1>
<p>Here we are just testing some of our useful functions to help in EDA and to create a list of datatypes. The datatypes provided are a little non-descriptive. “Numeric” could mean int or float, for example.</p>
<div id="ed6c5a27" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-02-20T20:02:29.976658Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-02-20T20:02:29.976343Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-02-20T20:02:32.496283Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-02-20T20:02:32.495684Z&quot;}" data-execution_count="11">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>column_data_types_df <span class="op">=</span> list_column_data_types(df_data)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Store default settings before making changes</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>default_max_rows <span class="op">=</span> pd.get_option(<span class="st">'display.max_rows'</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>default_max_columns <span class="op">=</span> pd.get_option(<span class="st">'display.max_columns'</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>default_max_colwidth <span class="op">=</span> pd.get_option(<span class="st">'display.max_colwidth'</span>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Set display options to show all rows, columns, and full column width</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.max_rows'</span>, <span class="va">None</span>)      <span class="co"># Show all rows</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.max_columns'</span>, <span class="va">None</span>)   <span class="co"># Show all columns</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.max_colwidth'</span>, <span class="va">None</span>)  <span class="co"># Show full column contents</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the DataFrame</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>display(column_data_types_df)</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Reset settings back to their original values</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.max_rows'</span>, default_max_rows)</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.max_columns'</span>, default_max_columns)</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.max_colwidth'</span>, default_max_colwidth)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Column</th>
<th data-quarto-table-cell-role="th">Data_Types</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>PatNum</td>
<td>int</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>EmplType</td>
<td>NaN, float</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Certification</td>
<td>int</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>InjuryMech</td>
<td>NaN, float</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>High_impact_InjSev</td>
<td>NaN, float</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>Amnesia_verb</td>
<td>NaN, float</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>LOCSeparate</td>
<td>NaN, float</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>LocLen</td>
<td>NaN, float</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>Seiz</td>
<td>NaN, float</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>SeizOccur</td>
<td>NaN, float</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>SeizLen</td>
<td>NaN, float</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>ActNorm</td>
<td>NaN, float</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>HA_verb</td>
<td>NaN, float</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>HASeverity</td>
<td>NaN, float</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>HAStart</td>
<td>NaN, float</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>Vomit</td>
<td>NaN, float</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>VomitNbr</td>
<td>NaN, float</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>VomitStart</td>
<td>NaN, float</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>VomitLast</td>
<td>NaN, float</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">19</td>
<td>Dizzy</td>
<td>NaN, float</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20</td>
<td>Intubated</td>
<td>NaN, float</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">21</td>
<td>Paralyzed</td>
<td>NaN, float</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">22</td>
<td>Sedated</td>
<td>NaN, float</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">23</td>
<td>GCSEye</td>
<td>NaN, float</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">24</td>
<td>GCSVerbal</td>
<td>NaN, float</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">25</td>
<td>GCSMotor</td>
<td>NaN, float</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">26</td>
<td>GCSTotal</td>
<td>int</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">27</td>
<td>GCSGroup</td>
<td>int</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">28</td>
<td>AMS</td>
<td>NaN, float</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">29</td>
<td>AMSAgitated</td>
<td>int</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">30</td>
<td>AMSSleep</td>
<td>int</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">31</td>
<td>AMSSlow</td>
<td>int</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">32</td>
<td>AMSRepeat</td>
<td>int</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">33</td>
<td>AMSOth</td>
<td>int</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">34</td>
<td>SFxPalp</td>
<td>NaN, float</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">35</td>
<td>SFxPalpDepress</td>
<td>NaN, float</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">36</td>
<td>FontBulg</td>
<td>NaN, float</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">37</td>
<td>SFxBas</td>
<td>NaN, float</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">38</td>
<td>SFxBasHem</td>
<td>int</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">39</td>
<td>SFxBasOto</td>
<td>int</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">40</td>
<td>SFxBasPer</td>
<td>int</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">41</td>
<td>SFxBasRet</td>
<td>int</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">42</td>
<td>SFxBasRhi</td>
<td>int</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43</td>
<td>Hema</td>
<td>NaN, float</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">44</td>
<td>HemaLoc</td>
<td>NaN, float</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">45</td>
<td>HemaSize</td>
<td>NaN, float</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">46</td>
<td>Clav</td>
<td>NaN, float</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">47</td>
<td>ClavFace</td>
<td>int</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">48</td>
<td>ClavNeck</td>
<td>int</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">49</td>
<td>ClavFro</td>
<td>int</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">50</td>
<td>ClavOcc</td>
<td>int</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">51</td>
<td>ClavPar</td>
<td>int</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">52</td>
<td>ClavTem</td>
<td>int</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">53</td>
<td>NeuroD</td>
<td>NaN, float</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">54</td>
<td>NeuroDMotor</td>
<td>int</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">55</td>
<td>NeuroDSensory</td>
<td>int</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">56</td>
<td>NeuroDCranial</td>
<td>int</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">57</td>
<td>NeuroDReflex</td>
<td>int</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">58</td>
<td>NeuroDOth</td>
<td>int</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">59</td>
<td>OSI</td>
<td>NaN, float</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">60</td>
<td>OSIExtremity</td>
<td>int</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">61</td>
<td>OSICut</td>
<td>int</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">62</td>
<td>OSICspine</td>
<td>int</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">63</td>
<td>OSIFlank</td>
<td>int</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">64</td>
<td>OSIAbdomen</td>
<td>int</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">65</td>
<td>OSIPelvis</td>
<td>int</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">66</td>
<td>OSIOth</td>
<td>int</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">67</td>
<td>Drugs</td>
<td>NaN, float</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">68</td>
<td>CTForm1</td>
<td>NaN, float</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">69</td>
<td>IndAge</td>
<td>int</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">70</td>
<td>IndAmnesia</td>
<td>int</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">71</td>
<td>IndAMS</td>
<td>int</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">72</td>
<td>IndClinSFx</td>
<td>int</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">73</td>
<td>IndHA</td>
<td>int</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">74</td>
<td>IndHema</td>
<td>int</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">75</td>
<td>IndLOC</td>
<td>int</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">76</td>
<td>IndMech</td>
<td>int</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">77</td>
<td>IndNeuroD</td>
<td>int</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">78</td>
<td>IndRqstMD</td>
<td>int</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">79</td>
<td>IndRqstParent</td>
<td>int</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">80</td>
<td>IndRqstTrauma</td>
<td>int</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">81</td>
<td>IndSeiz</td>
<td>int</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">82</td>
<td>IndVomit</td>
<td>int</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">83</td>
<td>IndXraySFx</td>
<td>int</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">84</td>
<td>IndOth</td>
<td>int</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">85</td>
<td>CTSed</td>
<td>NaN, float</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">86</td>
<td>CTSedAgitate</td>
<td>int</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">87</td>
<td>CTSedAge</td>
<td>int</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">88</td>
<td>CTSedRqst</td>
<td>int</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">89</td>
<td>CTSedOth</td>
<td>int</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">90</td>
<td>AgeInMonth</td>
<td>int</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">91</td>
<td>AgeinYears</td>
<td>int</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">92</td>
<td>AgeTwoPlus</td>
<td>int</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">93</td>
<td>Gender</td>
<td>NaN, float</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">94</td>
<td>Ethnicity</td>
<td>NaN, float</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">95</td>
<td>Race</td>
<td>NaN, float</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">96</td>
<td>Observed</td>
<td>NaN, float</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">97</td>
<td>EDDisposition</td>
<td>NaN, float</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">98</td>
<td>CTDone</td>
<td>int</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">99</td>
<td>EDCT</td>
<td>int</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">100</td>
<td>PosCT</td>
<td>int</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">101</td>
<td>Finding1</td>
<td>int</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">102</td>
<td>Finding2</td>
<td>int</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">103</td>
<td>Finding3</td>
<td>int</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">104</td>
<td>Finding4</td>
<td>int</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">105</td>
<td>Finding5</td>
<td>int</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">106</td>
<td>Finding6</td>
<td>int</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">107</td>
<td>Finding7</td>
<td>int</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">108</td>
<td>Finding8</td>
<td>int</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">109</td>
<td>Finding9</td>
<td>int</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">110</td>
<td>Finding10</td>
<td>int</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">111</td>
<td>Finding11</td>
<td>int</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">112</td>
<td>Finding12</td>
<td>int</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">113</td>
<td>Finding13</td>
<td>int</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">114</td>
<td>Finding14</td>
<td>int</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">115</td>
<td>Finding20</td>
<td>int</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">116</td>
<td>Finding21</td>
<td>int</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">117</td>
<td>Finding22</td>
<td>int</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">118</td>
<td>Finding23</td>
<td>int</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">119</td>
<td>DeathTBI</td>
<td>NaN, float</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">120</td>
<td>HospHead</td>
<td>NaN, float</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">121</td>
<td>HospHeadPosCT</td>
<td>int</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">122</td>
<td>Intub24Head</td>
<td>NaN, float</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">123</td>
<td>Neurosurgery</td>
<td>NaN, float</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">124</td>
<td>PosIntFinal</td>
<td>NaN, float</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Pandas seems to turn ints to floats if there are NaN values. This should not be an issue, but something to keep note of.</p>
<section id="patnum" class="level3">
<h3 class="anchored" data-anchor-id="patnum">PatNum</h3>
<div id="04e2fbeb" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-02-20T20:02:32.499046Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-02-20T20:02:32.498132Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-02-20T20:02:32.511981Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-02-20T20:02:32.511238Z&quot;}" data-execution_count="12">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>variable_name <span class="op">=</span> <span class="st">"PatNum"</span> </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>column_data <span class="op">=</span> get_variable_info(variable_name, df_data, df_doc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Data Column for 'PatNum':</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">PatNum</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43394</td>
<td>43395</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43395</td>
<td>43396</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43396</td>
<td>43397</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43397</td>
<td>43398</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43398</td>
<td>43399</td>
</tr>
</tbody>
</table>

<p>43399 rows × 1 columns</p>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Documentation Row for 'PatNum':</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">9</th>
<th data-quarto-table-cell-role="th">Variable Name</th>
<th data-quarto-table-cell-role="th">Label/Description</th>
<th data-quarto-table-cell-role="th">Format Name and Values</th>
<th data-quarto-table-cell-role="th">Notes</th>
<th data-quarto-table-cell-role="th">NaN</th>
<th data-quarto-table-cell-role="th">NaN</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>PatNum</td>
<td>Patient Number</td>
<td>Numeric</td>
<td>A randomly generated number that uniquely iden...</td>
<td>x</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Returned Notes:
A randomly generated number that uniquely identifies each patient.

Returned Label/Description:
Patient Number

Returned Format Name and Values:
Numeric</code></pre>
</div>
</div>
<p><strong>PatNum</strong> is just a way to randomly mix patients and a way to index them. There is not much to inspect.</p>
</section>
<section id="empltype" class="level3">
<h3 class="anchored" data-anchor-id="empltype">EmplType</h3>
<div id="3dcb090a" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-02-20T20:02:32.514423Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-02-20T20:02:32.514142Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-02-20T20:02:32.524944Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-02-20T20:02:32.524386Z&quot;}" data-execution_count="13">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>variable_name <span class="op">=</span> <span class="st">"EmplType"</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>column_data <span class="op">=</span> get_variable_info(variable_name, df_data, df_doc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Data Column for 'EmplType':</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">EmplType</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>3.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>5.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>5.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>5.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>3.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43394</td>
<td>5.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43395</td>
<td>5.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43396</td>
<td>5.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43397</td>
<td>5.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43398</td>
<td>5.0</td>
</tr>
</tbody>
</table>

<p>43399 rows × 1 columns</p>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Documentation Row for 'EmplType':</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">9</th>
<th data-quarto-table-cell-role="th">Variable Name</th>
<th data-quarto-table-cell-role="th">Label/Description</th>
<th data-quarto-table-cell-role="th">Format Name and Values</th>
<th data-quarto-table-cell-role="th">Notes</th>
<th data-quarto-table-cell-role="th">NaN</th>
<th data-quarto-table-cell-role="th">NaN</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>EmplType</td>
<td>Position of physician completing data sheet</td>
<td>EmplType\n1 Nurse Practitioner\n2 Physic...</td>
<td>An attending or fellow physician reviewed all ...</td>
<td>x</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Returned Notes:
An attending or fellow physician reviewed all forms.

Returned Label/Description:
Position of physician completing data sheet

Returned Format Name and Values:
EmplType
1    Nurse Practitioner
2    Physician Assistant
3    Resident
4    Fellow
5    Faculty</code></pre>
</div>
</div>
<div id="81800cb2" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-02-20T20:02:32.526760Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-02-20T20:02:32.526584Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-02-20T20:02:32.533692Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-02-20T20:02:32.532979Z&quot;}" data-execution_count="14">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>get_frequency_table(column_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Value</th>
<th data-quarto-table-cell-role="th">Frequency</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>5.0</td>
<td>22216</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>3.0</td>
<td>14333</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>4.0</td>
<td>3807</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1.0</td>
<td>1974</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2.0</td>
<td>1051</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>NaN</td>
<td>18</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="exploring-more-features" class="level3">
<h3 class="anchored" data-anchor-id="exploring-more-features">Exploring more features</h3>
<p>Obviously, some of the features in this dataset are not going to help us much: a randomly assigned index number should (usually) not be a factor in a clinical decision rule. I picked out some features for us to explore further. Some of them will not be used for our primary analysis, others will be useful for us making perturbations.</p>
<p>I first looked at the variables, organized many of them, and listed which variables I would find most relevant. I then later better narrowed down them down using domain-expert advice.</p>
<p><strong>Primary Predictors</strong></p>
<ol type="1">
<li><strong>InjuryMech</strong> – Mechanism of injury<br>
</li>
<li><strong>High_impact_InjSev</strong> – Severity of injury mechanism<br>
</li>
<li><strong>LOCSeparate</strong> – History of loss of consciousness<br>
</li>
<li><strong>LocLen</strong> – Duration of loss of consciousness<br>
</li>
<li><strong>Seiz</strong> – Post-traumatic seizure<br>
</li>
<li><strong>SeizOccur</strong> – When the seizure occurred</li>
</ol>
<p><strong>Additional Useful Variables</strong></p>
<ol start="7" type="1">
<li><strong>SeizLen</strong> – Duration of the seizure<br>
</li>
<li><strong>ActNorm</strong> – Whether the patient is acting normally post-injury<br>
</li>
<li><strong>Vomit</strong> – Whether the patient has vomited<br>
</li>
<li><strong>VomitNbr</strong> – Number of vomiting episodes<br>
</li>
<li><strong>VomitStart</strong> – When vomiting began<br>
</li>
<li><strong>VomitLast</strong> – Last recorded vomiting episode</li>
</ol>
<p><strong>Glasgow Coma Scale (GCS)</strong></p>
<ol start="13" type="1">
<li><strong>GCSEye</strong> – Eye response<br>
</li>
<li><strong>GCSVerbal</strong> – Verbal response<br>
</li>
<li><strong>GCSMotor</strong> – Motor response<br>
</li>
<li><strong>GCSTotal</strong> – Total GCS score<br>
</li>
<li><strong>GCSGroup</strong> – Grouped GCS categories</li>
</ol>
<p><strong>Neurological Deficits</strong></p>
<ol start="18" type="1">
<li><strong>HemaLoc</strong> – Presence of hematoma<br>
</li>
<li><strong>NeuroD</strong> – General neurological deficit indicator<br>
</li>
<li><strong>NeuroDMotor</strong> – Motor neurological deficit<br>
</li>
<li><strong>NeuroDSensory</strong> – Sensory neurological deficit<br>
</li>
<li><strong>NeuroDCranial</strong> – Cranial nerve deficits<br>
</li>
<li><strong>NeuroDReflex</strong> – Reflex abnormalities<br>
</li>
<li><strong>NeuroDOth</strong> – Other neurological deficits</li>
</ol>
<p><strong>CT Scan Information</strong></p>
<ol start="25" type="1">
<li><strong>CTForm1</strong> – Type of CT scan performed<br>
</li>
<li><strong>CTDone</strong> – Whether a CT scan was performed<br>
</li>
<li><strong>EDCT</strong> – Whether CT was done in the emergency department<br>
</li>
<li><strong>PosCT</strong> – Whether the CT scan was positive for abnormal findings<br>
</li>
<li><strong>HospHeadPosCT</strong> – Hospitalization decision based on positive CT findings<br>
</li>
<li><strong>Neurosurgery</strong> – Whether neurosurgical intervention was required</li>
</ol>
<p><strong>Age-Related Features</strong></p>
<ol start="31" type="1">
<li><strong>IndAge</strong> – Indicator variable for age classification<br>
</li>
<li><strong>AgeInMonth</strong> – Age in months (for pediatric patients)<br>
</li>
<li><strong>AgeinYears</strong> – Age in years<br>
</li>
<li><strong>AgeTwoPlus</strong> – Whether the patient is two years or older</li>
</ol>
<p><strong>Other Important Indicators</strong></p>
<ol start="35" type="1">
<li><strong>IndLOC</strong> – Indicator for loss of consciousness<br>
</li>
<li><strong>IndNeuroD</strong> – Indicator for neurological deficits<br>
</li>
<li><strong>IndSeiz</strong> – Indicator for seizure occurrence<br>
</li>
<li><strong>IndVomit</strong> – Indicator for vomiting episodes</li>
</ol>
<p><strong>CT Sedation Information</strong></p>
<ol start="39" type="1">
<li><strong>CTSed</strong> – Whether sedation was required for CT scan<br>
</li>
<li><strong>CTSedAgitate</strong> – Agitation level during CT sedation<br>
</li>
<li><strong>CTSedAge</strong> – Age-related sedation information<br>
</li>
<li><strong>CTSedRqst</strong> – Whether sedation was requested<br>
</li>
<li><strong>CTSedOth</strong> – Other CT sedation-related details</li>
</ol>
<p>We can narrow down our list using domain-experts: which we do in the next section.</p>
</section>
<section id="variables-registered-nurse-cathy-recommended-to-look-out-for-diagnosing-tbi" class="level3">
<h3 class="anchored" data-anchor-id="variables-registered-nurse-cathy-recommended-to-look-out-for-diagnosing-tbi">Variables Registered Nurse Cathy recommended to look out for diagnosing TBI:</h3>
<ol type="1">
<li><strong>Confusion</strong><br>
</li>
<li><strong>Headache</strong><br>
</li>
<li><strong>Pupil Abnormalities</strong><br>
</li>
<li><strong>Nausea</strong><br>
</li>
<li><strong>Seizures</strong><br>
</li>
<li><strong>Vomiting</strong><br>
</li>
<li><strong>Abnormal Posturing</strong></li>
<li><strong>systolic hypertension, irregular breathing, or bradycardia</strong> (Cushing’s triad)</li>
</ol>
<p>Source: https://www.youtube.com/watch?v=e7Yl6urL7n0&amp;ab_channel=LevelUpRN</p>
<section id="variables-found-in-the-dataset" class="level5">
<h5 class="anchored" data-anchor-id="variables-found-in-the-dataset">Variables Found in the Dataset:</h5>
<p><strong>Seizures:</strong> - <strong>Seiz</strong> – Presence of a seizure<br>
- <strong>SeizOccur</strong> – When the seizure occurred<br>
- <strong>SeizLen</strong> – Duration of the seizure<br>
- <strong>IndSeiz</strong> – Indicator variable for seizure occurrence</p>
<p><strong>Vomiting &amp; Nausea:</strong> - <strong>Vomit</strong> – Whether the patient has vomited<br>
- <strong>VomitNbr</strong> – Number of vomiting episodes<br>
- <strong>VomitStart</strong> – When vomiting began<br>
- <strong>VomitLast</strong> – Last recorded vomiting episode<br>
- <strong>IndVomit</strong> – Indicator variable for vomiting occurrence</p>
<p><strong>Pupil Abnormalities &amp; Posturing:</strong> - <strong>GCSEye</strong> – Eye response in the Glasgow Coma Scale (may include pupil reaction abnormalities)</p>
</section>
<section id="variables-not-found-in-the-dataset" class="level5">
<h5 class="anchored" data-anchor-id="variables-not-found-in-the-dataset">Variables Not Found in the Dataset:</h5>
<ul>
<li>Confusion</li>
<li>Headache</li>
<li>Abnormal Posturing (Decorticate/Decerebrate posturing)</li>
<li>Cushing’s triad</li>
</ul>
<p>There are no explicit variables for confusion, headache, or abnormal posturing. If needed, we may explore text descriptions, GCS motor scores, or indirect neurological indicators to infer these conditions, but that comes with its own trade offs.</p>
</section>
</section>
<section id="critically-thinking-about-variables-for-supervision" class="level3">
<h3 class="anchored" data-anchor-id="critically-thinking-about-variables-for-supervision">Critically thinking about variables for supervision</h3>
<p>We want to see if we can create a label feature for our data or if we will favor an unsupervised analysis. We picked out contenders and ranked them in buckets.</p>
<p><strong>Seizures:</strong></p>
<p><strong>Vomiting &amp; Nausea:</strong> - <strong>VomitLast</strong> – Last recorded vomiting episode</p>
<p><strong>Pupil Abnormalities &amp; Posturing:</strong></p>
<section id="high-confidence-and-why" class="level5">
<h5 class="anchored" data-anchor-id="high-confidence-and-why"><strong>High confidence and why:</strong></h5>
<ul>
<li><strong>IndVomit</strong> – Indicator variable for vomiting occurrence</li>
</ul>
<p>There could be a lot of false non-positives because if a person did not get a procedure done, they will be marked as not having had vomited which is misleading. But we could still use this to indicate people we are extra sure have had a seizure.</p>
<ul>
<li><strong>IndSeiz</strong> – Indicator variable for seizure occurrence</li>
</ul>
<p>There could be a lot of false non-positives because if a person did not get a procedure done, they will be marked as not having had a seizure which is misleading. But we could still use this to indicate people we are extra sure have had a seizure.</p>
<ul>
<li><strong>Seiz</strong> – Presence of a post-trauma seizure</li>
</ul>
<p>Domain expert said that this is one of the symptoms to look out for. <strong>Cleaning</strong> Note that there are Nan values. We can either keep them as unknown, or we could try to predict them using other seizure features. Note also that post-trauma may or may not imply that it is from the trauma or not.</p>
<ul>
<li><strong>SeizOccur</strong> – When the seizure occurred</li>
</ul>
<p>Domain expert said that this is one of the symptoms to look out for. <strong>Cleaning</strong> Note that there are Nan values. Note that “not applicable” could also mean missing values.</p>
<ul>
<li><strong>SeizLen</strong> – Duration of the seizure</li>
</ul>
<p>Domain expert said that this is one of the symptoms to look out for. <strong>Cleaning</strong> Note that there are Nan values. Note that “not applicable” could also mean missing values.</p>
<ul>
<li><strong>VomitNbr</strong> – Number of vomiting episodes after incident</li>
</ul>
<p>Domain expert said that this is one of the symptoms to look out for. <strong>Cleaning</strong> Note that there are Nan values. Note that “not applicable” could also mean missing values.</p>
<ul>
<li><strong>VomitStart</strong> – When vomiting began</li>
</ul>
<p>Domain expert said that this is one of the symptoms to look out for. <strong>Cleaning</strong> Note that there are Nan values. Note that “not applicable” could also mean missing values.</p>
<ul>
<li><strong>GCSEye</strong> – Eye response in the Glasgow Coma Scale (may include pupil reaction abnormalities)</li>
</ul>
<p>Domain expert said that this is one of the symptoms to look out for. <strong>Cleaning</strong> Note that there are Nan values.</p>
</section>
<section id="medium-confidence-and-why" class="level5">
<h5 class="anchored" data-anchor-id="medium-confidence-and-why"><strong>Medium confidence and why:</strong></h5>
<ul>
<li><strong>Vomit</strong> – Whether the patient has vomited after the incident</li>
</ul>
<p>Seems not too useful since there could be many reasons why people would vomit. but could be useful for people who did not vomit after: converse I do not think is true. Number of vomits may be better.</p>
<ul>
<li><strong>InjuryMech</strong> – Mechanism of injury</li>
</ul>
<p>Note the frequency table we built, it seems that some of the data is labeled “other.” Moreover, you can be hit by a car at 1mph and hit by a baseball bat at 20mph so may not be the best indicator for severity. <strong>Cleaning</strong> Note that there are Nan values we can list as “other.”</p>
</section>
<section id="lower-contenders-and-why" class="level5">
<h5 class="anchored" data-anchor-id="lower-contenders-and-why"><strong>Lower-contenders and why:</strong></h5>
<ul>
<li><strong>Neurosurgery</strong> – Whether neurosurgical intervention was required</li>
</ul>
<p>Did not have any notes. Thus, it is hard for us to tell why they had Neurosurgery and/or if the brain-hit event happened before or after the surgery.</p>
<ul>
<li><strong>High_impact_InjSev</strong> – Severity of injury mechanism</li>
</ul>
<p>Seems like could just be a constructed feature from InjuryMech, meaning we may not get more insight out of this. Also this ranks being hit by a plane as “Medium” severity which seems like a bad method for ranking. Probably had a lot of multicollinearity with InjuryMech. Also, TBI does not always come from high impact events.</p>
<ul>
<li><strong>ActNorm</strong> – Whether the patient is acting normally post-injury</li>
</ul>
<p>Low contender because there are many reasons why people may act different after a health event. You could act differently from a broken arm or maybe just realizing life is short. There are no notes on this feature so I would have trouble justifying using it.</p>
<div id="3b101447" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-02-20T20:02:32.535965Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-02-20T20:02:32.535653Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-02-20T20:02:32.552483Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-02-20T20:02:32.551912Z&quot;}" data-execution_count="15">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Exploring Various variables</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>variable_name <span class="op">=</span> <span class="st">"SeizOccur"</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>column_data <span class="op">=</span> get_variable_info(variable_name, df_data, df_doc)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>get_frequency_table(column_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Data Column for 'SeizOccur':</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">SeizOccur</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>92.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>92.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>92.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>92.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>92.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43394</td>
<td>92.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43395</td>
<td>92.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43396</td>
<td>92.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43397</td>
<td>92.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43398</td>
<td>92.0</td>
</tr>
</tbody>
</table>

<p>43399 rows × 1 columns</p>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Documentation Row for 'SeizOccur':</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">9</th>
<th data-quarto-table-cell-role="th">Variable Name</th>
<th data-quarto-table-cell-role="th">Label/Description</th>
<th data-quarto-table-cell-role="th">Format Name and Values</th>
<th data-quarto-table-cell-role="th">Notes</th>
<th data-quarto-table-cell-role="th">NaN</th>
<th data-quarto-table-cell-role="th">NaN</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>SeizOccur</td>
<td>When did the post-traumatic seizure occur?</td>
<td>SeizOcc\n1 Immediately on contact\n2 Withi...</td>
<td>Not applicable is marked if post-traumatic sei...</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Returned Notes:
Not applicable is marked if post-traumatic seizure is answered as no or missing.

Returned Label/Description:
When did the post-traumatic seizure occur?

Returned Format Name and Values:
SeizOcc
1   Immediately on contact
2   Within 30 minutes of injury
3   &gt; 30 minutes after injury
92 Not applicable</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="15">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Value</th>
<th data-quarto-table-cell-role="th">Frequency</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>92.0</td>
<td>42796</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1.0</td>
<td>253</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2.0</td>
<td>210</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>NaN</td>
<td>71</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>3.0</td>
<td>69</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</section>
</section>
<section id="feature-construction" class="level1">
<h1>Feature Construction</h1>
<section id="seizures" class="level3">
<h3 class="anchored" data-anchor-id="seizures">Seizures</h3>
<p>Let us create an index for seizures, keeping in mind the context of the variables:</p>
<ul>
<li><strong>IndSeiz</strong> – Indicator variable for seizure occurrence</li>
</ul>
<p>There could be a lot of false non-positives because if a person did not get a procedure done, they will be marked as not having had a seizure which is misleading. But we could still use this to indicate people we are extra sure have had a seizure.</p>
<ul>
<li><strong>Seiz</strong> – Presence of a post-trauma seizure</li>
</ul>
<p>Domain expert said that this is one of the symptoms to look out for. <strong>Cleaning</strong> Note that there are Nan values. We can either keep them as unknown, or we could try to predict them using other seizure features. Note also that post-trauma may or may not imply that it is from the trauma or not.</p>
<ul>
<li><strong>SeizOccur</strong> – When the seizure occurred</li>
</ul>
<p>Domain expert said that this is one of the symptoms to look out for. <strong>Cleaning</strong> Note that there are Nan values. Note that “not applicable” could also mean missing values.</p>
<ul>
<li><strong>SeizLen</strong> – Duration of the seizure</li>
</ul>
<p>Domain expert said that this is one of the symptoms to look out for. <strong>Cleaning</strong> Note that there are Nan values. Note that “not applicable” could also mean missing values.</p>
</section>
<section id="seizure-feature-construction-critical-thinking" class="level3">
<h3 class="anchored" data-anchor-id="seizure-feature-construction-critical-thinking">Seizure Feature Construction Critical Thinking</h3>
<p>Let us create our own indicator function for if a patient has every had a seizure because the old one only applies for people who had a procedure done. We can use the features provided to deduce if people have ever had a seizure and if they had one after the incident or not.</p>
<div id="a21c860d" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-02-20T20:02:32.554658Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-02-20T20:02:32.554311Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-02-20T20:02:32.562697Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-02-20T20:02:32.562034Z&quot;}" data-execution_count="16">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select only the five specified columns for seiz table</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>selected_columns <span class="op">=</span> [<span class="st">"PatNum"</span>, <span class="st">"IndSeiz"</span>, <span class="st">"Seiz"</span>, <span class="st">"SeizOccur"</span>, <span class="st">"SeizLen"</span>]</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>df_seiz <span class="op">=</span> df_data[selected_columns]</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the new DataFrame</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>df_seiz</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">PatNum</th>
<th data-quarto-table-cell-role="th">IndSeiz</th>
<th data-quarto-table-cell-role="th">Seiz</th>
<th data-quarto-table-cell-role="th">SeizOccur</th>
<th data-quarto-table-cell-role="th">SeizLen</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>92</td>
<td>0.0</td>
<td>92.0</td>
<td>92.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2</td>
<td>0</td>
<td>0.0</td>
<td>92.0</td>
<td>92.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3</td>
<td>0</td>
<td>NaN</td>
<td>92.0</td>
<td>92.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>4</td>
<td>92</td>
<td>0.0</td>
<td>92.0</td>
<td>92.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>5</td>
<td>0</td>
<td>0.0</td>
<td>92.0</td>
<td>92.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43394</td>
<td>43395</td>
<td>92</td>
<td>0.0</td>
<td>92.0</td>
<td>92.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43395</td>
<td>43396</td>
<td>92</td>
<td>0.0</td>
<td>92.0</td>
<td>92.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43396</td>
<td>43397</td>
<td>92</td>
<td>0.0</td>
<td>92.0</td>
<td>92.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43397</td>
<td>43398</td>
<td>92</td>
<td>0.0</td>
<td>92.0</td>
<td>92.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43398</td>
<td>43399</td>
<td>0</td>
<td>0.0</td>
<td>92.0</td>
<td>92.0</td>
</tr>
</tbody>
</table>

<p>43399 rows × 5 columns</p>
</div>
</div>
</div>
<div id="a585beec" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-02-20T20:02:32.565200Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-02-20T20:02:32.564788Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-02-20T20:02:36.370770Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-02-20T20:02:36.370237Z&quot;}" data-execution_count="66">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize HadSeiz and HadSeizAfterEvent with NaN</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>df_data[<span class="st">"HadSeiz"</span>] <span class="op">=</span> np.nan</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>df_data[<span class="st">"HadSeizAfterEvent"</span>] <span class="op">=</span> np.nan</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to update HadSeiz and HadSeizAfterEvent based on conditions</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> update_had_seiz(row):</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="co">    Updates HadSeiz and HadSeizAfterEvent based on IndSeiz, Seiz, SeizOccur, and SeizLen.</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># --- CHECK 1: IndSeiz ---</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> pd.isna(row[<span class="st">"HadSeiz"</span>]):  </span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> row[<span class="st">"IndSeiz"</span>] <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>            row[<span class="st">"HadSeiz"</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> row[<span class="st">"IndSeiz"</span>] <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>            row[<span class="st">"HadSeiz"</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> row[<span class="st">"HadSeiz"</span>] <span class="op">==</span> <span class="dv">0</span> <span class="kw">and</span> row[<span class="st">"IndSeiz"</span>] <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>        row[<span class="st">"HadSeiz"</span>] <span class="op">=</span> <span class="st">"contradiction"</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># --- CHECK 2: Seiz ---</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> pd.isna(row[<span class="st">"HadSeiz"</span>]):</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> row[<span class="st">"Seiz"</span>] <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>            row[<span class="st">"HadSeiz"</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> row[<span class="st">"Seiz"</span>] <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>            row[<span class="st">"HadSeiz"</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> row[<span class="st">"HadSeiz"</span>] <span class="op">==</span> <span class="dv">0</span> <span class="kw">and</span> row[<span class="st">"Seiz"</span>] <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>        row[<span class="st">"HadSeiz"</span>] <span class="op">=</span> <span class="st">"contradiction"</span></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># --- CHECK 3: SeizOccur ---</span></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> pd.isna(row[<span class="st">"HadSeiz"</span>]):</span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> row[<span class="st">"SeizOccur"</span>] <span class="kw">in</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>]:</span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>            row[<span class="st">"HadSeiz"</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> row[<span class="st">"HadSeiz"</span>] <span class="op">==</span> <span class="dv">0</span> <span class="kw">and</span> row[<span class="st">"SeizOccur"</span>] <span class="kw">in</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>]:</span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>        row[<span class="st">"HadSeiz"</span>] <span class="op">=</span> <span class="st">"contradiction"</span></span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># --- CHECK 4: SeizLen ---</span></span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> pd.isna(row[<span class="st">"HadSeiz"</span>]):</span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> row[<span class="st">"SeizLen"</span>] <span class="kw">in</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>]:</span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a>            row[<span class="st">"HadSeiz"</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> row[<span class="st">"HadSeiz"</span>] <span class="op">==</span> <span class="dv">0</span> <span class="kw">and</span> row[<span class="st">"SeizLen"</span>] <span class="kw">in</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>]:</span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a>        row[<span class="st">"HadSeiz"</span>] <span class="op">=</span> <span class="st">"contradiction"</span></span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># --- APPLY SAME LOGIC TO HadSeizAfterEvent ---</span></span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> pd.isna(row[<span class="st">"HadSeizAfterEvent"</span>]):</span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> row[<span class="st">"IndSeiz"</span>] <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb22-46"><a href="#cb22-46" aria-hidden="true" tabindex="-1"></a>            row[<span class="st">"HadSeizAfterEvent"</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb22-47"><a href="#cb22-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> row[<span class="st">"IndSeiz"</span>] <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb22-48"><a href="#cb22-48" aria-hidden="true" tabindex="-1"></a>            row[<span class="st">"HadSeizAfterEvent"</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb22-49"><a href="#cb22-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> row[<span class="st">"HadSeizAfterEvent"</span>] <span class="op">==</span> <span class="dv">0</span> <span class="kw">and</span> row[<span class="st">"IndSeiz"</span>] <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb22-50"><a href="#cb22-50" aria-hidden="true" tabindex="-1"></a>        row[<span class="st">"HadSeizAfterEvent"</span>] <span class="op">=</span> <span class="st">"contradiction"</span></span>
<span id="cb22-51"><a href="#cb22-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-52"><a href="#cb22-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> pd.isna(row[<span class="st">"HadSeizAfterEvent"</span>]):</span>
<span id="cb22-53"><a href="#cb22-53" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> row[<span class="st">"Seiz"</span>] <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb22-54"><a href="#cb22-54" aria-hidden="true" tabindex="-1"></a>            row[<span class="st">"HadSeizAfterEvent"</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb22-55"><a href="#cb22-55" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> row[<span class="st">"Seiz"</span>] <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb22-56"><a href="#cb22-56" aria-hidden="true" tabindex="-1"></a>            row[<span class="st">"HadSeizAfterEvent"</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb22-57"><a href="#cb22-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> row[<span class="st">"HadSeizAfterEvent"</span>] <span class="op">==</span> <span class="dv">0</span> <span class="kw">and</span> row[<span class="st">"Seiz"</span>] <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb22-58"><a href="#cb22-58" aria-hidden="true" tabindex="-1"></a>        row[<span class="st">"HadSeizAfterEvent"</span>] <span class="op">=</span> <span class="st">"contradiction"</span></span>
<span id="cb22-59"><a href="#cb22-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-60"><a href="#cb22-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> pd.isna(row[<span class="st">"HadSeizAfterEvent"</span>]):</span>
<span id="cb22-61"><a href="#cb22-61" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> row[<span class="st">"SeizOccur"</span>] <span class="kw">in</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>]:</span>
<span id="cb22-62"><a href="#cb22-62" aria-hidden="true" tabindex="-1"></a>            row[<span class="st">"HadSeizAfterEvent"</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb22-63"><a href="#cb22-63" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> row[<span class="st">"HadSeizAfterEvent"</span>] <span class="op">==</span> <span class="dv">0</span> <span class="kw">and</span> row[<span class="st">"SeizOccur"</span>] <span class="kw">in</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>]:</span>
<span id="cb22-64"><a href="#cb22-64" aria-hidden="true" tabindex="-1"></a>        row[<span class="st">"HadSeizAfterEvent"</span>] <span class="op">=</span> <span class="st">"contradiction"</span></span>
<span id="cb22-65"><a href="#cb22-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-66"><a href="#cb22-66" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> pd.isna(row[<span class="st">"HadSeizAfterEvent"</span>]):</span>
<span id="cb22-67"><a href="#cb22-67" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> row[<span class="st">"SeizLen"</span>] <span class="kw">in</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>]:</span>
<span id="cb22-68"><a href="#cb22-68" aria-hidden="true" tabindex="-1"></a>            row[<span class="st">"HadSeizAfterEvent"</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb22-69"><a href="#cb22-69" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> row[<span class="st">"HadSeizAfterEvent"</span>] <span class="op">==</span> <span class="dv">0</span> <span class="kw">and</span> row[<span class="st">"SeizLen"</span>] <span class="kw">in</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>]:</span>
<span id="cb22-70"><a href="#cb22-70" aria-hidden="true" tabindex="-1"></a>        row[<span class="st">"HadSeizAfterEvent"</span>] <span class="op">=</span> <span class="st">"contradiction"</span></span>
<span id="cb22-71"><a href="#cb22-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-72"><a href="#cb22-72" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> row  <span class="co"># Return the modified row</span></span>
<span id="cb22-73"><a href="#cb22-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-74"><a href="#cb22-74" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the function to update df_data</span></span>
<span id="cb22-75"><a href="#cb22-75" aria-hidden="true" tabindex="-1"></a>df_data <span class="op">=</span> df_data.<span class="bu">apply</span>(update_had_seiz, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb22-76"><a href="#cb22-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-77"><a href="#cb22-77" aria-hidden="true" tabindex="-1"></a>df_filtered <span class="op">=</span> df_data[df_data[<span class="st">"HadSeiz"</span>] <span class="op">==</span> <span class="dv">1</span>]</span>
<span id="cb22-78"><a href="#cb22-78" aria-hidden="true" tabindex="-1"></a>df_filtered</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/tmp/ipykernel_43613/2377113340.py:27: FutureWarning: Setting an item of incompatible dtype is deprecated and will raise an error in a future version of pandas. Value 'contradiction' has dtype incompatible with float64, please explicitly cast to a compatible dtype first.
  row["HadSeiz"] = "contradiction"</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="66">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">PatNum</th>
<th data-quarto-table-cell-role="th">EmplType</th>
<th data-quarto-table-cell-role="th">Certification</th>
<th data-quarto-table-cell-role="th">InjuryMech</th>
<th data-quarto-table-cell-role="th">High_impact_InjSev</th>
<th data-quarto-table-cell-role="th">Amnesia_verb</th>
<th data-quarto-table-cell-role="th">LOCSeparate</th>
<th data-quarto-table-cell-role="th">LocLen</th>
<th data-quarto-table-cell-role="th">Seiz</th>
<th data-quarto-table-cell-role="th">SeizOccur</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">Finding22</th>
<th data-quarto-table-cell-role="th">Finding23</th>
<th data-quarto-table-cell-role="th">DeathTBI</th>
<th data-quarto-table-cell-role="th">HospHead</th>
<th data-quarto-table-cell-role="th">HospHeadPosCT</th>
<th data-quarto-table-cell-role="th">Intub24Head</th>
<th data-quarto-table-cell-role="th">Neurosurgery</th>
<th data-quarto-table-cell-role="th">PosIntFinal</th>
<th data-quarto-table-cell-role="th">HadSeiz</th>
<th data-quarto-table-cell-role="th">HadSeizAfterEvent</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">19</td>
<td>20.0</td>
<td>5.0</td>
<td>2.0</td>
<td>6.0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>92.0</td>
<td>0.0</td>
<td>NaN</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">75</td>
<td>76.0</td>
<td>5.0</td>
<td>3.0</td>
<td>8.0</td>
<td>3.0</td>
<td>NaN</td>
<td>1.0</td>
<td>4.0</td>
<td>1.0</td>
<td>NaN</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
<td>NaN</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
<td>1.0</td>
<td>1.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">110</td>
<td>111.0</td>
<td>5.0</td>
<td>3.0</td>
<td>6.0</td>
<td>1.0</td>
<td>91.0</td>
<td>0.0</td>
<td>92.0</td>
<td>1.0</td>
<td>3.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">228</td>
<td>229.0</td>
<td>5.0</td>
<td>3.0</td>
<td>10.0</td>
<td>2.0</td>
<td>0.0</td>
<td>1.0</td>
<td>NaN</td>
<td>1.0</td>
<td>1.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">244</td>
<td>245.0</td>
<td>5.0</td>
<td>3.0</td>
<td>5.0</td>
<td>2.0</td>
<td>1.0</td>
<td>1.0</td>
<td>3.0</td>
<td>1.0</td>
<td>1.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">42891</td>
<td>42892.0</td>
<td>5.0</td>
<td>3.0</td>
<td>8.0</td>
<td>2.0</td>
<td>0.0</td>
<td>0.0</td>
<td>92.0</td>
<td>1.0</td>
<td>3.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43006</td>
<td>43007.0</td>
<td>5.0</td>
<td>3.0</td>
<td>4.0</td>
<td>2.0</td>
<td>1.0</td>
<td>1.0</td>
<td>3.0</td>
<td>1.0</td>
<td>1.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43098</td>
<td>43099.0</td>
<td>5.0</td>
<td>3.0</td>
<td>8.0</td>
<td>2.0</td>
<td>91.0</td>
<td>1.0</td>
<td>4.0</td>
<td>1.0</td>
<td>1.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43173</td>
<td>43174.0</td>
<td>5.0</td>
<td>1.0</td>
<td>6.0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>92.0</td>
<td>1.0</td>
<td>3.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43285</td>
<td>43286.0</td>
<td>3.0</td>
<td>3.0</td>
<td>7.0</td>
<td>1.0</td>
<td>91.0</td>
<td>0.0</td>
<td>92.0</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
</tr>
</tbody>
</table>

<p>582 rows × 127 columns</p>
</div>
</div>
</div>
<div id="0899a570" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-02-20T20:02:36.372999Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-02-20T20:02:36.372715Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-02-20T20:02:36.383577Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-02-20T20:02:36.382525Z&quot;}" data-execution_count="67">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Exploring Various variables</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>variable_name <span class="op">=</span> <span class="st">"HadSeiz"</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>column_data <span class="op">=</span> get_variable_info(variable_name, df_seiz)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>get_frequency_table(column_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Data Column for 'HadSeiz':</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">HadSeiz</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43394</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43395</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43396</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43397</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43398</td>
<td>0.0</td>
</tr>
</tbody>
</table>

<p>43399 rows × 1 columns</p>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Documentation Row for 'HadSeiz':</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="67">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Value</th>
<th data-quarto-table-cell-role="th">Frequency</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.0</td>
<td>42529</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1.0</td>
<td>582</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>NaN</td>
<td>202</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>contradiction</td>
<td>86</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="62bcfbc2" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-02-20T20:02:36.385982Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-02-20T20:02:36.385780Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-02-20T20:02:36.400513Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-02-20T20:02:36.399684Z&quot;}" data-execution_count="69">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>variable_name <span class="op">=</span> <span class="st">"HadSeizAfterEvent"</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>column_data <span class="op">=</span> get_variable_info(variable_name, df_seiz)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>get_frequency_table(column_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Data Column for 'HadSeizAfterEvent':</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">HadSeizAfterEvent</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43394</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43395</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43396</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43397</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43398</td>
<td>0.0</td>
</tr>
</tbody>
</table>

<p>43399 rows × 1 columns</p>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Documentation Row for 'HadSeizAfterEvent':</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="69">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Value</th>
<th data-quarto-table-cell-role="th">Frequency</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.0</td>
<td>42529</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1.0</td>
<td>582</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>NaN</td>
<td>202</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>contradiction</td>
<td>86</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="973b3b80" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-02-20T20:02:36.403162Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-02-20T20:02:36.402917Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-02-20T20:02:36.415449Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-02-20T20:02:36.414595Z&quot;}" data-execution_count="70">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>variable_name <span class="op">=</span> <span class="st">"IndSeiz"</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>column_data <span class="op">=</span> get_variable_info(variable_name, df_seiz)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>get_frequency_table(column_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Data Column for 'IndSeiz':</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">IndSeiz</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43394</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43395</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43396</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43397</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43398</td>
<td>0.0</td>
</tr>
</tbody>
</table>

<p>43399 rows × 1 columns</p>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Documentation Row for 'IndSeiz':</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="70">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Value</th>
<th data-quarto-table-cell-role="th">Frequency</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>NaN</td>
<td>26474</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.0</td>
<td>16423</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1.0</td>
<td>502</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Clearly you can see that HadSeizAfterEvent and HadSeiz end up being the same so we can drop HadSeizAfterEvent and keep HadSeiz. Also, we can see that compared to just using SeizInd, we caught a lot more peopple who had seizures with our new feature. With just SeizInd, there would have been 26,000 people we would not have accounted for (outdataed), while using HadSeiz, we now can only not account for around 300 people. Moreover, we caught around 86 people in which there were contradictions in their medical records.</p>
<div id="751452b1" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-02-20T20:02:36.418215Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-02-20T20:02:36.417928Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-02-20T20:02:36.431534Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-02-20T20:02:36.430955Z&quot;}" data-execution_count="71">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter the DataFrame to return rows where HadSeiz is labeled as "contradiction"</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>df_contradictions <span class="op">=</span> df_seiz[df_seiz[<span class="st">"HadSeiz"</span>] <span class="op">==</span> <span class="st">"contradiction"</span>]</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>df_contradictions</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="71">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">PatNum</th>
<th data-quarto-table-cell-role="th">IndSeiz</th>
<th data-quarto-table-cell-role="th">Seiz</th>
<th data-quarto-table-cell-role="th">SeizOccur</th>
<th data-quarto-table-cell-role="th">SeizLen</th>
<th data-quarto-table-cell-role="th">HadSeiz</th>
<th data-quarto-table-cell-role="th">HadSeizAfterEvent</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">670</td>
<td>671.0</td>
<td>0.0</td>
<td>1.0</td>
<td>NaN</td>
<td>NaN</td>
<td>contradiction</td>
<td>contradiction</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">754</td>
<td>755.0</td>
<td>0.0</td>
<td>1.0</td>
<td>NaN</td>
<td>NaN</td>
<td>contradiction</td>
<td>contradiction</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2353</td>
<td>2354.0</td>
<td>0.0</td>
<td>1.0</td>
<td>NaN</td>
<td>NaN</td>
<td>contradiction</td>
<td>contradiction</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2362</td>
<td>2363.0</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>contradiction</td>
<td>contradiction</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2637</td>
<td>2638.0</td>
<td>0.0</td>
<td>1.0</td>
<td>2.0</td>
<td>NaN</td>
<td>contradiction</td>
<td>contradiction</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">41259</td>
<td>41260.0</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>contradiction</td>
<td>contradiction</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">41696</td>
<td>41697.0</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>contradiction</td>
<td>contradiction</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">41903</td>
<td>41904.0</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>contradiction</td>
<td>contradiction</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">42833</td>
<td>42834.0</td>
<td>0.0</td>
<td>1.0</td>
<td>NaN</td>
<td>NaN</td>
<td>contradiction</td>
<td>contradiction</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43325</td>
<td>43326.0</td>
<td>0.0</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
<td>contradiction</td>
<td>contradiction</td>
</tr>
</tbody>
</table>

<p>86 rows × 7 columns</p>
</div>
</div>
</div>
<p>Clearly the above rows are contradictions because one can not have a seizure after the event, but also not had a seizure in their life. This contradiction could either be coming from mis-inputs of data or because IndSeiz is recorded at a different time (likely before) Seiz is recorded. But, keeping the rows labeled as contradiction should not be a problem in either case.</p>
</section>
<section id="drop-hadseizafterevent" class="level3">
<h3 class="anchored" data-anchor-id="drop-hadseizafterevent">Drop HadSeizAfterEvent</h3>
<div id="7e5b1830" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-02-20T20:02:36.433772Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-02-20T20:02:36.433471Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-02-20T20:02:36.442338Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-02-20T20:02:36.441831Z&quot;}" data-execution_count="73">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>df_seiz <span class="op">=</span> df_seiz.drop(columns<span class="op">=</span>[<span class="st">"HadSeizAfterEvent"</span>])</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>df_seiz</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">KeyError</span>                                  Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[73], line 1</span>
<span class="ansi-green-fg">----&gt; 1</span> df_seiz <span style="color:rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">df_seiz</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">drop</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">columns</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">[</span><span style="color:rgb(175,0,0)" class="ansi-yellow-bg">"</span><span style="color:rgb(175,0,0)" class="ansi-yellow-bg">HadSeizAfterEvent</span><span style="color:rgb(175,0,0)" class="ansi-yellow-bg">"</span><span class="ansi-yellow-bg">]</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">      2</span> df_seiz

File <span class="ansi-green-fg">~/miniconda3/envs/stat214_env/lib/python3.10/site-packages/pandas/core/frame.py:5581</span>, in <span class="ansi-cyan-fg">DataFrame.drop</span><span class="ansi-blue-fg">(self, labels, axis, index, columns, level, inplace, errors)</span>
<span class="ansi-green-fg ansi-bold">   5433</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span> <span style="color:rgb(0,0,255)">drop</span>(
<span class="ansi-green-fg ansi-bold">   5434</span>     <span style="color:rgb(0,135,0)">self</span>,
<span class="ansi-green-fg ansi-bold">   5435</span>     labels: IndexLabel <span style="color:rgb(98,98,98)">|</span> <span style="font-weight:bold;color:rgb(0,135,0)">None</span> <span style="color:rgb(98,98,98)">=</span> <span style="font-weight:bold;color:rgb(0,135,0)">None</span>,
<span class="ansi-green-fg">   (...)</span>
<span class="ansi-green-fg ansi-bold">   5442</span>     errors: IgnoreRaise <span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">raise</span><span style="color:rgb(175,0,0)">"</span>,
<span class="ansi-green-fg ansi-bold">   5443</span> ) <span style="color:rgb(98,98,98)">-</span><span style="color:rgb(98,98,98)">&gt;</span> DataFrame <span style="color:rgb(98,98,98)">|</span> <span style="font-weight:bold;color:rgb(0,135,0)">None</span>:
<span class="ansi-green-fg ansi-bold">   5444</span> <span style="color:rgb(188,188,188)">    </span><span style="font-style:italic;color:rgb(175,0,0)">"""</span>
<span class="ansi-green-fg ansi-bold">   5445</span> <span style="font-style:italic;color:rgb(175,0,0)">    Drop specified labels from rows or columns.</span>
<span class="ansi-green-fg ansi-bold">   5446</span> 
<span class="ansi-green-fg">   (...)</span>
<span class="ansi-green-fg ansi-bold">   5579</span> <span style="font-style:italic;color:rgb(175,0,0)">            weight  1.0     0.8</span>
<span class="ansi-green-fg ansi-bold">   5580</span> <span style="font-style:italic;color:rgb(175,0,0)">    """</span>
<span class="ansi-green-fg">-&gt; 5581</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="color:rgb(0,135,0)" class="ansi-yellow-bg">super</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">)</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">drop</span><span class="ansi-yellow-bg">(</span>
<span class="ansi-green-fg ansi-bold">   5582</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">labels</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">labels</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg ansi-bold">   5583</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">axis</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">axis</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg ansi-bold">   5584</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">index</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">index</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg ansi-bold">   5585</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">columns</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">columns</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg ansi-bold">   5586</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">level</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">level</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg ansi-bold">   5587</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">inplace</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">inplace</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg ansi-bold">   5588</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">errors</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">errors</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg ansi-bold">   5589</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">)</span>

File <span class="ansi-green-fg">~/miniconda3/envs/stat214_env/lib/python3.10/site-packages/pandas/core/generic.py:4788</span>, in <span class="ansi-cyan-fg">NDFrame.drop</span><span class="ansi-blue-fg">(self, labels, axis, index, columns, level, inplace, errors)</span>
<span class="ansi-green-fg ansi-bold">   4786</span> <span style="font-weight:bold;color:rgb(0,135,0)">for</span> axis, labels <span style="font-weight:bold;color:rgb(175,0,255)">in</span> axes<span style="color:rgb(98,98,98)">.</span>items():
<span class="ansi-green-fg ansi-bold">   4787</span>     <span style="font-weight:bold;color:rgb(0,135,0)">if</span> labels <span style="font-weight:bold;color:rgb(175,0,255)">is</span> <span style="font-weight:bold;color:rgb(175,0,255)">not</span> <span style="font-weight:bold;color:rgb(0,135,0)">None</span>:
<span class="ansi-green-fg">-&gt; 4788</span>         obj <span style="color:rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">obj</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">_drop_axis</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">labels</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">axis</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">level</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">level</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">errors</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">errors</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">   4790</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> inplace:
<span class="ansi-green-fg ansi-bold">   4791</span>     <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_update_inplace(obj)

File <span class="ansi-green-fg">~/miniconda3/envs/stat214_env/lib/python3.10/site-packages/pandas/core/generic.py:4830</span>, in <span class="ansi-cyan-fg">NDFrame._drop_axis</span><span class="ansi-blue-fg">(self, labels, axis, level, errors, only_slice)</span>
<span class="ansi-green-fg ansi-bold">   4828</span>         new_axis <span style="color:rgb(98,98,98)">=</span> axis<span style="color:rgb(98,98,98)">.</span>drop(labels, level<span style="color:rgb(98,98,98)">=</span>level, errors<span style="color:rgb(98,98,98)">=</span>errors)
<span class="ansi-green-fg ansi-bold">   4829</span>     <span style="font-weight:bold;color:rgb(0,135,0)">else</span>:
<span class="ansi-green-fg">-&gt; 4830</span>         new_axis <span style="color:rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">axis</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">drop</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">labels</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">errors</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">errors</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">   4831</span>     indexer <span style="color:rgb(98,98,98)">=</span> axis<span style="color:rgb(98,98,98)">.</span>get_indexer(new_axis)
<span class="ansi-green-fg ansi-bold">   4833</span> <span style="font-style:italic;color:rgb(95,135,135)"># Case for non-unique axis</span>
<span class="ansi-green-fg ansi-bold">   4834</span> <span style="font-weight:bold;color:rgb(0,135,0)">else</span>:

File <span class="ansi-green-fg">~/miniconda3/envs/stat214_env/lib/python3.10/site-packages/pandas/core/indexes/base.py:7070</span>, in <span class="ansi-cyan-fg">Index.drop</span><span class="ansi-blue-fg">(self, labels, errors)</span>
<span class="ansi-green-fg ansi-bold">   7068</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> mask<span style="color:rgb(98,98,98)">.</span>any():
<span class="ansi-green-fg ansi-bold">   7069</span>     <span style="font-weight:bold;color:rgb(0,135,0)">if</span> errors <span style="color:rgb(98,98,98)">!=</span> <span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">ignore</span><span style="color:rgb(175,0,0)">"</span>:
<span class="ansi-green-fg">-&gt; 7070</span>         <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> <span style="font-weight:bold;color:rgb(215,95,95)">KeyError</span>(<span style="color:rgb(175,0,0)">f</span><span style="color:rgb(175,0,0)">"</span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>labels[mask]<span style="color:rgb(98,98,98)">.</span>tolist()<span style="font-weight:bold;color:rgb(175,95,135)">}</span><span style="color:rgb(175,0,0)"> not found in axis</span><span style="color:rgb(175,0,0)">"</span>)
<span class="ansi-green-fg ansi-bold">   7071</span>     indexer <span style="color:rgb(98,98,98)">=</span> indexer[<span style="color:rgb(98,98,98)">~</span>mask]
<span class="ansi-green-fg ansi-bold">   7072</span> <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>delete(indexer)

<span class="ansi-red-fg">KeyError</span>: "['HadSeizAfterEvent'] not found in axis"</pre>
</div>
</div>
</div>
<p>We can now use this new feature to fill in the previous ones: if someone has never had a seizure before, we can count them as having 0 seizure occurances and 0 length.</p>
<div id="11858005" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-02-20T20:02:36.444205Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-02-20T20:02:36.444028Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-02-20T20:02:36.454303Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-02-20T20:02:36.453790Z&quot;}" data-execution_count="74">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Update rows where HadSeiz == 0 to ensure IndSeiz, Seiz, SeizOccur, and SeizLen are also 0</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>df_seiz.loc[df_seiz[<span class="st">"HadSeiz"</span>] <span class="op">==</span> <span class="dv">0</span>, [<span class="st">"IndSeiz"</span>, <span class="st">"Seiz"</span>, <span class="st">"SeizOccur"</span>, <span class="st">"SeizLen"</span>]] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the updated DataFrame</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>df_seiz</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="74">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">PatNum</th>
<th data-quarto-table-cell-role="th">IndSeiz</th>
<th data-quarto-table-cell-role="th">Seiz</th>
<th data-quarto-table-cell-role="th">SeizOccur</th>
<th data-quarto-table-cell-role="th">SeizLen</th>
<th data-quarto-table-cell-role="th">HadSeiz</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>4.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>5.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43394</td>
<td>43395.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43395</td>
<td>43396.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43396</td>
<td>43397.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43397</td>
<td>43398.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43398</td>
<td>43399.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
</tbody>
</table>

<p>43399 rows × 6 columns</p>
</div>
</div>
</div>
<div id="9ba04b59" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-02-20T20:02:36.456185Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-02-20T20:02:36.455941Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-02-20T20:02:36.465561Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-02-20T20:02:36.465063Z&quot;}" data-execution_count="75">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>variable_name <span class="op">=</span> <span class="st">"SeizOccur"</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>column_data <span class="op">=</span> get_variable_info(variable_name, df_seiz)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>get_frequency_table(column_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Data Column for 'SeizOccur':</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">SeizOccur</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43394</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43395</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43396</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43397</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43398</td>
<td>0.0</td>
</tr>
</tbody>
</table>

<p>43399 rows × 1 columns</p>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Documentation Row for 'SeizOccur':</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="75">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Value</th>
<th data-quarto-table-cell-role="th">Frequency</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.0</td>
<td>42529</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>NaN</td>
<td>338</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1.0</td>
<td>253</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2.0</td>
<td>210</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>3.0</td>
<td>69</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>You can see that for SeizOccur, we have been able to account for around 42000 people who we could not account for before. Similar is true for the other features.</p>
<div id="a1d5d54e" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-02-20T20:02:36.467620Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-02-20T20:02:36.467217Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-02-20T20:02:36.529214Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-02-20T20:02:36.528629Z&quot;}" data-execution_count="76">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace NaN or 92 with "unknown" in specified columns</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>df_seiz[[<span class="st">"IndSeiz"</span>, <span class="st">"Seiz"</span>, <span class="st">"SeizOccur"</span>, <span class="st">"SeizLen"</span>]] <span class="op">=</span> df_seiz[[<span class="st">"IndSeiz"</span>, <span class="st">"Seiz"</span>, <span class="st">"SeizOccur"</span>, <span class="st">"SeizLen"</span>]].applymap(</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span> x: <span class="bu">float</span>(<span class="st">'nan'</span>) <span class="cf">if</span> pd.isna(x) <span class="kw">or</span> x <span class="op">==</span> <span class="dv">92</span> <span class="cf">else</span> x</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>df_seiz</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/tmp/ipykernel_43613/803964955.py:2: FutureWarning: DataFrame.applymap has been deprecated. Use DataFrame.map instead.
  df_seiz[["IndSeiz", "Seiz", "SeizOccur", "SeizLen"]] = df_seiz[["IndSeiz", "Seiz", "SeizOccur", "SeizLen"]].applymap(</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="76">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">PatNum</th>
<th data-quarto-table-cell-role="th">IndSeiz</th>
<th data-quarto-table-cell-role="th">Seiz</th>
<th data-quarto-table-cell-role="th">SeizOccur</th>
<th data-quarto-table-cell-role="th">SeizLen</th>
<th data-quarto-table-cell-role="th">HadSeiz</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>4.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>5.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43394</td>
<td>43395.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43395</td>
<td>43396.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43396</td>
<td>43397.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43397</td>
<td>43398.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43398</td>
<td>43399.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
</tbody>
</table>

<p>43399 rows × 6 columns</p>
</div>
</div>
</div>
<div id="774ca636" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-02-20T20:02:36.531271Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-02-20T20:02:36.531096Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-02-20T20:02:36.543241Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-02-20T20:02:36.542712Z&quot;}" data-execution_count="77">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>variable_name <span class="op">=</span> <span class="st">"SeizOccur"</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>column_data <span class="op">=</span> get_variable_info(variable_name, df_seiz)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>get_frequency_table(column_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Data Column for 'SeizOccur':</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">SeizOccur</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43394</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43395</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43396</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43397</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43398</td>
<td>0.0</td>
</tr>
</tbody>
</table>

<p>43399 rows × 1 columns</p>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Documentation Row for 'SeizOccur':</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="77">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Value</th>
<th data-quarto-table-cell-role="th">Frequency</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.0</td>
<td>42529</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>NaN</td>
<td>338</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1.0</td>
<td>253</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2.0</td>
<td>210</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>3.0</td>
<td>69</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>For each of these features we simply just took all the unknown data and labeled it as such.</p>
</section>
<section id="vomiting" class="level3">
<h3 class="anchored" data-anchor-id="vomiting">Vomiting</h3>
<p>This feature we are not going to deduce if they have vomited or not. Vomiting is something most people experience in their life, so creating a feature to find out who and who has ever vomited in their life will be less helpful that seizures. Knowing how many vomiting sessions happened and chronic vomiting started is more helpful: data we already have.</p>
<p>However, deducing if they have not vomited is still useful as we can fill in some of the other features like we did we seizures.</p>
<div id="5e6edb08" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-02-20T20:02:36.545248Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-02-20T20:02:36.545065Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-02-20T20:02:36.558215Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-02-20T20:02:36.557694Z&quot;}" data-execution_count="78">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Making sure we remember what our variables are</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>variable_name <span class="op">=</span> <span class="st">"VomitLast"</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>column_data <span class="op">=</span> get_variable_info(variable_name, df_data, df_doc)</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>get_frequency_table(column_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Data Column for 'VomitLast':</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">VomitLast</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43394</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43395</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43396</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43397</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43398</td>
<td>0.0</td>
</tr>
</tbody>
</table>

<p>43399 rows × 1 columns</p>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Documentation Row for 'VomitLast':</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">9</th>
<th data-quarto-table-cell-role="th">Variable Name</th>
<th data-quarto-table-cell-role="th">Label/Description</th>
<th data-quarto-table-cell-role="th">Format Name and Values</th>
<th data-quarto-table-cell-role="th">Notes</th>
<th data-quarto-table-cell-role="th">NaN</th>
<th data-quarto-table-cell-role="th">NaN</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>VomitLast</td>
<td>When was the last episode of vomiting?</td>
<td>VomLast\n1 &lt; 1 hr before ED evaluation\n2 ...</td>
<td>Not applicable is marked if vomiting (at any t...</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Returned Notes:
Not applicable is marked if vomiting (at any time after injury) is answered as no or missing.

Returned Label/Description:
When was the last episode of vomiting?

Returned Format Name and Values:
VomLast
1   &lt; 1 hr before ED evaluation
2   1 -4 hrs before ED evaluation
3  &gt; 4 hrs before ED evaluation
92  Not applicable</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="78">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Value</th>
<th data-quarto-table-cell-role="th">Frequency</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>NaN</td>
<td>25700</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.0</td>
<td>12887</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1.0</td>
<td>2762</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2.0</td>
<td>1712</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>3.0</td>
<td>338</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="6e3ff8e0" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-02-20T20:02:36.560054Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-02-20T20:02:36.559790Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-02-20T20:02:36.567136Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-02-20T20:02:36.566631Z&quot;}" data-execution_count="79">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create df_vomit with selected features</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>df_vomit <span class="op">=</span> df_data[[<span class="st">"PatNum"</span>, <span class="st">"VomitNbr"</span>, <span class="st">"VomitStart"</span>, <span class="st">"IndVomit"</span>, <span class="st">"VomitLast"</span>]].copy()</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>df_vomit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="79">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">PatNum</th>
<th data-quarto-table-cell-role="th">VomitNbr</th>
<th data-quarto-table-cell-role="th">VomitStart</th>
<th data-quarto-table-cell-role="th">IndVomit</th>
<th data-quarto-table-cell-role="th">VomitLast</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2.0</td>
<td>3.0</td>
<td>3.0</td>
<td>1.0</td>
<td>1.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>4.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>5.0</td>
<td>1.0</td>
<td>2.0</td>
<td>0.0</td>
<td>2.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43394</td>
<td>43395.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43395</td>
<td>43396.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43396</td>
<td>43397.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43397</td>
<td>43398.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43398</td>
<td>43399.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
</tbody>
</table>

<p>43399 rows × 5 columns</p>
</div>
</div>
</div>
<div id="5d25bcd4" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-02-20T20:02:36.569126Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-02-20T20:02:36.568860Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-02-20T20:02:36.593410Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-02-20T20:02:36.592837Z&quot;}" data-execution_count="80">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize the new feature vomitEvidenceCount with 0</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>df_vomit[<span class="st">"vomitEvidenceCount"</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>df_vomit[<span class="st">"vomitEvidenceCount"</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize the new feature vLackOfEvidence with 0</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>df_vomit[<span class="st">"vLackOfEvidence"</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>df_vomit[<span class="st">"vLackOfEvidence"</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Increase vomitEvidenceCount based on conditions</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>df_vomit[<span class="st">"vomitEvidenceCount"</span>] <span class="op">+=</span> df_vomit[<span class="st">"VomitNbr"</span>].isin([<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>]).astype(<span class="bu">int</span>)</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>df_vomit[<span class="st">"vomitEvidenceCount"</span>] <span class="op">+=</span> df_vomit[<span class="st">"VomitStart"</span>].isin([<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>]).astype(<span class="bu">int</span>)</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>df_vomit[<span class="st">"vomitEvidenceCount"</span>] <span class="op">+=</span> df_vomit[<span class="st">"VomitLast"</span>].isin([<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>]).astype(<span class="bu">int</span>)</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>df_vomit[<span class="st">"vomitEvidenceCount"</span>] <span class="op">+=</span> (df_vomit[<span class="st">"IndVomit"</span>] <span class="op">==</span> <span class="dv">1</span>).astype(<span class="bu">int</span>)</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Increase vLackOfEvidence based on conditions</span></span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>df_vomit[<span class="st">"vLackOfEvidence"</span>] <span class="op">+=</span> df_vomit[<span class="st">"VomitNbr"</span>].isin([<span class="dv">92</span>, <span class="bu">float</span>(<span class="st">"nan"</span>)]).astype(<span class="bu">int</span>)</span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>df_vomit[<span class="st">"vLackOfEvidence"</span>] <span class="op">+=</span> df_vomit[<span class="st">"VomitStart"</span>].isin([<span class="dv">92</span>, <span class="bu">float</span>(<span class="st">"nan"</span>)]).astype(<span class="bu">int</span>)</span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>df_vomit[<span class="st">"vLackOfEvidence"</span>] <span class="op">+=</span> df_vomit[<span class="st">"VomitLast"</span>].isin([<span class="dv">92</span>, <span class="bu">float</span>(<span class="st">"nan"</span>)]).astype(<span class="bu">int</span>)</span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>df_vomit[<span class="st">"vLackOfEvidence"</span>] <span class="op">+=</span> (df_vomit[<span class="st">"IndVomit"</span>].isin([<span class="dv">92</span>, <span class="bu">float</span>(<span class="st">"nan"</span>)])).astype(<span class="bu">int</span>)</span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a>df_vomit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="80">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">PatNum</th>
<th data-quarto-table-cell-role="th">VomitNbr</th>
<th data-quarto-table-cell-role="th">VomitStart</th>
<th data-quarto-table-cell-role="th">IndVomit</th>
<th data-quarto-table-cell-role="th">VomitLast</th>
<th data-quarto-table-cell-role="th">vomitEvidenceCount</th>
<th data-quarto-table-cell-role="th">vLackOfEvidence</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>0</td>
<td>4</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2.0</td>
<td>3.0</td>
<td>3.0</td>
<td>1.0</td>
<td>1.0</td>
<td>4</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>4.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>0</td>
<td>4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>5.0</td>
<td>1.0</td>
<td>2.0</td>
<td>0.0</td>
<td>2.0</td>
<td>3</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43394</td>
<td>43395.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>0</td>
<td>4</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43395</td>
<td>43396.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>0</td>
<td>4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43396</td>
<td>43397.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>0</td>
<td>4</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43397</td>
<td>43398.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>0</td>
<td>4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43398</td>
<td>43399.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>

<p>43399 rows × 7 columns</p>
</div>
</div>
</div>
<div id="5fcb09a4" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-02-20T20:02:36.595555Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-02-20T20:02:36.595255Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-02-20T20:02:36.610224Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-02-20T20:02:36.609670Z&quot;}" data-execution_count="81">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the columns to modify</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>vomit_columns <span class="op">=</span> [<span class="st">"VomitNbr"</span>, <span class="st">"VomitStart"</span>, <span class="st">"IndVomit"</span>, <span class="st">"VomitLast"</span>]</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace 92 and NaN with 0 for rows where vomitEvidenceCount is 0 and vLackOfEvidence is not 4</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> vomit_columns:</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>    df_vomit.loc[</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>        (df_vomit[<span class="st">"vomitEvidenceCount"</span>] <span class="op">==</span> <span class="dv">0</span>) <span class="op">&amp;</span> (df_vomit[<span class="st">"vLackOfEvidence"</span>] <span class="op">!=</span> <span class="dv">4</span>), col</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>    ] <span class="op">=</span> df_vomit[col].replace({<span class="dv">92</span>: <span class="dv">0</span>, pd.NA: <span class="dv">0</span>, <span class="va">None</span>: <span class="dv">0</span>, <span class="bu">float</span>(<span class="st">"nan"</span>): <span class="dv">0</span>})</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop vomitEvidenceCount and vLackOfEvidence</span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>df_vomit <span class="op">=</span> df_vomit.drop(columns<span class="op">=</span>[<span class="st">"vomitEvidenceCount"</span>]).drop(columns<span class="op">=</span>[<span class="st">"vLackOfEvidence"</span>])</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>df_vomit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="81">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">PatNum</th>
<th data-quarto-table-cell-role="th">VomitNbr</th>
<th data-quarto-table-cell-role="th">VomitStart</th>
<th data-quarto-table-cell-role="th">IndVomit</th>
<th data-quarto-table-cell-role="th">VomitLast</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2.0</td>
<td>3.0</td>
<td>3.0</td>
<td>1.0</td>
<td>1.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>4.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>5.0</td>
<td>1.0</td>
<td>2.0</td>
<td>0.0</td>
<td>2.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43394</td>
<td>43395.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43395</td>
<td>43396.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43396</td>
<td>43397.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43397</td>
<td>43398.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43398</td>
<td>43399.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
</tbody>
</table>

<p>43399 rows × 5 columns</p>
</div>
</div>
</div>
<div id="efe3319d" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-02-20T20:02:36.612601Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-02-20T20:02:36.612393Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-02-20T20:02:36.677916Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-02-20T20:02:36.677191Z&quot;}" data-execution_count="82">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace NaN or 92 with float('nan') in specified columns</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>df_vomit[vomit_columns] <span class="op">=</span> df_vomit[vomit_columns].applymap(</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span> x: <span class="bu">float</span>(<span class="st">'nan'</span>) <span class="cf">if</span> pd.isna(x) <span class="kw">or</span> x <span class="op">==</span> <span class="dv">92</span> <span class="cf">else</span> x</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>df_vomit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/tmp/ipykernel_43613/3648450237.py:2: FutureWarning: DataFrame.applymap has been deprecated. Use DataFrame.map instead.
  df_vomit[vomit_columns] = df_vomit[vomit_columns].applymap(</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="82">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">PatNum</th>
<th data-quarto-table-cell-role="th">VomitNbr</th>
<th data-quarto-table-cell-role="th">VomitStart</th>
<th data-quarto-table-cell-role="th">IndVomit</th>
<th data-quarto-table-cell-role="th">VomitLast</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2.0</td>
<td>3.0</td>
<td>3.0</td>
<td>1.0</td>
<td>1.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>4.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>5.0</td>
<td>1.0</td>
<td>2.0</td>
<td>0.0</td>
<td>2.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43394</td>
<td>43395.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43395</td>
<td>43396.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43396</td>
<td>43397.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43397</td>
<td>43398.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43398</td>
<td>43399.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
</tbody>
</table>

<p>43399 rows × 5 columns</p>
</div>
</div>
</div>
<div id="500d0dfe" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-02-20T20:02:36.680155Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-02-20T20:02:36.679927Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-02-20T20:02:36.692732Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-02-20T20:02:36.692065Z&quot;}" data-execution_count="83">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>variable_name <span class="op">=</span> <span class="st">"VomitLast"</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>column_data <span class="op">=</span> get_variable_info(variable_name, df_vomit)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>get_frequency_table(column_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Data Column for 'VomitLast':</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">VomitLast</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43394</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43395</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43396</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43397</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43398</td>
<td>0.0</td>
</tr>
</tbody>
</table>

<p>43399 rows × 1 columns</p>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Documentation Row for 'VomitLast':</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="83">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Value</th>
<th data-quarto-table-cell-role="th">Frequency</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>NaN</td>
<td>25700</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.0</td>
<td>12887</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1.0</td>
<td>2762</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2.0</td>
<td>1712</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>3.0</td>
<td>338</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We now only have 1007 unknowns instead of 20k+.</p>
</section>
<section id="updating-df_data" class="level3">
<h3 class="anchored" data-anchor-id="updating-df_data">Updating df_data</h3>
<div id="e1a22db9" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-02-20T20:02:36.695229Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-02-20T20:02:36.694930Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-02-20T20:02:36.722957Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-02-20T20:02:36.722249Z&quot;}" data-execution_count="33">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace the respective columns in df_data with the updated versions from df_vomit</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>df_data[df_vomit.columns] <span class="op">=</span> df_vomit</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace the respective columns in df_data with the updated versions from df_seiz</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>df_data[df_seiz.columns] <span class="op">=</span> df_seiz</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>df_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">PatNum</th>
<th data-quarto-table-cell-role="th">EmplType</th>
<th data-quarto-table-cell-role="th">Certification</th>
<th data-quarto-table-cell-role="th">InjuryMech</th>
<th data-quarto-table-cell-role="th">High_impact_InjSev</th>
<th data-quarto-table-cell-role="th">Amnesia_verb</th>
<th data-quarto-table-cell-role="th">LOCSeparate</th>
<th data-quarto-table-cell-role="th">LocLen</th>
<th data-quarto-table-cell-role="th">Seiz</th>
<th data-quarto-table-cell-role="th">SeizOccur</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">Finding21</th>
<th data-quarto-table-cell-role="th">Finding22</th>
<th data-quarto-table-cell-role="th">Finding23</th>
<th data-quarto-table-cell-role="th">DeathTBI</th>
<th data-quarto-table-cell-role="th">HospHead</th>
<th data-quarto-table-cell-role="th">HospHeadPosCT</th>
<th data-quarto-table-cell-role="th">Intub24Head</th>
<th data-quarto-table-cell-role="th">Neurosurgery</th>
<th data-quarto-table-cell-role="th">PosIntFinal</th>
<th data-quarto-table-cell-role="th">HadSeiz</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.0</td>
<td>3.0</td>
<td>3</td>
<td>11.0</td>
<td>2.0</td>
<td>0.0</td>
<td>0.0</td>
<td>92.0</td>
<td>0.0</td>
<td>NaN</td>
<td>...</td>
<td>92</td>
<td>92</td>
<td>92</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2.0</td>
<td>5.0</td>
<td>3</td>
<td>8.0</td>
<td>2.0</td>
<td>0.0</td>
<td>0.0</td>
<td>92.0</td>
<td>0.0</td>
<td>NaN</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3.0</td>
<td>5.0</td>
<td>3</td>
<td>5.0</td>
<td>2.0</td>
<td>NaN</td>
<td>NaN</td>
<td>92.0</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>1.0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>4.0</td>
<td>5.0</td>
<td>3</td>
<td>6.0</td>
<td>1.0</td>
<td>91.0</td>
<td>0.0</td>
<td>92.0</td>
<td>0.0</td>
<td>NaN</td>
<td>...</td>
<td>92</td>
<td>92</td>
<td>92</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>5.0</td>
<td>3.0</td>
<td>3</td>
<td>12.0</td>
<td>2.0</td>
<td>91.0</td>
<td>0.0</td>
<td>92.0</td>
<td>0.0</td>
<td>NaN</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43394</td>
<td>43395.0</td>
<td>5.0</td>
<td>3</td>
<td>8.0</td>
<td>2.0</td>
<td>0.0</td>
<td>0.0</td>
<td>92.0</td>
<td>0.0</td>
<td>NaN</td>
<td>...</td>
<td>92</td>
<td>92</td>
<td>92</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43395</td>
<td>43396.0</td>
<td>5.0</td>
<td>3</td>
<td>6.0</td>
<td>1.0</td>
<td>91.0</td>
<td>0.0</td>
<td>92.0</td>
<td>0.0</td>
<td>NaN</td>
<td>...</td>
<td>92</td>
<td>92</td>
<td>92</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43396</td>
<td>43397.0</td>
<td>5.0</td>
<td>3</td>
<td>7.0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>92.0</td>
<td>0.0</td>
<td>NaN</td>
<td>...</td>
<td>92</td>
<td>92</td>
<td>92</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43397</td>
<td>43398.0</td>
<td>5.0</td>
<td>1</td>
<td>8.0</td>
<td>2.0</td>
<td>0.0</td>
<td>0.0</td>
<td>92.0</td>
<td>0.0</td>
<td>NaN</td>
<td>...</td>
<td>92</td>
<td>92</td>
<td>92</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43398</td>
<td>43399.0</td>
<td>5.0</td>
<td>90</td>
<td>8.0</td>
<td>3.0</td>
<td>0.0</td>
<td>0.0</td>
<td>92.0</td>
<td>0.0</td>
<td>NaN</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
</tr>
</tbody>
</table>

<p>43399 rows × 126 columns</p>
</div>
</div>
</div>
</section>
</section>
<section id="some-relationship-eda" class="level1">
<h1>Some relationship EDA</h1>
<p>We have been doing a lot of cleaning and exploring data, but not a lot of exploring relationships. Lets look at that now.</p>
<div id="eb854657" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-02-20T20:02:36.725226Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-02-20T20:02:36.724969Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-02-20T20:02:37.524970Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-02-20T20:02:37.524176Z&quot;}" data-execution_count="84">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>df_data_filtered <span class="op">=</span> df_data.copy()</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to numeric (if not already)</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>df_data_filtered[<span class="st">"VomitLast"</span>] <span class="op">=</span> pd.to_numeric(df_data_filtered[<span class="st">"VomitLast"</span>], errors<span class="op">=</span><span class="st">"coerce"</span>)</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>df_data_filtered[<span class="st">"SeizOccur"</span>] <span class="op">=</span> pd.to_numeric(df_data_filtered[<span class="st">"SeizOccur"</span>], errors<span class="op">=</span><span class="st">"coerce"</span>)</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a pivot table for frequency</span></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>heatmap_data <span class="op">=</span> df_data_filtered.pivot_table(index<span class="op">=</span><span class="st">"SeizOccur"</span>, columns<span class="op">=</span><span class="st">"VomitLast"</span>, aggfunc<span class="op">=</span><span class="st">"size"</span>, fill_value<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot heatmap</span></span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>sns.heatmap(heatmap_data, cmap<span class="op">=</span><span class="st">"Blues"</span>, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">"d"</span>)</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"VomitLast"</span>)</span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"SeizOccur"</span>)</span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Heatmap of VomitLast vs. SeizOccur (Frequency)"</span>)</span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab1_Exploratory_Data_Analysis_files/figure-html/cell-31-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="192e3879" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-02-20T20:02:37.527259Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-02-20T20:02:37.526907Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-02-20T20:02:37.681451Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-02-20T20:02:37.680831Z&quot;}" data-execution_count="85">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>sns.violinplot(x<span class="op">=</span><span class="st">"VomitLast"</span>, y<span class="op">=</span><span class="st">"SeizOccur"</span>, data<span class="op">=</span>df_data_filtered)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"VomitLast"</span>)</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"SeizOccur"</span>)</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Violin Plot of VomitLast vs. SeizOccur"</span>)</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab1_Exploratory_Data_Analysis_files/figure-html/cell-32-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="8135031d" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-02-20T20:02:37.683474Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-02-20T20:02:37.683289Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-02-20T20:02:38.765821Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-02-20T20:02:38.765028Z&quot;}" data-execution_count="86">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert all values to string to keep float('nan')</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>df_data_str <span class="op">=</span> df_data.astype(<span class="bu">str</span>)</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a pivot table for frequency count</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>heatmap_data <span class="op">=</span> df_data_str.pivot_table(index<span class="op">=</span><span class="st">"SeizOccur"</span>, columns<span class="op">=</span><span class="st">"VomitLast"</span>, aggfunc<span class="op">=</span><span class="st">"size"</span>, fill_value<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot heatmap</span></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>sns.heatmap(heatmap_data, cmap<span class="op">=</span><span class="st">"Blues"</span>, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">"d"</span>)</span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"VomitLast"</span>)</span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"SeizOccur"</span>)</span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Heatmap of VomitLast vs. SeizOccur (Including float('nan'))"</span>)</span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab1_Exploratory_Data_Analysis_files/figure-html/cell-33-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>We can see that most people have not seizure-ed and of the people recorded, most have not vomited either. Seems robust to representation, but there are a lot of unknowns in our “vomit last.”</p>
<div id="3da62f5c" class="cell" data-execution_count="87">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter data for HadSeiz = 0</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>df_hadseiz_0 <span class="op">=</span> df_data[df_data[<span class="st">"HadSeiz"</span>] <span class="op">==</span> <span class="dv">0</span>]</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a pivot table for the heatmap (using VomitNbr vs SeizOccur as an example)</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>heatmap_0 <span class="op">=</span> df_hadseiz_0.pivot_table(index<span class="op">=</span><span class="st">"VomitNbr"</span>, columns<span class="op">=</span><span class="st">"HadSeiz"</span>, aggfunc<span class="op">=</span><span class="st">"size"</span>, fill_value<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot heatmap</span></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>sns.heatmap(heatmap_0, cmap<span class="op">=</span><span class="st">"Blues"</span>, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">"d"</span>)</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"HadSeiz"</span>)</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"VomitNbr"</span>)</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Heatmap of VomitNbr for HadSeiz = 0"</span>)</span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab1_Exploratory_Data_Analysis_files/figure-html/cell-34-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Based on the heatmaps, it seems that people are less likely to be vomiting if they have seizure difficulties. This may be counterintuitive at first; however, it may make sense given that a person coming in for non-seizure-related issues is more likely to be facing a different issue: such as vomiting.</p>
</section>
<section id="explore-more-data" class="level1">
<h1>Explore more data</h1>
<section id="explore-gcseye" class="level3">
<h3 class="anchored" data-anchor-id="explore-gcseye">Explore GCSEye</h3>
<div id="05c1ef6b" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-02-20T20:02:39.007405Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-02-20T20:02:39.007222Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-02-20T20:02:39.022409Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-02-20T20:02:39.021742Z&quot;}" data-execution_count="40">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Take a look at GCSEye</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>variable_name <span class="op">=</span> <span class="st">"GCSEye"</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>column_data <span class="op">=</span> get_variable_info(variable_name, df_data, df_doc)</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>get_frequency_table(column_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Data Column for 'GCSEye':</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">GCSEye</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>4.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>4.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>4.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>4.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43394</td>
<td>4.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43395</td>
<td>4.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43396</td>
<td>4.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43397</td>
<td>4.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43398</td>
<td>4.0</td>
</tr>
</tbody>
</table>

<p>43399 rows × 1 columns</p>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Documentation Row for 'GCSEye':</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">9</th>
<th data-quarto-table-cell-role="th">Variable Name</th>
<th data-quarto-table-cell-role="th">Label/Description</th>
<th data-quarto-table-cell-role="th">Format Name and Values</th>
<th data-quarto-table-cell-role="th">Notes</th>
<th data-quarto-table-cell-role="th">NaN</th>
<th data-quarto-table-cell-role="th">NaN</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">23</td>
<td>GCSEye</td>
<td>GCS component: eye</td>
<td>GCSEye\n1 None\n2 Pain\n3 Verbal\n...</td>
<td>NaN</td>
<td>back</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Returned Notes:
nan

Returned Label/Description:
GCS component: eye

Returned Format Name and Values:
GCSEye
1     None
2     Pain
3     Verbal
4    Spontaneous</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="40">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Value</th>
<th data-quarto-table-cell-role="th">Frequency</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>4.0</td>
<td>41148</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>NaN</td>
<td>1288</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3.0</td>
<td>506</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1.0</td>
<td>291</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2.0</td>
<td>166</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Here we need more domain information which we can find online.</p>
<p>The eye-opening response is one of three components in the Glasgow Coma Scale (GCS), scored from 1 to 4:</p>
<p>“None” (Score = 1) → The patient does not open their eyes, even to pain. “Pain” (Score = 2) → The patient only opens their eyes in response to painful stimulation (e.g., pinching). “Verbal” (Score = 3) → The patient opens their eyes when spoken to. “Spontaneous” (Score = 4) → The patient opens their eyes naturally, without needing stimulation.</p>
<p>1 is worse than 4, and it is a scale. Often used for unconscious or altered-consciousness patients, especially in trauma cases, brain injuries, or ICU settings</p>
<div id="bf9e0cfc" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-02-20T20:02:39.255045Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-02-20T20:02:39.254797Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-02-20T20:02:39.348227Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-02-20T20:02:39.347484Z&quot;}" data-execution_count="88">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter out unknown values to ensure proper heatmap plotting</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>df_gcs_eye <span class="op">=</span> df_data[(df_data[<span class="st">"HadSeiz"</span>] <span class="op">==</span> <span class="dv">0</span>) <span class="op">&amp;</span> (df_data[<span class="st">"GCSEye"</span>] <span class="op">!=</span> <span class="st">"unknown"</span>) <span class="op">&amp;</span> (df_data[<span class="st">"GCSEye"</span>] <span class="op">!=</span> <span class="dv">4</span>)]</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep only necessary columns</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>df_gcs_eye <span class="op">=</span> df_gcs_eye[[<span class="st">"GCSEye"</span>, <span class="st">"HadSeiz"</span>]]</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a pivot table for the heatmap</span></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>heatmap_gcs_eye <span class="op">=</span> df_gcs_eye.pivot_table(index<span class="op">=</span><span class="st">"GCSEye"</span>, columns<span class="op">=</span><span class="st">"HadSeiz"</span>, aggfunc<span class="op">=</span><span class="st">"size"</span>, fill_value<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot heatmap</span></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>sns.heatmap(heatmap_gcs_eye, cmap<span class="op">=</span><span class="st">"Blues"</span>, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">"d"</span>)</span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"HadSeiz"</span>)</span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"GCSEye"</span>)</span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Heatmap of GCSEye vs HadSeiz"</span>)</span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab1_Exploratory_Data_Analysis_files/figure-html/cell-36-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cfda5a95" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-02-20T20:02:39.350306Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-02-20T20:02:39.350126Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-02-20T20:02:39.447060Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-02-20T20:02:39.446126Z&quot;}" data-execution_count="89">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter out unknown values to ensure proper heatmap plotting</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>df_gcs_eye <span class="op">=</span> df_data[(df_data[<span class="st">"HadSeiz"</span>] <span class="op">==</span> <span class="dv">1</span>) <span class="op">&amp;</span> (df_data[<span class="st">"GCSEye"</span>] <span class="op">!=</span> <span class="st">"unknown"</span>) <span class="op">&amp;</span> (df_data[<span class="st">"GCSEye"</span>] <span class="op">!=</span> <span class="dv">4</span>)]</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep only necessary columns</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>df_gcs_eye <span class="op">=</span> df_gcs_eye[[<span class="st">"GCSEye"</span>, <span class="st">"HadSeiz"</span>]]</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a pivot table for the heatmap</span></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>heatmap_gcs_eye <span class="op">=</span> df_gcs_eye.pivot_table(index<span class="op">=</span><span class="st">"GCSEye"</span>, columns<span class="op">=</span><span class="st">"HadSeiz"</span>, aggfunc<span class="op">=</span><span class="st">"size"</span>, fill_value<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot heatmap</span></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>sns.heatmap(heatmap_gcs_eye, cmap<span class="op">=</span><span class="st">"Blues"</span>, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">"d"</span>)</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"HadSeiz"</span>)</span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"GCSEye"</span>)</span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Heatmap of GCSEye vs HadSeiz"</span>)</span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab1_Exploratory_Data_Analysis_files/figure-html/cell-37-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Confirmed when removing score 4 as well.</p>
<p>I realized now we do have a classification variable PostIntFinal and we can use this to do supervised learning.</p>
<div id="b9383f97" class="cell" data-execution_count="90">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Take a look at GCSEye</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>variable_name <span class="op">=</span> <span class="st">"PosIntFinal"</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>column_data <span class="op">=</span> get_variable_info(variable_name, df_data, df_doc)</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>get_frequency_table(column_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Data Column for 'PosIntFinal':</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">PosIntFinal</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43394</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43395</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43396</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43397</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43398</td>
<td>0.0</td>
</tr>
</tbody>
</table>

<p>43399 rows × 1 columns</p>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Documentation Row for 'PosIntFinal':</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">9</th>
<th data-quarto-table-cell-role="th">Variable Name</th>
<th data-quarto-table-cell-role="th">Label/Description</th>
<th data-quarto-table-cell-role="th">Format Name and Values</th>
<th data-quarto-table-cell-role="th">Notes</th>
<th data-quarto-table-cell-role="th">NaN</th>
<th data-quarto-table-cell-role="th">NaN</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">124</td>
<td>PosIntFinal</td>
<td>Clinically-important traumatic brain injury</td>
<td>YesNo\n0 No\n1 Yes</td>
<td>Clinically-important TBI was defined as having...</td>
<td>MAIN RES</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Returned Notes:
Clinically-important TBI was defined as having at least one of the following: (1) neurosurgical procedure performed, (2) &nbsp;intubated &gt; 24 hours for head trauma,&nbsp; (3) death due to TBI or in the ED, (4) hospitalized for &gt;= 2 nights due to head injury and having a TBI on CT.

Returned Label/Description:
Clinically-important traumatic brain injury

Returned Format Name and Values:
YesNo
0   No
1   Yes</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="90">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Value</th>
<th data-quarto-table-cell-role="th">Frequency</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.0</td>
<td>42616</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1.0</td>
<td>763</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>NaN</td>
<td>20</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Now I filter the dataset to retain only the key columns related to TBI, extracts rows where “PosIntFinal” is NaN into a separate DataFrame for cleaning</p>
<div id="251cb379" class="cell" data-execution_count="91">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define relevant columns</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>columns_to_keep <span class="op">=</span> [<span class="st">"PatNum"</span>, <span class="st">"PosCT"</span>, <span class="st">"DeathTBI"</span>, <span class="st">"HospHeadPosCT"</span>, <span class="st">"PosIntFinal"</span>]</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter dataset to keep only relevant columns</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>df_filtered <span class="op">=</span> df_data[columns_to_keep]</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a DataFrame with only NaN values in 'PosIntFinal'</span></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>nan_df_class <span class="op">=</span> df_filtered[df_filtered[<span class="st">"PosIntFinal"</span>].isna()]</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>nan_df_class</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="91">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">PatNum</th>
<th data-quarto-table-cell-role="th">PosCT</th>
<th data-quarto-table-cell-role="th">DeathTBI</th>
<th data-quarto-table-cell-role="th">HospHeadPosCT</th>
<th data-quarto-table-cell-role="th">PosIntFinal</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">75</td>
<td>76.0</td>
<td>0.0</td>
<td>NaN</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">781</td>
<td>782.0</td>
<td>0.0</td>
<td>NaN</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">947</td>
<td>948.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6112</td>
<td>6113.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9541</td>
<td>9542.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">10514</td>
<td>10515.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10721</td>
<td>10722.0</td>
<td>92.0</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15233</td>
<td>15234.0</td>
<td>92.0</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">23581</td>
<td>23582.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">24073</td>
<td>24074.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25524</td>
<td>25525.0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">27333</td>
<td>27334.0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">28310</td>
<td>28311.0</td>
<td>92.0</td>
<td>NaN</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">31170</td>
<td>31171.0</td>
<td>92.0</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">36782</td>
<td>36783.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">37454</td>
<td>37455.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">38669</td>
<td>38670.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">38875</td>
<td>38876.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">39986</td>
<td>39987.0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">41618</td>
<td>41619.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Given the above, it seems that there are a few people that should be classified as TBI based on PosCT section. We will make such an adjustment. The rest we can drop because they seem unlikely to be positive for TBI. We choose to drop them because there are two cases:</p>
<ol type="1">
<li><p>They are meant to be net-positive for TBI and we are making a bad decision by making them all TBI negative.</p></li>
<li><p>They are meant to be net-negative for TBI and we do not lose much information by dropping already have 42000+ TBI negative individuals in our data</p></li>
</ol>
<div id="c876681a" class="cell" data-execution_count="92">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep only rows where PosCT is 1</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>nan_df_class <span class="op">=</span> nan_df_class[nan_df_class[<span class="st">"PosCT"</span>] <span class="op">==</span> <span class="dv">1</span>]</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Set PosIntFinal to 1 for these rows</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>nan_df_class[<span class="st">"PosIntFinal"</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>nan_df_class</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/tmp/ipykernel_43613/2298626134.py:5: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  nan_df_class["PosIntFinal"] = 1</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="92">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">PatNum</th>
<th data-quarto-table-cell-role="th">PosCT</th>
<th data-quarto-table-cell-role="th">DeathTBI</th>
<th data-quarto-table-cell-role="th">HospHeadPosCT</th>
<th data-quarto-table-cell-role="th">PosIntFinal</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">25524</td>
<td>25525.0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">27333</td>
<td>27334.0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">39986</td>
<td>39987.0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="3927f308" class="cell" data-execution_count="93">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Update df_data with the respective updated values from nan_df_class</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>df_data.update(nan_df_class)</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop rows left with NaN in df_data</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>df_data <span class="op">=</span> df_data.dropna(subset<span class="op">=</span>[<span class="st">"PosIntFinal"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="23f6804e" class="cell" data-execution_count="94">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Take a look at GCSEye</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>variable_name <span class="op">=</span> <span class="st">"PosIntFinal"</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>column_data <span class="op">=</span> get_variable_info(variable_name, df_data, df_doc)</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>get_frequency_table(column_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Data Column for 'PosIntFinal':</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">PosIntFinal</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43394</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43395</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43396</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43397</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43398</td>
<td>0.0</td>
</tr>
</tbody>
</table>

<p>43382 rows × 1 columns</p>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Documentation Row for 'PosIntFinal':</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">9</th>
<th data-quarto-table-cell-role="th">Variable Name</th>
<th data-quarto-table-cell-role="th">Label/Description</th>
<th data-quarto-table-cell-role="th">Format Name and Values</th>
<th data-quarto-table-cell-role="th">Notes</th>
<th data-quarto-table-cell-role="th">NaN</th>
<th data-quarto-table-cell-role="th">NaN</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">124</td>
<td>PosIntFinal</td>
<td>Clinically-important traumatic brain injury</td>
<td>YesNo\n0 No\n1 Yes</td>
<td>Clinically-important TBI was defined as having...</td>
<td>MAIN RES</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Returned Notes:
Clinically-important TBI was defined as having at least one of the following: (1) neurosurgical procedure performed, (2) &nbsp;intubated &gt; 24 hours for head trauma,&nbsp; (3) death due to TBI or in the ED, (4) hospitalized for &gt;= 2 nights due to head injury and having a TBI on CT.

Returned Label/Description:
Clinically-important traumatic brain injury

Returned Format Name and Values:
YesNo
0   No
1   Yes</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="94">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Value</th>
<th data-quarto-table-cell-role="th">Frequency</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.0</td>
<td>42616</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1.0</td>
<td>766</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Now that we cleaned our data, we can use hot one encoding to ensure that our data is encoded non-ordinally.</p>
<div id="ee70c6fd" class="cell" data-execution_count="95">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeClassifier</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> cross_val_score</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> OneHotEncoder</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Define candidate categorical features</span></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>candidate_features <span class="op">=</span> [<span class="st">'HadSeiz'</span>, <span class="st">'GCSEye'</span>, <span class="st">"VomitNbr"</span>, <span class="st">"VomitStart"</span>, <span class="st">"IndVomit"</span>, <span class="st">"VomitLast"</span>]</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>target_variable <span class="op">=</span> <span class="st">'PosIntFinal'</span></span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a><span class="co"># One-hot encode categorical variables</span></span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>df_encoded <span class="op">=</span> df_data.copy()</span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a>df_encoded <span class="op">=</span> df_encoded.astype(<span class="bu">str</span>) <span class="co"># Need to make sure the df is all the same datatype for encoder</span></span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a>encoder <span class="op">=</span> OneHotEncoder(handle_unknown<span class="op">=</span><span class="st">'ignore'</span>, drop<span class="op">=</span><span class="st">'first'</span>, sparse_output<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply One-Hot Encoding</span></span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a>X_encoded <span class="op">=</span> encoder.fit_transform(df_encoded[candidate_features])</span>
<span id="cb79-16"><a href="#cb79-16" aria-hidden="true" tabindex="-1"></a>feature_names <span class="op">=</span> encoder.get_feature_names_out(candidate_features)</span>
<span id="cb79-17"><a href="#cb79-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-18"><a href="#cb79-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to DataFrame</span></span>
<span id="cb79-19"><a href="#cb79-19" aria-hidden="true" tabindex="-1"></a>X_encoded <span class="op">=</span> pd.DataFrame(X_encoded, columns<span class="op">=</span>feature_names, index<span class="op">=</span>df_encoded.index)</span>
<span id="cb79-20"><a href="#cb79-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-21"><a href="#cb79-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the encoded features to the dataset</span></span>
<span id="cb79-22"><a href="#cb79-22" aria-hidden="true" tabindex="-1"></a>df_encoded <span class="op">=</span> df_encoded.drop(columns<span class="op">=</span>candidate_features)  <span class="co"># Drop original categorical columns</span></span>
<span id="cb79-23"><a href="#cb79-23" aria-hidden="true" tabindex="-1"></a>df_encoded <span class="op">=</span> pd.concat([df_encoded, X_encoded], axis<span class="op">=</span><span class="dv">1</span>)  <span class="co"># Add encoded features</span></span>
<span id="cb79-24"><a href="#cb79-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-25"><a href="#cb79-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Define X and y</span></span>
<span id="cb79-26"><a href="#cb79-26" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df_encoded[feature_names]  <span class="co"># Use only one-hot encoded features</span></span>
<span id="cb79-27"><a href="#cb79-27" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df_encoded[target_variable]</span>
<span id="cb79-28"><a href="#cb79-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-29"><a href="#cb79-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize greedy feature selection</span></span>
<span id="cb79-30"><a href="#cb79-30" aria-hidden="true" tabindex="-1"></a>selected_features <span class="op">=</span> []</span>
<span id="cb79-31"><a href="#cb79-31" aria-hidden="true" tabindex="-1"></a>best_score <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb79-32"><a href="#cb79-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-33"><a href="#cb79-33" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="bu">len</span>(selected_features) <span class="op">&lt;</span> <span class="bu">len</span>(feature_names):</span>
<span id="cb79-34"><a href="#cb79-34" aria-hidden="true" tabindex="-1"></a>    best_feature <span class="op">=</span> <span class="va">None</span></span>
<span id="cb79-35"><a href="#cb79-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> feature <span class="kw">in</span> feature_names:</span>
<span id="cb79-36"><a href="#cb79-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> feature <span class="kw">in</span> selected_features:</span>
<span id="cb79-37"><a href="#cb79-37" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb79-38"><a href="#cb79-38" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb79-39"><a href="#cb79-39" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Try adding this feature</span></span>
<span id="cb79-40"><a href="#cb79-40" aria-hidden="true" tabindex="-1"></a>        current_features <span class="op">=</span> selected_features <span class="op">+</span> [feature]</span>
<span id="cb79-41"><a href="#cb79-41" aria-hidden="true" tabindex="-1"></a>        X_subset <span class="op">=</span> X[current_features]</span>
<span id="cb79-42"><a href="#cb79-42" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb79-43"><a href="#cb79-43" aria-hidden="true" tabindex="-1"></a>        model <span class="op">=</span> DecisionTreeClassifier(random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb79-44"><a href="#cb79-44" aria-hidden="true" tabindex="-1"></a>        score <span class="op">=</span> np.mean(cross_val_score(model, X_subset, y, cv<span class="op">=</span><span class="dv">5</span>, scoring<span class="op">=</span><span class="st">'accuracy'</span>))</span>
<span id="cb79-45"><a href="#cb79-45" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb79-46"><a href="#cb79-46" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> score <span class="op">&gt;</span> best_score:</span>
<span id="cb79-47"><a href="#cb79-47" aria-hidden="true" tabindex="-1"></a>            best_score <span class="op">=</span> score</span>
<span id="cb79-48"><a href="#cb79-48" aria-hidden="true" tabindex="-1"></a>            best_feature <span class="op">=</span> feature</span>
<span id="cb79-49"><a href="#cb79-49" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb79-50"><a href="#cb79-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> best_feature <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb79-51"><a href="#cb79-51" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span>  <span class="co"># No improvement found</span></span>
<span id="cb79-52"><a href="#cb79-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb79-53"><a href="#cb79-53" aria-hidden="true" tabindex="-1"></a>    selected_features.append(best_feature)</span>
<span id="cb79-54"><a href="#cb79-54" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Added feature: </span><span class="sc">{</span>best_feature<span class="sc">}</span><span class="ss">, New score: </span><span class="sc">{</span>best_score<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb79-55"><a href="#cb79-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-56"><a href="#cb79-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Train final decision tree with selected features</span></span>
<span id="cb79-57"><a href="#cb79-57" aria-hidden="true" tabindex="-1"></a>final_model <span class="op">=</span> DecisionTreeClassifier(random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb79-58"><a href="#cb79-58" aria-hidden="true" tabindex="-1"></a>final_model.fit(X[selected_features], y)</span>
<span id="cb79-59"><a href="#cb79-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-60"><a href="#cb79-60" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Final selected feature order: </span><span class="sc">{</span>selected_features<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Added feature: HadSeiz_1.0, New score: 0.9823
Final selected feature order: ['HadSeiz_1.0']</code></pre>
</div>
</div>
<p>This is fairly unimpressive given that we would get about the same result if we just guessed everyone did not have a TBI:</p>
<div id="85c582eb" class="cell" data-execution_count="96">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="dv">42616</span> <span class="op">/</span> (<span class="dv">42616</span><span class="op">+</span><span class="dv">766</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="96">
<pre><code>0.9823429071965332</code></pre>
</div>
</div>
<div id="8756fa97" class="cell" data-execution_count="97">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Take a look at GCSEye</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>variable_name <span class="op">=</span> <span class="st">"PosIntFinal"</span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>column_data <span class="op">=</span> get_variable_info(variable_name, df_data, df_doc)</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>get_frequency_table(column_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Data Column for 'PosIntFinal':</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">PosIntFinal</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43394</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43395</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43396</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43397</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43398</td>
<td>0.0</td>
</tr>
</tbody>
</table>

<p>43382 rows × 1 columns</p>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Documentation Row for 'PosIntFinal':</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">9</th>
<th data-quarto-table-cell-role="th">Variable Name</th>
<th data-quarto-table-cell-role="th">Label/Description</th>
<th data-quarto-table-cell-role="th">Format Name and Values</th>
<th data-quarto-table-cell-role="th">Notes</th>
<th data-quarto-table-cell-role="th">NaN</th>
<th data-quarto-table-cell-role="th">NaN</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">124</td>
<td>PosIntFinal</td>
<td>Clinically-important traumatic brain injury</td>
<td>YesNo\n0 No\n1 Yes</td>
<td>Clinically-important TBI was defined as having...</td>
<td>MAIN RES</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Returned Notes:
Clinically-important TBI was defined as having at least one of the following: (1) neurosurgical procedure performed, (2) &nbsp;intubated &gt; 24 hours for head trauma,&nbsp; (3) death due to TBI or in the ED, (4) hospitalized for &gt;= 2 nights due to head injury and having a TBI on CT.

Returned Label/Description:
Clinically-important traumatic brain injury

Returned Format Name and Values:
YesNo
0   No
1   Yes</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="97">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Value</th>
<th data-quarto-table-cell-role="th">Frequency</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.0</td>
<td>42616</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1.0</td>
<td>766</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Thus, we should see how many false positives, false negatives, true negatives, and true positives we actually have.</p>
<div id="31f9517a" class="cell" data-execution_count="98">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> confusion_matrix</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Make predictions on the dataset</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> final_model.predict(X[selected_features])</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the confusion matrix</span></span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>tn, fp, fn, tp <span class="op">=</span> confusion_matrix(y, y_pred).ravel()</span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Print TP, TN, FP, FN</span></span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"True Positives (TP): </span><span class="sc">{</span>tp<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"True Negatives (TN): </span><span class="sc">{</span>tn<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"False Positives (FP): </span><span class="sc">{</span>fp<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"False Negatives (FN): </span><span class="sc">{</span>fn<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>True Positives (TP): 0
True Negatives (TN): 42616
False Positives (FP): 0
False Negatives (FN): 766</code></pre>
</div>
</div>
<p>Just as we expected, we have just assumed that nobody has a TBI. Let us do some bagging to fix this.</p>
<div id="b1ef2a62" class="cell" data-execution_count="99">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> Counter</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> OneHotEncoder</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> imblearn.ensemble <span class="im">import</span> BalancedBaggingClassifier</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> imblearn.under_sampling <span class="im">import</span> RandomUnderSampler</span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeClassifier</span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> cross_val_score</span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Define candidate categorical features</span></span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a>candidate_features <span class="op">=</span> [<span class="st">'HadSeiz'</span>, <span class="st">'GCSEye'</span>, <span class="st">"VomitNbr"</span>, <span class="st">"VomitStart"</span>, <span class="st">"IndVomit"</span>, <span class="st">"VomitLast"</span>]</span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a>target_variable <span class="op">=</span> <span class="st">'PosIntFinal'</span></span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-14"><a href="#cb89-14" aria-hidden="true" tabindex="-1"></a><span class="co"># One-hot encode categorical variables</span></span>
<span id="cb89-15"><a href="#cb89-15" aria-hidden="true" tabindex="-1"></a>df_encoded <span class="op">=</span> df_data.copy()</span>
<span id="cb89-16"><a href="#cb89-16" aria-hidden="true" tabindex="-1"></a>df_encoded <span class="op">=</span> df_encoded.astype(<span class="bu">str</span>)  <span class="co"># Ensure all columns are string type for encoding</span></span>
<span id="cb89-17"><a href="#cb89-17" aria-hidden="true" tabindex="-1"></a>encoder <span class="op">=</span> OneHotEncoder(handle_unknown<span class="op">=</span><span class="st">'ignore'</span>, drop<span class="op">=</span><span class="st">'first'</span>, sparse_output<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb89-18"><a href="#cb89-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-19"><a href="#cb89-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply One-Hot Encoding</span></span>
<span id="cb89-20"><a href="#cb89-20" aria-hidden="true" tabindex="-1"></a>X_encoded <span class="op">=</span> encoder.fit_transform(df_encoded[candidate_features])</span>
<span id="cb89-21"><a href="#cb89-21" aria-hidden="true" tabindex="-1"></a>feature_names <span class="op">=</span> encoder.get_feature_names_out(candidate_features)</span>
<span id="cb89-22"><a href="#cb89-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-23"><a href="#cb89-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to DataFrame</span></span>
<span id="cb89-24"><a href="#cb89-24" aria-hidden="true" tabindex="-1"></a>X_encoded <span class="op">=</span> pd.DataFrame(X_encoded, columns<span class="op">=</span>feature_names, index<span class="op">=</span>df_encoded.index)</span>
<span id="cb89-25"><a href="#cb89-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-26"><a href="#cb89-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the encoded features to the dataset</span></span>
<span id="cb89-27"><a href="#cb89-27" aria-hidden="true" tabindex="-1"></a>df_encoded <span class="op">=</span> df_encoded.drop(columns<span class="op">=</span>candidate_features)  <span class="co"># Drop original categorical columns</span></span>
<span id="cb89-28"><a href="#cb89-28" aria-hidden="true" tabindex="-1"></a>df_encoded <span class="op">=</span> pd.concat([df_encoded, X_encoded], axis<span class="op">=</span><span class="dv">1</span>)  <span class="co"># Add encoded features</span></span>
<span id="cb89-29"><a href="#cb89-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-30"><a href="#cb89-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Define X and y</span></span>
<span id="cb89-31"><a href="#cb89-31" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df_encoded[feature_names]  <span class="co"># Use only one-hot encoded features</span></span>
<span id="cb89-32"><a href="#cb89-32" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df_encoded[target_variable]</span>
<span id="cb89-33"><a href="#cb89-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-34"><a href="#cb89-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply undersampling to balance classes</span></span>
<span id="cb89-35"><a href="#cb89-35" aria-hidden="true" tabindex="-1"></a>rus <span class="op">=</span> RandomUnderSampler(sampling_strategy<span class="op">=</span><span class="fl">1.0</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb89-36"><a href="#cb89-36" aria-hidden="true" tabindex="-1"></a>X_resampled, y_resampled <span class="op">=</span> rus.fit_resample(X, y)</span>
<span id="cb89-37"><a href="#cb89-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-38"><a href="#cb89-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the new class distribution</span></span>
<span id="cb89-39"><a href="#cb89-39" aria-hidden="true" tabindex="-1"></a>unique, counts <span class="op">=</span> np.unique(y_resampled, return_counts<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-40"><a href="#cb89-40" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Balanced class distribution after undersampling:"</span>, <span class="bu">dict</span>(<span class="bu">zip</span>(unique, counts)))</span>
<span id="cb89-41"><a href="#cb89-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-42"><a href="#cb89-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize greedy feature selection</span></span>
<span id="cb89-43"><a href="#cb89-43" aria-hidden="true" tabindex="-1"></a>selected_features <span class="op">=</span> []</span>
<span id="cb89-44"><a href="#cb89-44" aria-hidden="true" tabindex="-1"></a>best_score <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb89-45"><a href="#cb89-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-46"><a href="#cb89-46" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="bu">len</span>(selected_features) <span class="op">&lt;</span> <span class="bu">len</span>(feature_names):</span>
<span id="cb89-47"><a href="#cb89-47" aria-hidden="true" tabindex="-1"></a>    best_feature <span class="op">=</span> <span class="va">None</span></span>
<span id="cb89-48"><a href="#cb89-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> feature <span class="kw">in</span> feature_names:</span>
<span id="cb89-49"><a href="#cb89-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> feature <span class="kw">in</span> selected_features:</span>
<span id="cb89-50"><a href="#cb89-50" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb89-51"><a href="#cb89-51" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb89-52"><a href="#cb89-52" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Try adding this feature</span></span>
<span id="cb89-53"><a href="#cb89-53" aria-hidden="true" tabindex="-1"></a>        current_features <span class="op">=</span> selected_features <span class="op">+</span> [feature]</span>
<span id="cb89-54"><a href="#cb89-54" aria-hidden="true" tabindex="-1"></a>        X_subset <span class="op">=</span> X_resampled[current_features]</span>
<span id="cb89-55"><a href="#cb89-55" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb89-56"><a href="#cb89-56" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Use Balanced Bagging to balance class distribution</span></span>
<span id="cb89-57"><a href="#cb89-57" aria-hidden="true" tabindex="-1"></a>        model <span class="op">=</span> BalancedBaggingClassifier(</span>
<span id="cb89-58"><a href="#cb89-58" aria-hidden="true" tabindex="-1"></a>            estimator<span class="op">=</span>DecisionTreeClassifier(random_state<span class="op">=</span><span class="dv">42</span>, max_depth<span class="op">=</span><span class="va">None</span>),</span>
<span id="cb89-59"><a href="#cb89-59" aria-hidden="true" tabindex="-1"></a>            sampling_strategy<span class="op">=</span><span class="fl">1.0</span>,  <span class="co"># Ensure equal number of 0s and 1s</span></span>
<span id="cb89-60"><a href="#cb89-60" aria-hidden="true" tabindex="-1"></a>            random_state<span class="op">=</span><span class="dv">42</span>,</span>
<span id="cb89-61"><a href="#cb89-61" aria-hidden="true" tabindex="-1"></a>            n_estimators<span class="op">=</span><span class="dv">50</span>,  <span class="co"># Increase base estimators</span></span>
<span id="cb89-62"><a href="#cb89-62" aria-hidden="true" tabindex="-1"></a>            n_jobs<span class="op">=-</span><span class="dv">1</span>  <span class="co"># Use all CPU cores</span></span>
<span id="cb89-63"><a href="#cb89-63" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb89-64"><a href="#cb89-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-65"><a href="#cb89-65" aria-hidden="true" tabindex="-1"></a>        score <span class="op">=</span> np.mean(cross_val_score(model, X_subset, y_resampled, cv<span class="op">=</span><span class="dv">5</span>, scoring<span class="op">=</span><span class="st">'accuracy'</span>))</span>
<span id="cb89-66"><a href="#cb89-66" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb89-67"><a href="#cb89-67" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> score <span class="op">&gt;</span> best_score:</span>
<span id="cb89-68"><a href="#cb89-68" aria-hidden="true" tabindex="-1"></a>            best_score <span class="op">=</span> score</span>
<span id="cb89-69"><a href="#cb89-69" aria-hidden="true" tabindex="-1"></a>            best_feature <span class="op">=</span> feature</span>
<span id="cb89-70"><a href="#cb89-70" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb89-71"><a href="#cb89-71" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> best_feature <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb89-72"><a href="#cb89-72" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span>  <span class="co"># No improvement found</span></span>
<span id="cb89-73"><a href="#cb89-73" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb89-74"><a href="#cb89-74" aria-hidden="true" tabindex="-1"></a>    selected_features.append(best_feature)</span>
<span id="cb89-75"><a href="#cb89-75" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Added feature: </span><span class="sc">{</span>best_feature<span class="sc">}</span><span class="ss">, New score: </span><span class="sc">{</span>best_score<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb89-76"><a href="#cb89-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-77"><a href="#cb89-77" aria-hidden="true" tabindex="-1"></a><span class="co"># Train final balanced bagging model with selected features</span></span>
<span id="cb89-78"><a href="#cb89-78" aria-hidden="true" tabindex="-1"></a>final_model <span class="op">=</span> BalancedBaggingClassifier(</span>
<span id="cb89-79"><a href="#cb89-79" aria-hidden="true" tabindex="-1"></a>    estimator<span class="op">=</span>DecisionTreeClassifier(random_state<span class="op">=</span><span class="dv">42</span>, max_depth<span class="op">=</span><span class="va">None</span>),</span>
<span id="cb89-80"><a href="#cb89-80" aria-hidden="true" tabindex="-1"></a>    sampling_strategy<span class="op">=</span><span class="fl">1.0</span>,</span>
<span id="cb89-81"><a href="#cb89-81" aria-hidden="true" tabindex="-1"></a>    random_state<span class="op">=</span><span class="dv">42</span>,</span>
<span id="cb89-82"><a href="#cb89-82" aria-hidden="true" tabindex="-1"></a>    n_estimators<span class="op">=</span><span class="dv">50</span>,</span>
<span id="cb89-83"><a href="#cb89-83" aria-hidden="true" tabindex="-1"></a>    n_jobs<span class="op">=-</span><span class="dv">1</span></span>
<span id="cb89-84"><a href="#cb89-84" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb89-85"><a href="#cb89-85" aria-hidden="true" tabindex="-1"></a>final_model.fit(X_resampled[selected_features], y_resampled)</span>
<span id="cb89-86"><a href="#cb89-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-87"><a href="#cb89-87" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict on the training data</span></span>
<span id="cb89-88"><a href="#cb89-88" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> final_model.predict(X_resampled[selected_features])</span>
<span id="cb89-89"><a href="#cb89-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-90"><a href="#cb89-90" aria-hidden="true" tabindex="-1"></a><span class="co"># Count occurrences of 0s and 1s in the predicted labels</span></span>
<span id="cb89-91"><a href="#cb89-91" aria-hidden="true" tabindex="-1"></a>unique, counts <span class="op">=</span> np.unique(y_pred, return_counts<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-92"><a href="#cb89-92" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Final predicted class distribution:"</span>, <span class="bu">dict</span>(<span class="bu">zip</span>(unique, counts)))</span>
<span id="cb89-93"><a href="#cb89-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-94"><a href="#cb89-94" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Final selected feature order: </span><span class="sc">{</span>selected_features<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Balanced class distribution after undersampling: {'0.0': np.int64(766), '1.0': np.int64(766)}
Added feature: IndVomit_nan, New score: 0.7931
Added feature: HadSeiz_nan, New score: 0.7944
Added feature: GCSEye_4.0, New score: 0.7964
Added feature: GCSEye_nan, New score: 0.7996
Final predicted class distribution: {'0.0': np.int64(461), '1.0': np.int64(1071)}
Final selected feature order: ['IndVomit_nan', 'HadSeiz_nan', 'GCSEye_4.0', 'GCSEye_nan']</code></pre>
</div>
</div>
<div id="a92bde95" class="cell" data-execution_count="100">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make predictions</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> final_model.predict(X[selected_features])</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute confusion matrix</span></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>tn, fp, fn, tp <span class="op">=</span> confusion_matrix(y, y_pred).ravel()</span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute proportions</span></span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>total_positives <span class="op">=</span> tp <span class="op">+</span> fn  <span class="co"># Actual Positives</span></span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a>total_negatives <span class="op">=</span> tn <span class="op">+</span> fp  <span class="co"># Actual Negatives</span></span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a>sensitivity <span class="op">=</span> tp <span class="op">/</span> total_positives <span class="cf">if</span> total_positives <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span>  <span class="co"># True Positive Rate (TPR)</span></span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a>specificity <span class="op">=</span> tn <span class="op">/</span> total_negatives <span class="cf">if</span> total_negatives <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span>  <span class="co"># True Negative Rate (TNR)</span></span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a>false_positive_rate <span class="op">=</span> fp <span class="op">/</span> total_negatives <span class="cf">if</span> total_negatives <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span>  <span class="co"># FPR</span></span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a>false_negative_rate <span class="op">=</span> fn <span class="op">/</span> total_positives <span class="cf">if</span> total_positives <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span>  <span class="co"># FNR</span></span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-16"><a href="#cb91-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Print results</span></span>
<span id="cb91-17"><a href="#cb91-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"True Positives (TP): </span><span class="sc">{</span>tp<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>sensitivity<span class="sc">:.4f}</span><span class="ss"> of actual positives)"</span>)</span>
<span id="cb91-18"><a href="#cb91-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"True Negatives (TN): </span><span class="sc">{</span>tn<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>specificity<span class="sc">:.4f}</span><span class="ss"> of actual negatives)"</span>)</span>
<span id="cb91-19"><a href="#cb91-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"False Positives (FP): </span><span class="sc">{</span>fp<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>false_positive_rate<span class="sc">:.4f}</span><span class="ss"> of actual negatives)"</span>)</span>
<span id="cb91-20"><a href="#cb91-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"False Negatives (FN): </span><span class="sc">{</span>fn<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>false_negative_rate<span class="sc">:.4f}</span><span class="ss"> of actual positives)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>True Positives (TP): 765 (0.9987 of actual positives)
True Negatives (TN): 26434 (0.6203 of actual negatives)
False Positives (FP): 16182 (0.3797 of actual negatives)
False Negatives (FN): 1 (0.0013 of actual positives)</code></pre>
</div>
</div>
<p>Not particularly impressive as we would be recommending more of the patients to get CT scans than were actually suggested to, meaning we would be making the fundamental problem worse.</p>
<p>Let us look at the features the research paper we read used:</p>
<p>AMS LOCSeparate LocLen Vomit VomitNbr High_impact_InjSev HA_verb HASeverity SFxBas SFxPalp ActNorm</p>
<div id="70f277ec" class="cell" data-execution_count="101">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define candidate categorical features</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>candidate_features <span class="op">=</span> [<span class="st">"AMS"</span>, <span class="st">"LOCSeparate"</span>, <span class="st">"LocLen"</span>, <span class="st">"Vomit"</span>, <span class="st">"VomitNbr"</span>, <span class="st">"High_impact_InjSev"</span>, <span class="st">"HA_verb"</span>, <span class="st">"HASeverity"</span>, <span class="st">"SFxBas"</span>, <span class="st">"SFxPalp"</span>, <span class="st">"ActNorm"</span>, <span class="st">'HadSeiz'</span>]</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>target_variable <span class="op">=</span> <span class="st">'PosIntFinal'</span></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a><span class="co"># One-hot encode categorical variables</span></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>df_encoded <span class="op">=</span> df_data.copy()</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>df_encoded <span class="op">=</span> df_encoded.astype(<span class="bu">str</span>)  <span class="co"># Ensure all columns are string type for encoding</span></span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>encoder <span class="op">=</span> OneHotEncoder(handle_unknown<span class="op">=</span><span class="st">'ignore'</span>, drop<span class="op">=</span><span class="st">'first'</span>, sparse_output<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply One-Hot Encoding</span></span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a>X_encoded <span class="op">=</span> encoder.fit_transform(df_encoded[candidate_features])</span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a>feature_names <span class="op">=</span> encoder.get_feature_names_out(candidate_features)</span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to DataFrame</span></span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true" tabindex="-1"></a>X_encoded <span class="op">=</span> pd.DataFrame(X_encoded, columns<span class="op">=</span>feature_names, index<span class="op">=</span>df_encoded.index)</span>
<span id="cb93-16"><a href="#cb93-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-17"><a href="#cb93-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the encoded features to the dataset</span></span>
<span id="cb93-18"><a href="#cb93-18" aria-hidden="true" tabindex="-1"></a>df_encoded <span class="op">=</span> df_encoded.drop(columns<span class="op">=</span>candidate_features)  <span class="co"># Drop original categorical columns</span></span>
<span id="cb93-19"><a href="#cb93-19" aria-hidden="true" tabindex="-1"></a>df_encoded <span class="op">=</span> pd.concat([df_encoded, X_encoded], axis<span class="op">=</span><span class="dv">1</span>)  <span class="co"># Add encoded features</span></span>
<span id="cb93-20"><a href="#cb93-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-21"><a href="#cb93-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Define X and y</span></span>
<span id="cb93-22"><a href="#cb93-22" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df_encoded[feature_names]  <span class="co"># Use only one-hot encoded features</span></span>
<span id="cb93-23"><a href="#cb93-23" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df_encoded[target_variable]</span>
<span id="cb93-24"><a href="#cb93-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-25"><a href="#cb93-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply undersampling to balance classes</span></span>
<span id="cb93-26"><a href="#cb93-26" aria-hidden="true" tabindex="-1"></a>rus <span class="op">=</span> RandomUnderSampler(sampling_strategy<span class="op">=</span><span class="fl">1.0</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb93-27"><a href="#cb93-27" aria-hidden="true" tabindex="-1"></a>X_resampled, y_resampled <span class="op">=</span> rus.fit_resample(X, y)</span>
<span id="cb93-28"><a href="#cb93-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-29"><a href="#cb93-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the new class distribution</span></span>
<span id="cb93-30"><a href="#cb93-30" aria-hidden="true" tabindex="-1"></a>unique, counts <span class="op">=</span> np.unique(y_resampled, return_counts<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb93-31"><a href="#cb93-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Balanced class distribution after undersampling:"</span>, <span class="bu">dict</span>(<span class="bu">zip</span>(unique, counts)))</span>
<span id="cb93-32"><a href="#cb93-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-33"><a href="#cb93-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize greedy feature selection</span></span>
<span id="cb93-34"><a href="#cb93-34" aria-hidden="true" tabindex="-1"></a>selected_features <span class="op">=</span> []</span>
<span id="cb93-35"><a href="#cb93-35" aria-hidden="true" tabindex="-1"></a>best_score <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb93-36"><a href="#cb93-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-37"><a href="#cb93-37" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="bu">len</span>(selected_features) <span class="op">&lt;</span> <span class="bu">len</span>(feature_names):</span>
<span id="cb93-38"><a href="#cb93-38" aria-hidden="true" tabindex="-1"></a>    best_feature <span class="op">=</span> <span class="va">None</span></span>
<span id="cb93-39"><a href="#cb93-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> feature <span class="kw">in</span> feature_names:</span>
<span id="cb93-40"><a href="#cb93-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> feature <span class="kw">in</span> selected_features:</span>
<span id="cb93-41"><a href="#cb93-41" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb93-42"><a href="#cb93-42" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb93-43"><a href="#cb93-43" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Try adding this feature</span></span>
<span id="cb93-44"><a href="#cb93-44" aria-hidden="true" tabindex="-1"></a>        current_features <span class="op">=</span> selected_features <span class="op">+</span> [feature]</span>
<span id="cb93-45"><a href="#cb93-45" aria-hidden="true" tabindex="-1"></a>        X_subset <span class="op">=</span> X_resampled[current_features]</span>
<span id="cb93-46"><a href="#cb93-46" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb93-47"><a href="#cb93-47" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Use Balanced Bagging to balance class distribution</span></span>
<span id="cb93-48"><a href="#cb93-48" aria-hidden="true" tabindex="-1"></a>        model <span class="op">=</span> BalancedBaggingClassifier(</span>
<span id="cb93-49"><a href="#cb93-49" aria-hidden="true" tabindex="-1"></a>            estimator<span class="op">=</span>DecisionTreeClassifier(random_state<span class="op">=</span><span class="dv">42</span>, max_depth<span class="op">=</span><span class="va">None</span>),</span>
<span id="cb93-50"><a href="#cb93-50" aria-hidden="true" tabindex="-1"></a>            sampling_strategy<span class="op">=</span><span class="fl">1.0</span>,  <span class="co"># Ensure equal number of 0s and 1s</span></span>
<span id="cb93-51"><a href="#cb93-51" aria-hidden="true" tabindex="-1"></a>            random_state<span class="op">=</span><span class="dv">42</span>,</span>
<span id="cb93-52"><a href="#cb93-52" aria-hidden="true" tabindex="-1"></a>            n_estimators<span class="op">=</span><span class="dv">50</span>,  <span class="co"># Increase base estimators</span></span>
<span id="cb93-53"><a href="#cb93-53" aria-hidden="true" tabindex="-1"></a>            n_jobs<span class="op">=-</span><span class="dv">1</span>  <span class="co"># Use all CPU cores</span></span>
<span id="cb93-54"><a href="#cb93-54" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb93-55"><a href="#cb93-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-56"><a href="#cb93-56" aria-hidden="true" tabindex="-1"></a>        score <span class="op">=</span> np.mean(cross_val_score(model, X_subset, y_resampled, cv<span class="op">=</span><span class="dv">5</span>, scoring<span class="op">=</span><span class="st">'accuracy'</span>))</span>
<span id="cb93-57"><a href="#cb93-57" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb93-58"><a href="#cb93-58" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> score <span class="op">&gt;</span> best_score:</span>
<span id="cb93-59"><a href="#cb93-59" aria-hidden="true" tabindex="-1"></a>            best_score <span class="op">=</span> score</span>
<span id="cb93-60"><a href="#cb93-60" aria-hidden="true" tabindex="-1"></a>            best_feature <span class="op">=</span> feature</span>
<span id="cb93-61"><a href="#cb93-61" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb93-62"><a href="#cb93-62" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> best_feature <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb93-63"><a href="#cb93-63" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span>  <span class="co"># No improvement found</span></span>
<span id="cb93-64"><a href="#cb93-64" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb93-65"><a href="#cb93-65" aria-hidden="true" tabindex="-1"></a>    selected_features.append(best_feature)</span>
<span id="cb93-66"><a href="#cb93-66" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Added feature: </span><span class="sc">{</span>best_feature<span class="sc">}</span><span class="ss">, New score: </span><span class="sc">{</span>best_score<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb93-67"><a href="#cb93-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-68"><a href="#cb93-68" aria-hidden="true" tabindex="-1"></a><span class="co"># Train final balanced bagging model with selected features</span></span>
<span id="cb93-69"><a href="#cb93-69" aria-hidden="true" tabindex="-1"></a>final_model <span class="op">=</span> BalancedBaggingClassifier(</span>
<span id="cb93-70"><a href="#cb93-70" aria-hidden="true" tabindex="-1"></a>    estimator<span class="op">=</span>DecisionTreeClassifier(random_state<span class="op">=</span><span class="dv">42</span>, max_depth<span class="op">=</span><span class="va">None</span>),</span>
<span id="cb93-71"><a href="#cb93-71" aria-hidden="true" tabindex="-1"></a>    sampling_strategy<span class="op">=</span><span class="fl">1.0</span>,</span>
<span id="cb93-72"><a href="#cb93-72" aria-hidden="true" tabindex="-1"></a>    random_state<span class="op">=</span><span class="dv">42</span>,</span>
<span id="cb93-73"><a href="#cb93-73" aria-hidden="true" tabindex="-1"></a>    n_estimators<span class="op">=</span><span class="dv">50</span>,</span>
<span id="cb93-74"><a href="#cb93-74" aria-hidden="true" tabindex="-1"></a>    n_jobs<span class="op">=-</span><span class="dv">1</span></span>
<span id="cb93-75"><a href="#cb93-75" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb93-76"><a href="#cb93-76" aria-hidden="true" tabindex="-1"></a>final_model.fit(X_resampled[selected_features], y_resampled)</span>
<span id="cb93-77"><a href="#cb93-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-78"><a href="#cb93-78" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict on the training data</span></span>
<span id="cb93-79"><a href="#cb93-79" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> final_model.predict(X_resampled[selected_features])</span>
<span id="cb93-80"><a href="#cb93-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-81"><a href="#cb93-81" aria-hidden="true" tabindex="-1"></a><span class="co"># Count occurrences of 0s and 1s in the predicted labels</span></span>
<span id="cb93-82"><a href="#cb93-82" aria-hidden="true" tabindex="-1"></a>unique, counts <span class="op">=</span> np.unique(y_pred, return_counts<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb93-83"><a href="#cb93-83" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Final predicted class distribution:"</span>, <span class="bu">dict</span>(<span class="bu">zip</span>(unique, counts)))</span>
<span id="cb93-84"><a href="#cb93-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-85"><a href="#cb93-85" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Final selected feature order: </span><span class="sc">{</span>selected_features<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Balanced class distribution after undersampling: {'0.0': np.int64(766), '1.0': np.int64(766)}
Added feature: AMS_1.0, New score: 0.8290
Added feature: SFxBas_1.0, New score: 0.8401
Added feature: SFxPalp_1.0, New score: 0.8473
Added feature: SFxPalp_2.0, New score: 0.8519
Added feature: LocLen_4.0, New score: 0.8538
Added feature: VomitNbr_nan, New score: 0.8545
Added feature: Vomit_1.0, New score: 0.8590
Added feature: LOCSeparate_nan, New score: 0.8616
Added feature: High_impact_InjSev_2.0, New score: 0.8623
Added feature: Vomit_nan, New score: 0.8629
Final predicted class distribution: {'0.0': np.int64(743), '1.0': np.int64(789)}
Final selected feature order: ['AMS_1.0', 'SFxBas_1.0', 'SFxPalp_1.0', 'SFxPalp_2.0', 'LocLen_4.0', 'VomitNbr_nan', 'Vomit_1.0', 'LOCSeparate_nan', 'High_impact_InjSev_2.0', 'Vomit_nan']</code></pre>
</div>
</div>
<div id="9b061612" class="cell" data-execution_count="102">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make predictions</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> final_model.predict(X[selected_features])</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute confusion matrix</span></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>tn, fp, fn, tp <span class="op">=</span> confusion_matrix(y, y_pred).ravel()</span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute proportions</span></span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>total_positives <span class="op">=</span> tp <span class="op">+</span> fn  <span class="co"># Actual Positives</span></span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>total_negatives <span class="op">=</span> tn <span class="op">+</span> fp  <span class="co"># Actual Negatives</span></span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a>sensitivity <span class="op">=</span> tp <span class="op">/</span> total_positives <span class="cf">if</span> total_positives <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span>  <span class="co"># True Positive Rate (TPR)</span></span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a>specificity <span class="op">=</span> tn <span class="op">/</span> total_negatives <span class="cf">if</span> total_negatives <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span>  <span class="co"># True Negative Rate (TNR)</span></span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a>false_positive_rate <span class="op">=</span> fp <span class="op">/</span> total_negatives <span class="cf">if</span> total_negatives <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span>  <span class="co"># FPR</span></span>
<span id="cb95-14"><a href="#cb95-14" aria-hidden="true" tabindex="-1"></a>false_negative_rate <span class="op">=</span> fn <span class="op">/</span> total_positives <span class="cf">if</span> total_positives <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span>  <span class="co"># FNR</span></span>
<span id="cb95-15"><a href="#cb95-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-16"><a href="#cb95-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Print results</span></span>
<span id="cb95-17"><a href="#cb95-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"True Positives (TP): </span><span class="sc">{</span>tp<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>sensitivity<span class="sc">:.4f}</span><span class="ss"> of actual positives)"</span>)</span>
<span id="cb95-18"><a href="#cb95-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"True Negatives (TN): </span><span class="sc">{</span>tn<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>specificity<span class="sc">:.4f}</span><span class="ss"> of actual negatives)"</span>)</span>
<span id="cb95-19"><a href="#cb95-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"False Positives (FP): </span><span class="sc">{</span>fp<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>false_positive_rate<span class="sc">:.4f}</span><span class="ss"> of actual negatives)"</span>)</span>
<span id="cb95-20"><a href="#cb95-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"False Negatives (FN): </span><span class="sc">{</span>fn<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>false_negative_rate<span class="sc">:.4f}</span><span class="ss"> of actual positives)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>True Positives (TP): 676 (0.8825 of actual positives)
True Negatives (TN): 36220 (0.8499 of actual negatives)
False Positives (FP): 6396 (0.1501 of actual negatives)
False Negatives (FN): 90 (0.1175 of actual positives)</code></pre>
</div>
</div>
<p>Let us try combining both of these.</p>
<div id="f0059555" class="cell" data-execution_count="103">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define candidate categorical features</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>candidate_features <span class="op">=</span> [<span class="st">"AMS"</span>, <span class="st">"LOCSeparate"</span>, <span class="st">"LocLen"</span>, <span class="st">"Vomit"</span>, <span class="st">"VomitNbr"</span>, <span class="st">"High_impact_InjSev"</span>, <span class="st">"HA_verb"</span>, <span class="st">"HASeverity"</span>, <span class="st">"SFxBas"</span>, <span class="st">"SFxPalp"</span>, <span class="st">"ActNorm"</span>, <span class="st">'HadSeiz'</span>, <span class="st">'HadSeiz'</span>, <span class="st">'GCSEye'</span>, <span class="st">"VomitNbr"</span>, <span class="st">"VomitStart"</span>, <span class="st">"IndVomit"</span>, <span class="st">"VomitLast"</span>]</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>target_variable <span class="op">=</span> <span class="st">'PosIntFinal'</span></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a><span class="co"># One-hot encode categorical variables</span></span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>df_encoded <span class="op">=</span> df_data.copy()</span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>df_encoded <span class="op">=</span> df_encoded.astype(<span class="bu">str</span>)  <span class="co"># Ensure all columns are string type for encoding</span></span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a>encoder <span class="op">=</span> OneHotEncoder(handle_unknown<span class="op">=</span><span class="st">'ignore'</span>, drop<span class="op">=</span><span class="st">'first'</span>, sparse_output<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply One-Hot Encoding</span></span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true" tabindex="-1"></a>X_encoded <span class="op">=</span> encoder.fit_transform(df_encoded[candidate_features])</span>
<span id="cb97-12"><a href="#cb97-12" aria-hidden="true" tabindex="-1"></a>feature_names <span class="op">=</span> encoder.get_feature_names_out(candidate_features)</span>
<span id="cb97-13"><a href="#cb97-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-14"><a href="#cb97-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to DataFrame</span></span>
<span id="cb97-15"><a href="#cb97-15" aria-hidden="true" tabindex="-1"></a>X_encoded <span class="op">=</span> pd.DataFrame(X_encoded, columns<span class="op">=</span>feature_names, index<span class="op">=</span>df_encoded.index)</span>
<span id="cb97-16"><a href="#cb97-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-17"><a href="#cb97-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the encoded features to the dataset</span></span>
<span id="cb97-18"><a href="#cb97-18" aria-hidden="true" tabindex="-1"></a>df_encoded <span class="op">=</span> df_encoded.drop(columns<span class="op">=</span>candidate_features)  <span class="co"># Drop original categorical columns</span></span>
<span id="cb97-19"><a href="#cb97-19" aria-hidden="true" tabindex="-1"></a>df_encoded <span class="op">=</span> pd.concat([df_encoded, X_encoded], axis<span class="op">=</span><span class="dv">1</span>)  <span class="co"># Add encoded features</span></span>
<span id="cb97-20"><a href="#cb97-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-21"><a href="#cb97-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Define X and y</span></span>
<span id="cb97-22"><a href="#cb97-22" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df_encoded[feature_names]  <span class="co"># Use only one-hot encoded features</span></span>
<span id="cb97-23"><a href="#cb97-23" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df_encoded[target_variable]</span>
<span id="cb97-24"><a href="#cb97-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-25"><a href="#cb97-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply undersampling to balance classes</span></span>
<span id="cb97-26"><a href="#cb97-26" aria-hidden="true" tabindex="-1"></a>rus <span class="op">=</span> RandomUnderSampler(sampling_strategy<span class="op">=</span><span class="fl">1.0</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb97-27"><a href="#cb97-27" aria-hidden="true" tabindex="-1"></a>X_resampled, y_resampled <span class="op">=</span> rus.fit_resample(X, y)</span>
<span id="cb97-28"><a href="#cb97-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-29"><a href="#cb97-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the new class distribution</span></span>
<span id="cb97-30"><a href="#cb97-30" aria-hidden="true" tabindex="-1"></a>unique, counts <span class="op">=</span> np.unique(y_resampled, return_counts<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb97-31"><a href="#cb97-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Balanced class distribution after undersampling:"</span>, <span class="bu">dict</span>(<span class="bu">zip</span>(unique, counts)))</span>
<span id="cb97-32"><a href="#cb97-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-33"><a href="#cb97-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize greedy feature selection</span></span>
<span id="cb97-34"><a href="#cb97-34" aria-hidden="true" tabindex="-1"></a>selected_features <span class="op">=</span> []</span>
<span id="cb97-35"><a href="#cb97-35" aria-hidden="true" tabindex="-1"></a>best_score <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb97-36"><a href="#cb97-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-37"><a href="#cb97-37" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="bu">len</span>(selected_features) <span class="op">&lt;</span> <span class="bu">len</span>(feature_names):</span>
<span id="cb97-38"><a href="#cb97-38" aria-hidden="true" tabindex="-1"></a>    best_feature <span class="op">=</span> <span class="va">None</span></span>
<span id="cb97-39"><a href="#cb97-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> feature <span class="kw">in</span> feature_names:</span>
<span id="cb97-40"><a href="#cb97-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> feature <span class="kw">in</span> selected_features:</span>
<span id="cb97-41"><a href="#cb97-41" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb97-42"><a href="#cb97-42" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb97-43"><a href="#cb97-43" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Try adding this feature</span></span>
<span id="cb97-44"><a href="#cb97-44" aria-hidden="true" tabindex="-1"></a>        current_features <span class="op">=</span> selected_features <span class="op">+</span> [feature]</span>
<span id="cb97-45"><a href="#cb97-45" aria-hidden="true" tabindex="-1"></a>        X_subset <span class="op">=</span> X_resampled[current_features]</span>
<span id="cb97-46"><a href="#cb97-46" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb97-47"><a href="#cb97-47" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Use Balanced Bagging to balance class distribution</span></span>
<span id="cb97-48"><a href="#cb97-48" aria-hidden="true" tabindex="-1"></a>        model <span class="op">=</span> BalancedBaggingClassifier(</span>
<span id="cb97-49"><a href="#cb97-49" aria-hidden="true" tabindex="-1"></a>            estimator<span class="op">=</span>DecisionTreeClassifier(random_state<span class="op">=</span><span class="dv">42</span>, max_depth<span class="op">=</span><span class="va">None</span>),</span>
<span id="cb97-50"><a href="#cb97-50" aria-hidden="true" tabindex="-1"></a>            sampling_strategy<span class="op">=</span><span class="fl">1.0</span>,  <span class="co"># Ensure equal number of 0s and 1s</span></span>
<span id="cb97-51"><a href="#cb97-51" aria-hidden="true" tabindex="-1"></a>            random_state<span class="op">=</span><span class="dv">42</span>,</span>
<span id="cb97-52"><a href="#cb97-52" aria-hidden="true" tabindex="-1"></a>            n_estimators<span class="op">=</span><span class="dv">50</span>,  <span class="co"># Increase base estimators</span></span>
<span id="cb97-53"><a href="#cb97-53" aria-hidden="true" tabindex="-1"></a>            n_jobs<span class="op">=-</span><span class="dv">1</span>  <span class="co"># Use all CPU cores</span></span>
<span id="cb97-54"><a href="#cb97-54" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb97-55"><a href="#cb97-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-56"><a href="#cb97-56" aria-hidden="true" tabindex="-1"></a>        score <span class="op">=</span> np.mean(cross_val_score(model, X_subset, y_resampled, cv<span class="op">=</span><span class="dv">5</span>, scoring<span class="op">=</span><span class="st">'accuracy'</span>))</span>
<span id="cb97-57"><a href="#cb97-57" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb97-58"><a href="#cb97-58" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> score <span class="op">&gt;</span> best_score:</span>
<span id="cb97-59"><a href="#cb97-59" aria-hidden="true" tabindex="-1"></a>            best_score <span class="op">=</span> score</span>
<span id="cb97-60"><a href="#cb97-60" aria-hidden="true" tabindex="-1"></a>            best_feature <span class="op">=</span> feature</span>
<span id="cb97-61"><a href="#cb97-61" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb97-62"><a href="#cb97-62" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> best_feature <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb97-63"><a href="#cb97-63" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span>  <span class="co"># No improvement found</span></span>
<span id="cb97-64"><a href="#cb97-64" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb97-65"><a href="#cb97-65" aria-hidden="true" tabindex="-1"></a>    selected_features.append(best_feature)</span>
<span id="cb97-66"><a href="#cb97-66" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Added feature: </span><span class="sc">{</span>best_feature<span class="sc">}</span><span class="ss">, New score: </span><span class="sc">{</span>best_score<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb97-67"><a href="#cb97-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-68"><a href="#cb97-68" aria-hidden="true" tabindex="-1"></a><span class="co"># Train final balanced bagging model with selected features</span></span>
<span id="cb97-69"><a href="#cb97-69" aria-hidden="true" tabindex="-1"></a>final_model <span class="op">=</span> BalancedBaggingClassifier(</span>
<span id="cb97-70"><a href="#cb97-70" aria-hidden="true" tabindex="-1"></a>    estimator<span class="op">=</span>DecisionTreeClassifier(random_state<span class="op">=</span><span class="dv">42</span>, max_depth<span class="op">=</span><span class="va">None</span>),</span>
<span id="cb97-71"><a href="#cb97-71" aria-hidden="true" tabindex="-1"></a>    sampling_strategy<span class="op">=</span><span class="fl">1.0</span>,</span>
<span id="cb97-72"><a href="#cb97-72" aria-hidden="true" tabindex="-1"></a>    random_state<span class="op">=</span><span class="dv">42</span>,</span>
<span id="cb97-73"><a href="#cb97-73" aria-hidden="true" tabindex="-1"></a>    n_estimators<span class="op">=</span><span class="dv">50</span>,</span>
<span id="cb97-74"><a href="#cb97-74" aria-hidden="true" tabindex="-1"></a>    n_jobs<span class="op">=-</span><span class="dv">1</span></span>
<span id="cb97-75"><a href="#cb97-75" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb97-76"><a href="#cb97-76" aria-hidden="true" tabindex="-1"></a>final_model.fit(X_resampled[selected_features], y_resampled)</span>
<span id="cb97-77"><a href="#cb97-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-78"><a href="#cb97-78" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict on the training data</span></span>
<span id="cb97-79"><a href="#cb97-79" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> final_model.predict(X_resampled[selected_features])</span>
<span id="cb97-80"><a href="#cb97-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-81"><a href="#cb97-81" aria-hidden="true" tabindex="-1"></a><span class="co"># Count occurrences of 0s and 1s in the predicted labels</span></span>
<span id="cb97-82"><a href="#cb97-82" aria-hidden="true" tabindex="-1"></a>unique, counts <span class="op">=</span> np.unique(y_pred, return_counts<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb97-83"><a href="#cb97-83" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Final predicted class distribution:"</span>, <span class="bu">dict</span>(<span class="bu">zip</span>(unique, counts)))</span>
<span id="cb97-84"><a href="#cb97-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-85"><a href="#cb97-85" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Final selected feature order: </span><span class="sc">{</span>selected_features<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Balanced class distribution after undersampling: {'0.0': np.int64(766), '1.0': np.int64(766)}
Added feature: AMS_1.0, New score: 0.8290
Added feature: SFxBas_1.0, New score: 0.8401
Added feature: SFxPalp_1.0, New score: 0.8473
Added feature: SFxPalp_2.0, New score: 0.8519
Added feature: IndVomit_nan, New score: 0.8577
Added feature: ActNorm_nan, New score: 0.8623
Added feature: LocLen_4.0, New score: 0.8656
Added feature: HASeverity_nan, New score: 0.8669
Added feature: LOCSeparate_1.0, New score: 0.8688
Final predicted class distribution: {'0.0': np.int64(713), '1.0': np.int64(819)}
Final selected feature order: ['AMS_1.0', 'SFxBas_1.0', 'SFxPalp_1.0', 'SFxPalp_2.0', 'IndVomit_nan', 'ActNorm_nan', 'LocLen_4.0', 'HASeverity_nan', 'LOCSeparate_1.0']</code></pre>
</div>
</div>
<div id="03f044e2" class="cell" data-execution_count="104">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make predictions</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> final_model.predict(X[selected_features])</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute confusion matrix</span></span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>tn, fp, fn, tp <span class="op">=</span> confusion_matrix(y, y_pred).ravel()</span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute proportions</span></span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>total_positives <span class="op">=</span> tp <span class="op">+</span> fn  <span class="co"># Actual Positives</span></span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a>total_negatives <span class="op">=</span> tn <span class="op">+</span> fp  <span class="co"># Actual Negatives</span></span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-11"><a href="#cb99-11" aria-hidden="true" tabindex="-1"></a>sensitivity <span class="op">=</span> tp <span class="op">/</span> total_positives <span class="cf">if</span> total_positives <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span>  <span class="co"># True Positive Rate (TPR)</span></span>
<span id="cb99-12"><a href="#cb99-12" aria-hidden="true" tabindex="-1"></a>specificity <span class="op">=</span> tn <span class="op">/</span> total_negatives <span class="cf">if</span> total_negatives <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span>  <span class="co"># True Negative Rate (TNR)</span></span>
<span id="cb99-13"><a href="#cb99-13" aria-hidden="true" tabindex="-1"></a>false_positive_rate <span class="op">=</span> fp <span class="op">/</span> total_negatives <span class="cf">if</span> total_negatives <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span>  <span class="co"># FPR</span></span>
<span id="cb99-14"><a href="#cb99-14" aria-hidden="true" tabindex="-1"></a>false_negative_rate <span class="op">=</span> fn <span class="op">/</span> total_positives <span class="cf">if</span> total_positives <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span>  <span class="co"># FNR</span></span>
<span id="cb99-15"><a href="#cb99-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-16"><a href="#cb99-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Print results</span></span>
<span id="cb99-17"><a href="#cb99-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"True Positives (TP): </span><span class="sc">{</span>tp<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>sensitivity<span class="sc">:.4f}</span><span class="ss"> of actual positives)"</span>)</span>
<span id="cb99-18"><a href="#cb99-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"True Negatives (TN): </span><span class="sc">{</span>tn<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>specificity<span class="sc">:.4f}</span><span class="ss"> of actual negatives)"</span>)</span>
<span id="cb99-19"><a href="#cb99-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"False Positives (FP): </span><span class="sc">{</span>fp<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>false_positive_rate<span class="sc">:.4f}</span><span class="ss"> of actual negatives)"</span>)</span>
<span id="cb99-20"><a href="#cb99-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"False Negatives (FN): </span><span class="sc">{</span>fn<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>false_negative_rate<span class="sc">:.4f}</span><span class="ss"> of actual positives)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>True Positives (TP): 694 (0.9060 of actual positives)
True Negatives (TN): 35566 (0.8346 of actual negatives)
False Positives (FP): 7050 (0.1654 of actual negatives)
False Negatives (FN): 72 (0.0940 of actual positives)</code></pre>
</div>
</div>
<p>Out of each of these data trees we ran, [‘HadSeiz’, ‘GCSEye’, “VomitNbr”, “VomitStart”, “IndVomit”, “VomitLast”] decreased the amount of false negatives we got while also still allowing us to have many true negatives. I think this is most preferable because we want to make sure that all people who have TBI are caught while still decreasing the number of patients unnecessarily put through CT scanning.</p>
<p>However, the 37% false positive rate was worse than the ~35% of people suggested to get a CT scan from the dataset. We are over-telling patients to get CT scans.</p>
<p>Let us see if putting the people into different age ranges will help: such as what the researcher did in the document. This makes sense because often times different age groups have different manifesting symptoms.</p>
<div id="a976258e" class="cell" data-execution_count="105">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Patients younger than 2 years</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>df_under_2 <span class="op">=</span> df_data[df_data[<span class="st">"AgeInMonth"</span>] <span class="op">&lt;</span> <span class="dv">24</span>]</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Patients aged 2 years and older</span></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>df_2_and_older <span class="op">=</span> df_data[df_data[<span class="st">"AgeInMonth"</span>] <span class="op">&gt;=</span> <span class="dv">24</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Younger than 2</p>
<div id="f453e4bb" class="cell" data-execution_count="106">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define candidate categorical features</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>candidate_features <span class="op">=</span> [<span class="st">'HadSeiz'</span>, <span class="st">'GCSEye'</span>, <span class="st">"VomitNbr"</span>, <span class="st">"VomitStart"</span>, <span class="st">"IndVomit"</span>, <span class="st">"VomitLast"</span>]</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>target_variable <span class="op">=</span> <span class="st">'PosIntFinal'</span></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a><span class="co"># One-hot encode categorical variables</span></span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>df_encoded <span class="op">=</span> df_under_2.copy()</span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>df_encoded <span class="op">=</span> df_encoded.astype(<span class="bu">str</span>)  <span class="co"># Ensure all columns are string type for encoding</span></span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>encoder <span class="op">=</span> OneHotEncoder(handle_unknown<span class="op">=</span><span class="st">'ignore'</span>, drop<span class="op">=</span><span class="st">'first'</span>, sparse_output<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply One-Hot Encoding</span></span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a>X_encoded <span class="op">=</span> encoder.fit_transform(df_encoded[candidate_features])</span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a>feature_names <span class="op">=</span> encoder.get_feature_names_out(candidate_features)</span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-14"><a href="#cb102-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to DataFrame</span></span>
<span id="cb102-15"><a href="#cb102-15" aria-hidden="true" tabindex="-1"></a>X_encoded <span class="op">=</span> pd.DataFrame(X_encoded, columns<span class="op">=</span>feature_names, index<span class="op">=</span>df_encoded.index)</span>
<span id="cb102-16"><a href="#cb102-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-17"><a href="#cb102-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the encoded features to the dataset</span></span>
<span id="cb102-18"><a href="#cb102-18" aria-hidden="true" tabindex="-1"></a>df_encoded <span class="op">=</span> df_encoded.drop(columns<span class="op">=</span>candidate_features)  <span class="co"># Drop original categorical columns</span></span>
<span id="cb102-19"><a href="#cb102-19" aria-hidden="true" tabindex="-1"></a>df_encoded <span class="op">=</span> pd.concat([df_encoded, X_encoded], axis<span class="op">=</span><span class="dv">1</span>)  <span class="co"># Add encoded features</span></span>
<span id="cb102-20"><a href="#cb102-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-21"><a href="#cb102-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Define X and y</span></span>
<span id="cb102-22"><a href="#cb102-22" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df_encoded[feature_names]  <span class="co"># Use only one-hot encoded features</span></span>
<span id="cb102-23"><a href="#cb102-23" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df_encoded[target_variable]</span>
<span id="cb102-24"><a href="#cb102-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-25"><a href="#cb102-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply undersampling to balance classes</span></span>
<span id="cb102-26"><a href="#cb102-26" aria-hidden="true" tabindex="-1"></a>rus <span class="op">=</span> RandomUnderSampler(sampling_strategy<span class="op">=</span><span class="fl">1.0</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb102-27"><a href="#cb102-27" aria-hidden="true" tabindex="-1"></a>X_resampled, y_resampled <span class="op">=</span> rus.fit_resample(X, y)</span>
<span id="cb102-28"><a href="#cb102-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-29"><a href="#cb102-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the new class distribution</span></span>
<span id="cb102-30"><a href="#cb102-30" aria-hidden="true" tabindex="-1"></a>unique, counts <span class="op">=</span> np.unique(y_resampled, return_counts<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb102-31"><a href="#cb102-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Balanced class distribution after undersampling:"</span>, <span class="bu">dict</span>(<span class="bu">zip</span>(unique, counts)))</span>
<span id="cb102-32"><a href="#cb102-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-33"><a href="#cb102-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize greedy feature selection</span></span>
<span id="cb102-34"><a href="#cb102-34" aria-hidden="true" tabindex="-1"></a>selected_features <span class="op">=</span> []</span>
<span id="cb102-35"><a href="#cb102-35" aria-hidden="true" tabindex="-1"></a>best_score <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb102-36"><a href="#cb102-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-37"><a href="#cb102-37" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="bu">len</span>(selected_features) <span class="op">&lt;</span> <span class="bu">len</span>(feature_names):</span>
<span id="cb102-38"><a href="#cb102-38" aria-hidden="true" tabindex="-1"></a>    best_feature <span class="op">=</span> <span class="va">None</span></span>
<span id="cb102-39"><a href="#cb102-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> feature <span class="kw">in</span> feature_names:</span>
<span id="cb102-40"><a href="#cb102-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> feature <span class="kw">in</span> selected_features:</span>
<span id="cb102-41"><a href="#cb102-41" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb102-42"><a href="#cb102-42" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb102-43"><a href="#cb102-43" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Try adding this feature</span></span>
<span id="cb102-44"><a href="#cb102-44" aria-hidden="true" tabindex="-1"></a>        current_features <span class="op">=</span> selected_features <span class="op">+</span> [feature]</span>
<span id="cb102-45"><a href="#cb102-45" aria-hidden="true" tabindex="-1"></a>        X_subset <span class="op">=</span> X_resampled[current_features]</span>
<span id="cb102-46"><a href="#cb102-46" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb102-47"><a href="#cb102-47" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Use Balanced Bagging to balance class distribution</span></span>
<span id="cb102-48"><a href="#cb102-48" aria-hidden="true" tabindex="-1"></a>        model <span class="op">=</span> BalancedBaggingClassifier(</span>
<span id="cb102-49"><a href="#cb102-49" aria-hidden="true" tabindex="-1"></a>            estimator<span class="op">=</span>DecisionTreeClassifier(random_state<span class="op">=</span><span class="dv">42</span>, max_depth<span class="op">=</span><span class="va">None</span>),</span>
<span id="cb102-50"><a href="#cb102-50" aria-hidden="true" tabindex="-1"></a>            sampling_strategy<span class="op">=</span><span class="fl">1.0</span>,  <span class="co"># Ensure equal number of 0s and 1s</span></span>
<span id="cb102-51"><a href="#cb102-51" aria-hidden="true" tabindex="-1"></a>            random_state<span class="op">=</span><span class="dv">42</span>,</span>
<span id="cb102-52"><a href="#cb102-52" aria-hidden="true" tabindex="-1"></a>            n_estimators<span class="op">=</span><span class="dv">50</span>,  <span class="co"># Increase base estimators</span></span>
<span id="cb102-53"><a href="#cb102-53" aria-hidden="true" tabindex="-1"></a>            n_jobs<span class="op">=-</span><span class="dv">1</span>  <span class="co"># Use all CPU cores</span></span>
<span id="cb102-54"><a href="#cb102-54" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb102-55"><a href="#cb102-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-56"><a href="#cb102-56" aria-hidden="true" tabindex="-1"></a>        score <span class="op">=</span> np.mean(cross_val_score(model, X_subset, y_resampled, cv<span class="op">=</span><span class="dv">5</span>, scoring<span class="op">=</span><span class="st">'accuracy'</span>))</span>
<span id="cb102-57"><a href="#cb102-57" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb102-58"><a href="#cb102-58" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> score <span class="op">&gt;</span> best_score:</span>
<span id="cb102-59"><a href="#cb102-59" aria-hidden="true" tabindex="-1"></a>            best_score <span class="op">=</span> score</span>
<span id="cb102-60"><a href="#cb102-60" aria-hidden="true" tabindex="-1"></a>            best_feature <span class="op">=</span> feature</span>
<span id="cb102-61"><a href="#cb102-61" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb102-62"><a href="#cb102-62" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> best_feature <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb102-63"><a href="#cb102-63" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span>  <span class="co"># No improvement found</span></span>
<span id="cb102-64"><a href="#cb102-64" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb102-65"><a href="#cb102-65" aria-hidden="true" tabindex="-1"></a>    selected_features.append(best_feature)</span>
<span id="cb102-66"><a href="#cb102-66" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Added feature: </span><span class="sc">{</span>best_feature<span class="sc">}</span><span class="ss">, New score: </span><span class="sc">{</span>best_score<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb102-67"><a href="#cb102-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-68"><a href="#cb102-68" aria-hidden="true" tabindex="-1"></a><span class="co"># Train final balanced bagging model with selected features</span></span>
<span id="cb102-69"><a href="#cb102-69" aria-hidden="true" tabindex="-1"></a>final_model <span class="op">=</span> BalancedBaggingClassifier(</span>
<span id="cb102-70"><a href="#cb102-70" aria-hidden="true" tabindex="-1"></a>    estimator<span class="op">=</span>DecisionTreeClassifier(random_state<span class="op">=</span><span class="dv">42</span>, max_depth<span class="op">=</span><span class="va">None</span>),</span>
<span id="cb102-71"><a href="#cb102-71" aria-hidden="true" tabindex="-1"></a>    sampling_strategy<span class="op">=</span><span class="fl">1.0</span>,</span>
<span id="cb102-72"><a href="#cb102-72" aria-hidden="true" tabindex="-1"></a>    random_state<span class="op">=</span><span class="dv">42</span>,</span>
<span id="cb102-73"><a href="#cb102-73" aria-hidden="true" tabindex="-1"></a>    n_estimators<span class="op">=</span><span class="dv">50</span>,</span>
<span id="cb102-74"><a href="#cb102-74" aria-hidden="true" tabindex="-1"></a>    n_jobs<span class="op">=-</span><span class="dv">1</span></span>
<span id="cb102-75"><a href="#cb102-75" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb102-76"><a href="#cb102-76" aria-hidden="true" tabindex="-1"></a>final_model.fit(X_resampled[selected_features], y_resampled)</span>
<span id="cb102-77"><a href="#cb102-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-78"><a href="#cb102-78" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict on the training data</span></span>
<span id="cb102-79"><a href="#cb102-79" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> final_model.predict(X_resampled[selected_features])</span>
<span id="cb102-80"><a href="#cb102-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-81"><a href="#cb102-81" aria-hidden="true" tabindex="-1"></a><span class="co"># Count occurrences of 0s and 1s in the predicted labels</span></span>
<span id="cb102-82"><a href="#cb102-82" aria-hidden="true" tabindex="-1"></a>unique, counts <span class="op">=</span> np.unique(y_pred, return_counts<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb102-83"><a href="#cb102-83" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Final predicted class distribution:"</span>, <span class="bu">dict</span>(<span class="bu">zip</span>(unique, counts)))</span>
<span id="cb102-84"><a href="#cb102-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-85"><a href="#cb102-85" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Final selected feature order: </span><span class="sc">{</span>selected_features<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Balanced class distribution after undersampling: {'0.0': np.int64(155), '1.0': np.int64(155)}
Added feature: IndVomit_nan, New score: 0.8290
Final predicted class distribution: {'0.0': np.int64(106), '1.0': np.int64(204)}
Final selected feature order: ['IndVomit_nan']</code></pre>
</div>
</div>
<div id="e38225ef" class="cell" data-execution_count="107">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make predictions</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> final_model.predict(X[selected_features])</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute confusion matrix</span></span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>tn, fp, fn, tp <span class="op">=</span> confusion_matrix(y, y_pred).ravel()</span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute proportions</span></span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a>total_positives <span class="op">=</span> tp <span class="op">+</span> fn  <span class="co"># Actual Positives</span></span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a>total_negatives <span class="op">=</span> tn <span class="op">+</span> fp  <span class="co"># Actual Negatives</span></span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-11"><a href="#cb104-11" aria-hidden="true" tabindex="-1"></a>sensitivity <span class="op">=</span> tp <span class="op">/</span> total_positives <span class="cf">if</span> total_positives <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span>  <span class="co"># True Positive Rate (TPR)</span></span>
<span id="cb104-12"><a href="#cb104-12" aria-hidden="true" tabindex="-1"></a>specificity <span class="op">=</span> tn <span class="op">/</span> total_negatives <span class="cf">if</span> total_negatives <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span>  <span class="co"># True Negative Rate (TNR)</span></span>
<span id="cb104-13"><a href="#cb104-13" aria-hidden="true" tabindex="-1"></a>false_positive_rate <span class="op">=</span> fp <span class="op">/</span> total_negatives <span class="cf">if</span> total_negatives <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span>  <span class="co"># FPR</span></span>
<span id="cb104-14"><a href="#cb104-14" aria-hidden="true" tabindex="-1"></a>false_negative_rate <span class="op">=</span> fn <span class="op">/</span> total_positives <span class="cf">if</span> total_positives <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span>  <span class="co"># FNR</span></span>
<span id="cb104-15"><a href="#cb104-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-16"><a href="#cb104-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Print results</span></span>
<span id="cb104-17"><a href="#cb104-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"True Positives (TP): </span><span class="sc">{</span>tp<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>sensitivity<span class="sc">:.4f}</span><span class="ss"> of actual positives)"</span>)</span>
<span id="cb104-18"><a href="#cb104-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"True Negatives (TN): </span><span class="sc">{</span>tn<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>specificity<span class="sc">:.4f}</span><span class="ss"> of actual negatives)"</span>)</span>
<span id="cb104-19"><a href="#cb104-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"False Positives (FP): </span><span class="sc">{</span>fp<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>false_positive_rate<span class="sc">:.4f}</span><span class="ss"> of actual negatives)"</span>)</span>
<span id="cb104-20"><a href="#cb104-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"False Negatives (FN): </span><span class="sc">{</span>fn<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>false_negative_rate<span class="sc">:.4f}</span><span class="ss"> of actual positives)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>True Positives (TP): 153 (0.9871 of actual positives)
True Negatives (TN): 6918 (0.6437 of actual negatives)
False Positives (FP): 3830 (0.3563 of actual negatives)
False Negatives (FN): 2 (0.0129 of actual positives)</code></pre>
</div>
</div>
<p>Older than 2</p>
<div id="86b8afa8" class="cell" data-execution_count="108">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define candidate categorical features</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>candidate_features <span class="op">=</span> [<span class="st">'HadSeiz'</span>, <span class="st">'GCSEye'</span>, <span class="st">"VomitNbr"</span>, <span class="st">"VomitStart"</span>, <span class="st">"IndVomit"</span>, <span class="st">"VomitLast"</span>]</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>target_variable <span class="op">=</span> <span class="st">'PosIntFinal'</span></span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a><span class="co"># One-hot encode categorical variables</span></span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>df_encoded <span class="op">=</span> df_2_and_older.copy()</span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>df_encoded <span class="op">=</span> df_encoded.astype(<span class="bu">str</span>)  <span class="co"># Ensure all columns are string type for encoding</span></span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a>encoder <span class="op">=</span> OneHotEncoder(handle_unknown<span class="op">=</span><span class="st">'ignore'</span>, drop<span class="op">=</span><span class="st">'first'</span>, sparse_output<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply One-Hot Encoding</span></span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a>X_encoded <span class="op">=</span> encoder.fit_transform(df_encoded[candidate_features])</span>
<span id="cb106-12"><a href="#cb106-12" aria-hidden="true" tabindex="-1"></a>feature_names <span class="op">=</span> encoder.get_feature_names_out(candidate_features)</span>
<span id="cb106-13"><a href="#cb106-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-14"><a href="#cb106-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to DataFrame</span></span>
<span id="cb106-15"><a href="#cb106-15" aria-hidden="true" tabindex="-1"></a>X_encoded <span class="op">=</span> pd.DataFrame(X_encoded, columns<span class="op">=</span>feature_names, index<span class="op">=</span>df_encoded.index)</span>
<span id="cb106-16"><a href="#cb106-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-17"><a href="#cb106-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the encoded features to the dataset</span></span>
<span id="cb106-18"><a href="#cb106-18" aria-hidden="true" tabindex="-1"></a>df_encoded <span class="op">=</span> df_encoded.drop(columns<span class="op">=</span>candidate_features)  <span class="co"># Drop original categorical columns</span></span>
<span id="cb106-19"><a href="#cb106-19" aria-hidden="true" tabindex="-1"></a>df_encoded <span class="op">=</span> pd.concat([df_encoded, X_encoded], axis<span class="op">=</span><span class="dv">1</span>)  <span class="co"># Add encoded features</span></span>
<span id="cb106-20"><a href="#cb106-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-21"><a href="#cb106-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Define X and y</span></span>
<span id="cb106-22"><a href="#cb106-22" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df_encoded[feature_names]  <span class="co"># Use only one-hot encoded features</span></span>
<span id="cb106-23"><a href="#cb106-23" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df_encoded[target_variable]</span>
<span id="cb106-24"><a href="#cb106-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-25"><a href="#cb106-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply undersampling to balance classes</span></span>
<span id="cb106-26"><a href="#cb106-26" aria-hidden="true" tabindex="-1"></a>rus <span class="op">=</span> RandomUnderSampler(sampling_strategy<span class="op">=</span><span class="fl">1.0</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb106-27"><a href="#cb106-27" aria-hidden="true" tabindex="-1"></a>X_resampled, y_resampled <span class="op">=</span> rus.fit_resample(X, y)</span>
<span id="cb106-28"><a href="#cb106-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-29"><a href="#cb106-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the new class distribution</span></span>
<span id="cb106-30"><a href="#cb106-30" aria-hidden="true" tabindex="-1"></a>unique, counts <span class="op">=</span> np.unique(y_resampled, return_counts<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb106-31"><a href="#cb106-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Balanced class distribution after undersampling:"</span>, <span class="bu">dict</span>(<span class="bu">zip</span>(unique, counts)))</span>
<span id="cb106-32"><a href="#cb106-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-33"><a href="#cb106-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize greedy feature selection</span></span>
<span id="cb106-34"><a href="#cb106-34" aria-hidden="true" tabindex="-1"></a>selected_features <span class="op">=</span> []</span>
<span id="cb106-35"><a href="#cb106-35" aria-hidden="true" tabindex="-1"></a>best_score <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb106-36"><a href="#cb106-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-37"><a href="#cb106-37" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="bu">len</span>(selected_features) <span class="op">&lt;</span> <span class="bu">len</span>(feature_names):</span>
<span id="cb106-38"><a href="#cb106-38" aria-hidden="true" tabindex="-1"></a>    best_feature <span class="op">=</span> <span class="va">None</span></span>
<span id="cb106-39"><a href="#cb106-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> feature <span class="kw">in</span> feature_names:</span>
<span id="cb106-40"><a href="#cb106-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> feature <span class="kw">in</span> selected_features:</span>
<span id="cb106-41"><a href="#cb106-41" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb106-42"><a href="#cb106-42" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb106-43"><a href="#cb106-43" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Try adding this feature</span></span>
<span id="cb106-44"><a href="#cb106-44" aria-hidden="true" tabindex="-1"></a>        current_features <span class="op">=</span> selected_features <span class="op">+</span> [feature]</span>
<span id="cb106-45"><a href="#cb106-45" aria-hidden="true" tabindex="-1"></a>        X_subset <span class="op">=</span> X_resampled[current_features]</span>
<span id="cb106-46"><a href="#cb106-46" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb106-47"><a href="#cb106-47" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Use Balanced Bagging to balance class distribution</span></span>
<span id="cb106-48"><a href="#cb106-48" aria-hidden="true" tabindex="-1"></a>        model <span class="op">=</span> BalancedBaggingClassifier(</span>
<span id="cb106-49"><a href="#cb106-49" aria-hidden="true" tabindex="-1"></a>            estimator<span class="op">=</span>DecisionTreeClassifier(random_state<span class="op">=</span><span class="dv">42</span>, max_depth<span class="op">=</span><span class="va">None</span>),</span>
<span id="cb106-50"><a href="#cb106-50" aria-hidden="true" tabindex="-1"></a>            sampling_strategy<span class="op">=</span><span class="fl">1.0</span>,  <span class="co"># Ensure equal number of 0s and 1s</span></span>
<span id="cb106-51"><a href="#cb106-51" aria-hidden="true" tabindex="-1"></a>            random_state<span class="op">=</span><span class="dv">42</span>,</span>
<span id="cb106-52"><a href="#cb106-52" aria-hidden="true" tabindex="-1"></a>            n_estimators<span class="op">=</span><span class="dv">50</span>,  <span class="co"># Increase base estimators</span></span>
<span id="cb106-53"><a href="#cb106-53" aria-hidden="true" tabindex="-1"></a>            n_jobs<span class="op">=-</span><span class="dv">1</span>  <span class="co"># Use all CPU cores</span></span>
<span id="cb106-54"><a href="#cb106-54" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb106-55"><a href="#cb106-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-56"><a href="#cb106-56" aria-hidden="true" tabindex="-1"></a>        score <span class="op">=</span> np.mean(cross_val_score(model, X_subset, y_resampled, cv<span class="op">=</span><span class="dv">5</span>, scoring<span class="op">=</span><span class="st">'accuracy'</span>))</span>
<span id="cb106-57"><a href="#cb106-57" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb106-58"><a href="#cb106-58" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> score <span class="op">&gt;</span> best_score:</span>
<span id="cb106-59"><a href="#cb106-59" aria-hidden="true" tabindex="-1"></a>            best_score <span class="op">=</span> score</span>
<span id="cb106-60"><a href="#cb106-60" aria-hidden="true" tabindex="-1"></a>            best_feature <span class="op">=</span> feature</span>
<span id="cb106-61"><a href="#cb106-61" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb106-62"><a href="#cb106-62" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> best_feature <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb106-63"><a href="#cb106-63" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span>  <span class="co"># No improvement found</span></span>
<span id="cb106-64"><a href="#cb106-64" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb106-65"><a href="#cb106-65" aria-hidden="true" tabindex="-1"></a>    selected_features.append(best_feature)</span>
<span id="cb106-66"><a href="#cb106-66" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Added feature: </span><span class="sc">{</span>best_feature<span class="sc">}</span><span class="ss">, New score: </span><span class="sc">{</span>best_score<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb106-67"><a href="#cb106-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-68"><a href="#cb106-68" aria-hidden="true" tabindex="-1"></a><span class="co"># Train final balanced bagging model with selected features</span></span>
<span id="cb106-69"><a href="#cb106-69" aria-hidden="true" tabindex="-1"></a>final_model <span class="op">=</span> BalancedBaggingClassifier(</span>
<span id="cb106-70"><a href="#cb106-70" aria-hidden="true" tabindex="-1"></a>    estimator<span class="op">=</span>DecisionTreeClassifier(random_state<span class="op">=</span><span class="dv">42</span>, max_depth<span class="op">=</span><span class="va">None</span>),</span>
<span id="cb106-71"><a href="#cb106-71" aria-hidden="true" tabindex="-1"></a>    sampling_strategy<span class="op">=</span><span class="fl">1.0</span>,</span>
<span id="cb106-72"><a href="#cb106-72" aria-hidden="true" tabindex="-1"></a>    random_state<span class="op">=</span><span class="dv">42</span>,</span>
<span id="cb106-73"><a href="#cb106-73" aria-hidden="true" tabindex="-1"></a>    n_estimators<span class="op">=</span><span class="dv">50</span>,</span>
<span id="cb106-74"><a href="#cb106-74" aria-hidden="true" tabindex="-1"></a>    n_jobs<span class="op">=-</span><span class="dv">1</span></span>
<span id="cb106-75"><a href="#cb106-75" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb106-76"><a href="#cb106-76" aria-hidden="true" tabindex="-1"></a>final_model.fit(X_resampled[selected_features], y_resampled)</span>
<span id="cb106-77"><a href="#cb106-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-78"><a href="#cb106-78" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict on the training data</span></span>
<span id="cb106-79"><a href="#cb106-79" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> final_model.predict(X_resampled[selected_features])</span>
<span id="cb106-80"><a href="#cb106-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-81"><a href="#cb106-81" aria-hidden="true" tabindex="-1"></a><span class="co"># Count occurrences of 0s and 1s in the predicted labels</span></span>
<span id="cb106-82"><a href="#cb106-82" aria-hidden="true" tabindex="-1"></a>unique, counts <span class="op">=</span> np.unique(y_pred, return_counts<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb106-83"><a href="#cb106-83" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Final predicted class distribution:"</span>, <span class="bu">dict</span>(<span class="bu">zip</span>(unique, counts)))</span>
<span id="cb106-84"><a href="#cb106-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-85"><a href="#cb106-85" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Final selected feature order: </span><span class="sc">{</span>selected_features<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Balanced class distribution after undersampling: {'0.0': np.int64(611), '1.0': np.int64(611)}
Added feature: IndVomit_nan, New score: 0.7881
Final predicted class distribution: {'0.0': np.int64(372), '1.0': np.int64(850)}
Final selected feature order: ['IndVomit_nan']</code></pre>
</div>
</div>
<div id="91925df9" class="cell" data-execution_count="109">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make predictions</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> final_model.predict(X[selected_features])</span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute confusion matrix</span></span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>tn, fp, fn, tp <span class="op">=</span> confusion_matrix(y, y_pred).ravel()</span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute proportions</span></span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a>total_positives <span class="op">=</span> tp <span class="op">+</span> fn  <span class="co"># Actual Positives</span></span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a>total_negatives <span class="op">=</span> tn <span class="op">+</span> fp  <span class="co"># Actual Negatives</span></span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-11"><a href="#cb108-11" aria-hidden="true" tabindex="-1"></a>sensitivity <span class="op">=</span> tp <span class="op">/</span> total_positives <span class="cf">if</span> total_positives <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span>  <span class="co"># True Positive Rate (TPR)</span></span>
<span id="cb108-12"><a href="#cb108-12" aria-hidden="true" tabindex="-1"></a>specificity <span class="op">=</span> tn <span class="op">/</span> total_negatives <span class="cf">if</span> total_negatives <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span>  <span class="co"># True Negative Rate (TNR)</span></span>
<span id="cb108-13"><a href="#cb108-13" aria-hidden="true" tabindex="-1"></a>false_positive_rate <span class="op">=</span> fp <span class="op">/</span> total_negatives <span class="cf">if</span> total_negatives <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span>  <span class="co"># FPR</span></span>
<span id="cb108-14"><a href="#cb108-14" aria-hidden="true" tabindex="-1"></a>false_negative_rate <span class="op">=</span> fn <span class="op">/</span> total_positives <span class="cf">if</span> total_positives <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span>  <span class="co"># FNR</span></span>
<span id="cb108-15"><a href="#cb108-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-16"><a href="#cb108-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Print results</span></span>
<span id="cb108-17"><a href="#cb108-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"True Positives (TP): </span><span class="sc">{</span>tp<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>sensitivity<span class="sc">:.4f}</span><span class="ss"> of actual positives)"</span>)</span>
<span id="cb108-18"><a href="#cb108-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"True Negatives (TN): </span><span class="sc">{</span>tn<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>specificity<span class="sc">:.4f}</span><span class="ss"> of actual negatives)"</span>)</span>
<span id="cb108-19"><a href="#cb108-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"False Positives (FP): </span><span class="sc">{</span>fp<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>false_positive_rate<span class="sc">:.4f}</span><span class="ss"> of actual negatives)"</span>)</span>
<span id="cb108-20"><a href="#cb108-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"False Negatives (FN): </span><span class="sc">{</span>fn<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>false_negative_rate<span class="sc">:.4f}</span><span class="ss"> of actual positives)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>True Positives (TP): 601 (0.9836 of actual positives)
True Negatives (TN): 19542 (0.6132 of actual negatives)
False Positives (FP): 12326 (0.3868 of actual negatives)
False Negatives (FN): 10 (0.0164 of actual positives)</code></pre>
</div>
</div>
<p>This did not work well. Let us go back to keeping them in one group but let us remove the unknown indicators from our hot one encoding because they may be hard to interpret and may be meaningless, so splitting on them may not make sense.</p>
<div id="a82ddbb0" class="cell" data-execution_count="110">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define candidate categorical features</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>candidate_features <span class="op">=</span> [<span class="st">'HadSeiz'</span>, <span class="st">'GCSEye'</span>, <span class="st">"VomitNbr"</span>, <span class="st">"VomitStart"</span>, <span class="st">"IndVomit"</span>, <span class="st">"VomitLast"</span>]</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>target_variable <span class="op">=</span> <span class="st">'PosIntFinal'</span></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a><span class="co"># One-hot encode categorical variables</span></span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>df_encoded <span class="op">=</span> df_data.copy().astype(<span class="bu">str</span>)  <span class="co"># Ensure all columns are string type</span></span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a>encoder <span class="op">=</span> OneHotEncoder(handle_unknown<span class="op">=</span><span class="st">'ignore'</span>, drop<span class="op">=</span><span class="st">'first'</span>, sparse_output<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a>X_encoded <span class="op">=</span> encoder.fit_transform(df_encoded[candidate_features])</span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-10"><a href="#cb110-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Get feature names and convert to DataFrame</span></span>
<span id="cb110-11"><a href="#cb110-11" aria-hidden="true" tabindex="-1"></a>feature_names <span class="op">=</span> encoder.get_feature_names_out(candidate_features)</span>
<span id="cb110-12"><a href="#cb110-12" aria-hidden="true" tabindex="-1"></a>X_encoded <span class="op">=</span> pd.DataFrame(X_encoded, columns<span class="op">=</span>feature_names, index<span class="op">=</span>df_encoded.index)</span>
<span id="cb110-13"><a href="#cb110-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-14"><a href="#cb110-14" aria-hidden="true" tabindex="-1"></a><span class="co"># **Remove unwanted one-hot encoded columns**</span></span>
<span id="cb110-15"><a href="#cb110-15" aria-hidden="true" tabindex="-1"></a>columns_to_remove <span class="op">=</span> [<span class="st">'IndVomit_unknown'</span>, <span class="st">'HadSeiz_unknown'</span>, <span class="st">'GCSEye_nan'</span>, <span class="st">'VomitStart_unknown'</span>, <span class="st">'VomitLast_unknown'</span>, <span class="st">'VomitNbr_unknown'</span>, <span class="st">'HadSeiz_contradiction'</span>]</span>
<span id="cb110-16"><a href="#cb110-16" aria-hidden="true" tabindex="-1"></a>X_encoded <span class="op">=</span> X_encoded.drop(columns<span class="op">=</span>[col <span class="cf">for</span> col <span class="kw">in</span> columns_to_remove <span class="cf">if</span> col <span class="kw">in</span> X_encoded.columns], errors<span class="op">=</span><span class="st">'ignore'</span>)</span>
<span id="cb110-17"><a href="#cb110-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-18"><a href="#cb110-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop original categorical columns and add the encoded ones</span></span>
<span id="cb110-19"><a href="#cb110-19" aria-hidden="true" tabindex="-1"></a>df_encoded <span class="op">=</span> df_encoded.drop(columns<span class="op">=</span>candidate_features, errors<span class="op">=</span><span class="st">'ignore'</span>)</span>
<span id="cb110-20"><a href="#cb110-20" aria-hidden="true" tabindex="-1"></a>df_encoded <span class="op">=</span> pd.concat([df_encoded, X_encoded], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb110-21"><a href="#cb110-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-22"><a href="#cb110-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Define X and y</span></span>
<span id="cb110-23"><a href="#cb110-23" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df_encoded[X_encoded.columns]  <span class="co"># Use only one-hot encoded features</span></span>
<span id="cb110-24"><a href="#cb110-24" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df_encoded[target_variable]</span>
<span id="cb110-25"><a href="#cb110-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-26"><a href="#cb110-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply undersampling to balance classes</span></span>
<span id="cb110-27"><a href="#cb110-27" aria-hidden="true" tabindex="-1"></a>rus <span class="op">=</span> RandomUnderSampler(sampling_strategy<span class="op">=</span><span class="fl">1.0</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb110-28"><a href="#cb110-28" aria-hidden="true" tabindex="-1"></a>X_resampled, y_resampled <span class="op">=</span> rus.fit_resample(X, y)</span>
<span id="cb110-29"><a href="#cb110-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-30"><a href="#cb110-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the new class distribution</span></span>
<span id="cb110-31"><a href="#cb110-31" aria-hidden="true" tabindex="-1"></a>unique, counts <span class="op">=</span> np.unique(y_resampled, return_counts<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb110-32"><a href="#cb110-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Balanced class distribution after undersampling:"</span>, <span class="bu">dict</span>(<span class="bu">zip</span>(unique, counts)))</span>
<span id="cb110-33"><a href="#cb110-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-34"><a href="#cb110-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize greedy feature selection</span></span>
<span id="cb110-35"><a href="#cb110-35" aria-hidden="true" tabindex="-1"></a>selected_features <span class="op">=</span> []</span>
<span id="cb110-36"><a href="#cb110-36" aria-hidden="true" tabindex="-1"></a>best_score <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb110-37"><a href="#cb110-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-38"><a href="#cb110-38" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="bu">len</span>(selected_features) <span class="op">&lt;</span> <span class="bu">len</span>(X_encoded.columns):</span>
<span id="cb110-39"><a href="#cb110-39" aria-hidden="true" tabindex="-1"></a>    best_feature <span class="op">=</span> <span class="va">None</span></span>
<span id="cb110-40"><a href="#cb110-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> feature <span class="kw">in</span> X_encoded.columns:</span>
<span id="cb110-41"><a href="#cb110-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> feature <span class="kw">in</span> selected_features:</span>
<span id="cb110-42"><a href="#cb110-42" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb110-43"><a href="#cb110-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-44"><a href="#cb110-44" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Try adding this feature</span></span>
<span id="cb110-45"><a href="#cb110-45" aria-hidden="true" tabindex="-1"></a>        current_features <span class="op">=</span> selected_features <span class="op">+</span> [feature]</span>
<span id="cb110-46"><a href="#cb110-46" aria-hidden="true" tabindex="-1"></a>        X_subset <span class="op">=</span> X_resampled[current_features]</span>
<span id="cb110-47"><a href="#cb110-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-48"><a href="#cb110-48" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Use Balanced Bagging to balance class distribution</span></span>
<span id="cb110-49"><a href="#cb110-49" aria-hidden="true" tabindex="-1"></a>        model <span class="op">=</span> BalancedBaggingClassifier(</span>
<span id="cb110-50"><a href="#cb110-50" aria-hidden="true" tabindex="-1"></a>            estimator<span class="op">=</span>DecisionTreeClassifier(random_state<span class="op">=</span><span class="dv">42</span>, max_depth<span class="op">=</span><span class="va">None</span>),</span>
<span id="cb110-51"><a href="#cb110-51" aria-hidden="true" tabindex="-1"></a>            sampling_strategy<span class="op">=</span><span class="fl">1.0</span>,</span>
<span id="cb110-52"><a href="#cb110-52" aria-hidden="true" tabindex="-1"></a>            random_state<span class="op">=</span><span class="dv">42</span>,</span>
<span id="cb110-53"><a href="#cb110-53" aria-hidden="true" tabindex="-1"></a>            n_estimators<span class="op">=</span><span class="dv">50</span>,</span>
<span id="cb110-54"><a href="#cb110-54" aria-hidden="true" tabindex="-1"></a>            n_jobs<span class="op">=-</span><span class="dv">1</span></span>
<span id="cb110-55"><a href="#cb110-55" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb110-56"><a href="#cb110-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-57"><a href="#cb110-57" aria-hidden="true" tabindex="-1"></a>        score <span class="op">=</span> np.mean(cross_val_score(model, X_subset, y_resampled, cv<span class="op">=</span><span class="dv">5</span>, scoring<span class="op">=</span><span class="st">'accuracy'</span>))</span>
<span id="cb110-58"><a href="#cb110-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-59"><a href="#cb110-59" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> score <span class="op">&gt;</span> best_score:</span>
<span id="cb110-60"><a href="#cb110-60" aria-hidden="true" tabindex="-1"></a>            best_score <span class="op">=</span> score</span>
<span id="cb110-61"><a href="#cb110-61" aria-hidden="true" tabindex="-1"></a>            best_feature <span class="op">=</span> feature</span>
<span id="cb110-62"><a href="#cb110-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-63"><a href="#cb110-63" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> best_feature <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb110-64"><a href="#cb110-64" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span>  <span class="co"># No improvement found</span></span>
<span id="cb110-65"><a href="#cb110-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-66"><a href="#cb110-66" aria-hidden="true" tabindex="-1"></a>    selected_features.append(best_feature)</span>
<span id="cb110-67"><a href="#cb110-67" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Added feature: </span><span class="sc">{</span>best_feature<span class="sc">}</span><span class="ss">, New score: </span><span class="sc">{</span>best_score<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb110-68"><a href="#cb110-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-69"><a href="#cb110-69" aria-hidden="true" tabindex="-1"></a><span class="co"># Train final balanced bagging model with selected features</span></span>
<span id="cb110-70"><a href="#cb110-70" aria-hidden="true" tabindex="-1"></a>final_model <span class="op">=</span> BalancedBaggingClassifier(</span>
<span id="cb110-71"><a href="#cb110-71" aria-hidden="true" tabindex="-1"></a>    estimator<span class="op">=</span>DecisionTreeClassifier(random_state<span class="op">=</span><span class="dv">42</span>, max_depth<span class="op">=</span><span class="va">None</span>),</span>
<span id="cb110-72"><a href="#cb110-72" aria-hidden="true" tabindex="-1"></a>    sampling_strategy<span class="op">=</span><span class="fl">1.0</span>,</span>
<span id="cb110-73"><a href="#cb110-73" aria-hidden="true" tabindex="-1"></a>    random_state<span class="op">=</span><span class="dv">42</span>,</span>
<span id="cb110-74"><a href="#cb110-74" aria-hidden="true" tabindex="-1"></a>    n_estimators<span class="op">=</span><span class="dv">50</span>,</span>
<span id="cb110-75"><a href="#cb110-75" aria-hidden="true" tabindex="-1"></a>    n_jobs<span class="op">=-</span><span class="dv">1</span></span>
<span id="cb110-76"><a href="#cb110-76" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb110-77"><a href="#cb110-77" aria-hidden="true" tabindex="-1"></a>final_model.fit(X_resampled[selected_features], y_resampled)</span>
<span id="cb110-78"><a href="#cb110-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-79"><a href="#cb110-79" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict on the training data</span></span>
<span id="cb110-80"><a href="#cb110-80" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> final_model.predict(X_resampled[selected_features])</span>
<span id="cb110-81"><a href="#cb110-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-82"><a href="#cb110-82" aria-hidden="true" tabindex="-1"></a><span class="co"># Count occurrences of 0s and 1s in the predicted labels</span></span>
<span id="cb110-83"><a href="#cb110-83" aria-hidden="true" tabindex="-1"></a>unique, counts <span class="op">=</span> np.unique(y_pred, return_counts<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb110-84"><a href="#cb110-84" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Final predicted class distribution:"</span>, <span class="bu">dict</span>(<span class="bu">zip</span>(unique, counts)))</span>
<span id="cb110-85"><a href="#cb110-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-86"><a href="#cb110-86" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Final selected feature order: </span><span class="sc">{</span>selected_features<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Balanced class distribution after undersampling: {'0.0': np.int64(766), '1.0': np.int64(766)}
Added feature: IndVomit_nan, New score: 0.7931
Added feature: HadSeiz_nan, New score: 0.7944
Added feature: GCSEye_4.0, New score: 0.7964
Final predicted class distribution: {'0.0': np.int64(464), '1.0': np.int64(1068)}
Final selected feature order: ['IndVomit_nan', 'HadSeiz_nan', 'GCSEye_4.0']</code></pre>
</div>
</div>
<div id="d79bf40a" class="cell" data-execution_count="111">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make predictions</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> final_model.predict(X[selected_features])</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute confusion matrix</span></span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>tn, fp, fn, tp <span class="op">=</span> confusion_matrix(y, y_pred).ravel()</span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute proportions</span></span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a>total_positives <span class="op">=</span> tp <span class="op">+</span> fn  <span class="co"># Actual Positives</span></span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a>total_negatives <span class="op">=</span> tn <span class="op">+</span> fp  <span class="co"># Actual Negatives</span></span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-11"><a href="#cb112-11" aria-hidden="true" tabindex="-1"></a>sensitivity <span class="op">=</span> tp <span class="op">/</span> total_positives <span class="cf">if</span> total_positives <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span>  <span class="co"># True Positive Rate (TPR)</span></span>
<span id="cb112-12"><a href="#cb112-12" aria-hidden="true" tabindex="-1"></a>specificity <span class="op">=</span> tn <span class="op">/</span> total_negatives <span class="cf">if</span> total_negatives <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span>  <span class="co"># True Negative Rate (TNR)</span></span>
<span id="cb112-13"><a href="#cb112-13" aria-hidden="true" tabindex="-1"></a>false_positive_rate <span class="op">=</span> fp <span class="op">/</span> total_negatives <span class="cf">if</span> total_negatives <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span>  <span class="co"># FPR</span></span>
<span id="cb112-14"><a href="#cb112-14" aria-hidden="true" tabindex="-1"></a>false_negative_rate <span class="op">=</span> fn <span class="op">/</span> total_positives <span class="cf">if</span> total_positives <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span>  <span class="co"># FNR</span></span>
<span id="cb112-15"><a href="#cb112-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-16"><a href="#cb112-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Print results</span></span>
<span id="cb112-17"><a href="#cb112-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"True Positives (TP): </span><span class="sc">{</span>tp<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>sensitivity<span class="sc">:.4f}</span><span class="ss"> of actual positives)"</span>)</span>
<span id="cb112-18"><a href="#cb112-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"True Negatives (TN): </span><span class="sc">{</span>tn<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>specificity<span class="sc">:.4f}</span><span class="ss"> of actual negatives)"</span>)</span>
<span id="cb112-19"><a href="#cb112-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"False Positives (FP): </span><span class="sc">{</span>fp<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>false_positive_rate<span class="sc">:.4f}</span><span class="ss"> of actual negatives)"</span>)</span>
<span id="cb112-20"><a href="#cb112-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"False Negatives (FN): </span><span class="sc">{</span>fn<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>false_negative_rate<span class="sc">:.4f}</span><span class="ss"> of actual positives)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>True Positives (TP): 761 (0.9935 of actual positives)
True Negatives (TN): 26438 (0.6204 of actual negatives)
False Positives (FP): 16178 (0.3796 of actual negatives)
False Negatives (FN): 5 (0.0065 of actual positives)</code></pre>
</div>
</div>
<p>False positives are lower, but true positives are also lower. Let us add more features based on paper. We can remove any NaN or unknown values if we split on them since it is hard to interpret why they are NaN or 92.</p>
<div id="d447bc63" class="cell" data-execution_count="112">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define candidate categorical features</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>candidate_features <span class="op">=</span> [<span class="st">'HadSeiz'</span>, <span class="st">'GCSEye'</span>, <span class="st">"VomitNbr"</span>, <span class="st">"VomitStart"</span>, <span class="st">"IndVomit"</span>, <span class="st">"VomitLast"</span>, <span class="st">'SFxBas'</span>, <span class="st">'SFxPalp'</span>, <span class="st">'AMS'</span>, <span class="st">'LOCSeparate'</span>, <span class="st">'Vomit'</span>, <span class="st">'LocLen'</span>, <span class="st">'High_impact_InjSev'</span>, <span class="st">'HA_verb'</span>, <span class="st">'HASeverity'</span>, <span class="st">'ActNorm'</span>]</span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>target_variable <span class="op">=</span> <span class="st">'PosIntFinal'</span></span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a><span class="co"># One-hot encode categorical variables</span></span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a>df_encoded <span class="op">=</span> df_data.copy().astype(<span class="bu">str</span>)  <span class="co"># Ensure all columns are string type</span></span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a>encoder <span class="op">=</span> OneHotEncoder(handle_unknown<span class="op">=</span><span class="st">'ignore'</span>, drop<span class="op">=</span><span class="st">'first'</span>, sparse_output<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a>X_encoded <span class="op">=</span> encoder.fit_transform(df_encoded[candidate_features])</span>
<span id="cb114-9"><a href="#cb114-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-10"><a href="#cb114-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Get feature names and convert to DataFrame</span></span>
<span id="cb114-11"><a href="#cb114-11" aria-hidden="true" tabindex="-1"></a>feature_names <span class="op">=</span> encoder.get_feature_names_out(candidate_features)</span>
<span id="cb114-12"><a href="#cb114-12" aria-hidden="true" tabindex="-1"></a>X_encoded <span class="op">=</span> pd.DataFrame(X_encoded, columns<span class="op">=</span>feature_names, index<span class="op">=</span>df_encoded.index)</span>
<span id="cb114-13"><a href="#cb114-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-14"><a href="#cb114-14" aria-hidden="true" tabindex="-1"></a><span class="co"># **Remove unwanted one-hot encoded columns**</span></span>
<span id="cb114-15"><a href="#cb114-15" aria-hidden="true" tabindex="-1"></a>columns_to_remove <span class="op">=</span> [<span class="st">'IndVomit_unknown'</span>, <span class="st">'HadSeiz_unknown'</span>, <span class="st">'GCSEye_nan'</span>, <span class="st">'VomitStart_unknown'</span>, <span class="st">'VomitLast_unknown'</span>, <span class="st">'VomitNbr_unknown'</span>, <span class="st">'HadSeiz_contradiction'</span>]</span>
<span id="cb114-16"><a href="#cb114-16" aria-hidden="true" tabindex="-1"></a>X_encoded <span class="op">=</span> X_encoded.drop(columns<span class="op">=</span>[col <span class="cf">for</span> col <span class="kw">in</span> columns_to_remove <span class="cf">if</span> col <span class="kw">in</span> X_encoded.columns], errors<span class="op">=</span><span class="st">'ignore'</span>)</span>
<span id="cb114-17"><a href="#cb114-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-18"><a href="#cb114-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop original categorical columns and add the encoded ones</span></span>
<span id="cb114-19"><a href="#cb114-19" aria-hidden="true" tabindex="-1"></a>df_encoded <span class="op">=</span> df_encoded.drop(columns<span class="op">=</span>candidate_features, errors<span class="op">=</span><span class="st">'ignore'</span>)</span>
<span id="cb114-20"><a href="#cb114-20" aria-hidden="true" tabindex="-1"></a>df_encoded <span class="op">=</span> pd.concat([df_encoded, X_encoded], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb114-21"><a href="#cb114-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-22"><a href="#cb114-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Define X and y</span></span>
<span id="cb114-23"><a href="#cb114-23" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df_encoded[X_encoded.columns]  <span class="co"># Use only one-hot encoded features</span></span>
<span id="cb114-24"><a href="#cb114-24" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df_encoded[target_variable]</span>
<span id="cb114-25"><a href="#cb114-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-26"><a href="#cb114-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply undersampling to balance classes</span></span>
<span id="cb114-27"><a href="#cb114-27" aria-hidden="true" tabindex="-1"></a>rus <span class="op">=</span> RandomUnderSampler(sampling_strategy<span class="op">=</span><span class="fl">1.0</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb114-28"><a href="#cb114-28" aria-hidden="true" tabindex="-1"></a>X_resampled, y_resampled <span class="op">=</span> rus.fit_resample(X, y)</span>
<span id="cb114-29"><a href="#cb114-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-30"><a href="#cb114-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the new class distribution</span></span>
<span id="cb114-31"><a href="#cb114-31" aria-hidden="true" tabindex="-1"></a>unique, counts <span class="op">=</span> np.unique(y_resampled, return_counts<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb114-32"><a href="#cb114-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Balanced class distribution after undersampling:"</span>, <span class="bu">dict</span>(<span class="bu">zip</span>(unique, counts)))</span>
<span id="cb114-33"><a href="#cb114-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-34"><a href="#cb114-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize greedy feature selection</span></span>
<span id="cb114-35"><a href="#cb114-35" aria-hidden="true" tabindex="-1"></a>selected_features <span class="op">=</span> []</span>
<span id="cb114-36"><a href="#cb114-36" aria-hidden="true" tabindex="-1"></a>best_score <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb114-37"><a href="#cb114-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-38"><a href="#cb114-38" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="bu">len</span>(selected_features) <span class="op">&lt;</span> <span class="bu">len</span>(X_encoded.columns):</span>
<span id="cb114-39"><a href="#cb114-39" aria-hidden="true" tabindex="-1"></a>    best_feature <span class="op">=</span> <span class="va">None</span></span>
<span id="cb114-40"><a href="#cb114-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> feature <span class="kw">in</span> X_encoded.columns:</span>
<span id="cb114-41"><a href="#cb114-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> feature <span class="kw">in</span> selected_features:</span>
<span id="cb114-42"><a href="#cb114-42" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb114-43"><a href="#cb114-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-44"><a href="#cb114-44" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Try adding this feature</span></span>
<span id="cb114-45"><a href="#cb114-45" aria-hidden="true" tabindex="-1"></a>        current_features <span class="op">=</span> selected_features <span class="op">+</span> [feature]</span>
<span id="cb114-46"><a href="#cb114-46" aria-hidden="true" tabindex="-1"></a>        X_subset <span class="op">=</span> X_resampled[current_features]</span>
<span id="cb114-47"><a href="#cb114-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-48"><a href="#cb114-48" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Use Balanced Bagging to balance class distribution</span></span>
<span id="cb114-49"><a href="#cb114-49" aria-hidden="true" tabindex="-1"></a>        model <span class="op">=</span> BalancedBaggingClassifier(</span>
<span id="cb114-50"><a href="#cb114-50" aria-hidden="true" tabindex="-1"></a>            estimator<span class="op">=</span>DecisionTreeClassifier(random_state<span class="op">=</span><span class="dv">42</span>, max_depth<span class="op">=</span><span class="va">None</span>),</span>
<span id="cb114-51"><a href="#cb114-51" aria-hidden="true" tabindex="-1"></a>            sampling_strategy<span class="op">=</span><span class="fl">1.0</span>,</span>
<span id="cb114-52"><a href="#cb114-52" aria-hidden="true" tabindex="-1"></a>            random_state<span class="op">=</span><span class="dv">42</span>,</span>
<span id="cb114-53"><a href="#cb114-53" aria-hidden="true" tabindex="-1"></a>            n_estimators<span class="op">=</span><span class="dv">50</span>,</span>
<span id="cb114-54"><a href="#cb114-54" aria-hidden="true" tabindex="-1"></a>            n_jobs<span class="op">=-</span><span class="dv">1</span></span>
<span id="cb114-55"><a href="#cb114-55" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb114-56"><a href="#cb114-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-57"><a href="#cb114-57" aria-hidden="true" tabindex="-1"></a>        score <span class="op">=</span> np.mean(cross_val_score(model, X_subset, y_resampled, cv<span class="op">=</span><span class="dv">5</span>, scoring<span class="op">=</span><span class="st">'accuracy'</span>))</span>
<span id="cb114-58"><a href="#cb114-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-59"><a href="#cb114-59" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> score <span class="op">&gt;</span> best_score:</span>
<span id="cb114-60"><a href="#cb114-60" aria-hidden="true" tabindex="-1"></a>            best_score <span class="op">=</span> score</span>
<span id="cb114-61"><a href="#cb114-61" aria-hidden="true" tabindex="-1"></a>            best_feature <span class="op">=</span> feature</span>
<span id="cb114-62"><a href="#cb114-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-63"><a href="#cb114-63" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> best_feature <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb114-64"><a href="#cb114-64" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span>  <span class="co"># No improvement found</span></span>
<span id="cb114-65"><a href="#cb114-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-66"><a href="#cb114-66" aria-hidden="true" tabindex="-1"></a>    selected_features.append(best_feature)</span>
<span id="cb114-67"><a href="#cb114-67" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Added feature: </span><span class="sc">{</span>best_feature<span class="sc">}</span><span class="ss">, New score: </span><span class="sc">{</span>best_score<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb114-68"><a href="#cb114-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-69"><a href="#cb114-69" aria-hidden="true" tabindex="-1"></a><span class="co"># Train final balanced bagging model with selected features</span></span>
<span id="cb114-70"><a href="#cb114-70" aria-hidden="true" tabindex="-1"></a>final_model <span class="op">=</span> BalancedBaggingClassifier(</span>
<span id="cb114-71"><a href="#cb114-71" aria-hidden="true" tabindex="-1"></a>    estimator<span class="op">=</span>DecisionTreeClassifier(random_state<span class="op">=</span><span class="dv">42</span>, max_depth<span class="op">=</span><span class="va">None</span>),</span>
<span id="cb114-72"><a href="#cb114-72" aria-hidden="true" tabindex="-1"></a>    sampling_strategy<span class="op">=</span><span class="fl">1.0</span>,</span>
<span id="cb114-73"><a href="#cb114-73" aria-hidden="true" tabindex="-1"></a>    random_state<span class="op">=</span><span class="dv">42</span>,</span>
<span id="cb114-74"><a href="#cb114-74" aria-hidden="true" tabindex="-1"></a>    n_estimators<span class="op">=</span><span class="dv">50</span>,</span>
<span id="cb114-75"><a href="#cb114-75" aria-hidden="true" tabindex="-1"></a>    n_jobs<span class="op">=-</span><span class="dv">1</span></span>
<span id="cb114-76"><a href="#cb114-76" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb114-77"><a href="#cb114-77" aria-hidden="true" tabindex="-1"></a>final_model.fit(X_resampled[selected_features], y_resampled)</span>
<span id="cb114-78"><a href="#cb114-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-79"><a href="#cb114-79" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict on the training data</span></span>
<span id="cb114-80"><a href="#cb114-80" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> final_model.predict(X_resampled[selected_features])</span>
<span id="cb114-81"><a href="#cb114-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-82"><a href="#cb114-82" aria-hidden="true" tabindex="-1"></a><span class="co"># Count occurrences of 0s and 1s in the predicted labels</span></span>
<span id="cb114-83"><a href="#cb114-83" aria-hidden="true" tabindex="-1"></a>unique, counts <span class="op">=</span> np.unique(y_pred, return_counts<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb114-84"><a href="#cb114-84" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Final predicted class distribution:"</span>, <span class="bu">dict</span>(<span class="bu">zip</span>(unique, counts)))</span>
<span id="cb114-85"><a href="#cb114-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-86"><a href="#cb114-86" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Final selected feature order: </span><span class="sc">{</span>selected_features<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Balanced class distribution after undersampling: {'0.0': np.int64(766), '1.0': np.int64(766)}
Added feature: AMS_1.0, New score: 0.8290
Added feature: SFxBas_1.0, New score: 0.8401
Added feature: SFxPalp_1.0, New score: 0.8473
Added feature: SFxPalp_2.0, New score: 0.8519
Added feature: IndVomit_nan, New score: 0.8577
Added feature: ActNorm_nan, New score: 0.8623
Added feature: LocLen_4.0, New score: 0.8656
Added feature: HASeverity_nan, New score: 0.8669
Added feature: LOCSeparate_1.0, New score: 0.8688
Final predicted class distribution: {'0.0': np.int64(713), '1.0': np.int64(819)}
Final selected feature order: ['AMS_1.0', 'SFxBas_1.0', 'SFxPalp_1.0', 'SFxPalp_2.0', 'IndVomit_nan', 'ActNorm_nan', 'LocLen_4.0', 'HASeverity_nan', 'LOCSeparate_1.0']</code></pre>
</div>
</div>
<div id="27b391b1" class="cell" data-execution_count="113">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make predictions</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> final_model.predict(X[selected_features])</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute confusion matrix</span></span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>tn, fp, fn, tp <span class="op">=</span> confusion_matrix(y, y_pred).ravel()</span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute proportions</span></span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a>total_positives <span class="op">=</span> tp <span class="op">+</span> fn  <span class="co"># Actual Positives</span></span>
<span id="cb116-9"><a href="#cb116-9" aria-hidden="true" tabindex="-1"></a>total_negatives <span class="op">=</span> tn <span class="op">+</span> fp  <span class="co"># Actual Negatives</span></span>
<span id="cb116-10"><a href="#cb116-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-11"><a href="#cb116-11" aria-hidden="true" tabindex="-1"></a>sensitivity <span class="op">=</span> tp <span class="op">/</span> total_positives <span class="cf">if</span> total_positives <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span>  <span class="co"># True Positive Rate (TPR)</span></span>
<span id="cb116-12"><a href="#cb116-12" aria-hidden="true" tabindex="-1"></a>specificity <span class="op">=</span> tn <span class="op">/</span> total_negatives <span class="cf">if</span> total_negatives <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span>  <span class="co"># True Negative Rate (TNR)</span></span>
<span id="cb116-13"><a href="#cb116-13" aria-hidden="true" tabindex="-1"></a>false_positive_rate <span class="op">=</span> fp <span class="op">/</span> total_negatives <span class="cf">if</span> total_negatives <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span>  <span class="co"># FPR</span></span>
<span id="cb116-14"><a href="#cb116-14" aria-hidden="true" tabindex="-1"></a>false_negative_rate <span class="op">=</span> fn <span class="op">/</span> total_positives <span class="cf">if</span> total_positives <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span>  <span class="co"># FNR</span></span>
<span id="cb116-15"><a href="#cb116-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-16"><a href="#cb116-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Print results</span></span>
<span id="cb116-17"><a href="#cb116-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"True Positives (TP): </span><span class="sc">{</span>tp<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>sensitivity<span class="sc">:.4f}</span><span class="ss"> of actual positives)"</span>)</span>
<span id="cb116-18"><a href="#cb116-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"True Negatives (TN): </span><span class="sc">{</span>tn<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>specificity<span class="sc">:.4f}</span><span class="ss"> of actual negatives)"</span>)</span>
<span id="cb116-19"><a href="#cb116-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"False Positives (FP): </span><span class="sc">{</span>fp<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>false_positive_rate<span class="sc">:.4f}</span><span class="ss"> of actual negatives)"</span>)</span>
<span id="cb116-20"><a href="#cb116-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"False Negatives (FN): </span><span class="sc">{</span>fn<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>false_negative_rate<span class="sc">:.4f}</span><span class="ss"> of actual positives)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>True Positives (TP): 694 (0.9060 of actual positives)
True Negatives (TN): 35566 (0.8346 of actual negatives)
False Positives (FP): 7050 (0.1654 of actual negatives)
False Negatives (FN): 72 (0.0940 of actual positives)</code></pre>
</div>
</div>
<div id="70a4c572" class="cell" data-execution_count="114">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define candidate categorical features</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>candidate_features <span class="op">=</span> [<span class="st">'HadSeiz'</span>, <span class="st">'GCSEye'</span>, <span class="st">"VomitNbr"</span>, <span class="st">"VomitStart"</span>, <span class="st">"IndVomit"</span>, <span class="st">"VomitLast"</span>, <span class="st">'SFxBas'</span>, <span class="st">'SFxPalp'</span>, <span class="st">'AMS'</span>, <span class="st">'LOCSeparate'</span>, <span class="st">'Vomit'</span>, <span class="st">'LocLen'</span>, <span class="st">'High_impact_InjSev'</span>, <span class="st">'HA_verb'</span>, <span class="st">'HASeverity'</span>, <span class="st">'ActNorm'</span>]</span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>target_variable <span class="op">=</span> <span class="st">'PosIntFinal'</span></span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a><span class="co"># One-hot encode categorical variables</span></span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a>df_encoded <span class="op">=</span> df_data.copy().astype(<span class="bu">str</span>)  <span class="co"># Ensure all columns are string type</span></span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>encoder <span class="op">=</span> OneHotEncoder(handle_unknown<span class="op">=</span><span class="st">'ignore'</span>, drop<span class="op">=</span><span class="st">'first'</span>, sparse_output<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a>X_encoded <span class="op">=</span> encoder.fit_transform(df_encoded[candidate_features])</span>
<span id="cb118-9"><a href="#cb118-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-10"><a href="#cb118-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Get feature names and convert to DataFrame</span></span>
<span id="cb118-11"><a href="#cb118-11" aria-hidden="true" tabindex="-1"></a>feature_names <span class="op">=</span> encoder.get_feature_names_out(candidate_features)</span>
<span id="cb118-12"><a href="#cb118-12" aria-hidden="true" tabindex="-1"></a>X_encoded <span class="op">=</span> pd.DataFrame(X_encoded, columns<span class="op">=</span>feature_names, index<span class="op">=</span>df_encoded.index)</span>
<span id="cb118-13"><a href="#cb118-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-14"><a href="#cb118-14" aria-hidden="true" tabindex="-1"></a><span class="co"># **Remove unwanted one-hot encoded columns**</span></span>
<span id="cb118-15"><a href="#cb118-15" aria-hidden="true" tabindex="-1"></a>columns_to_remove <span class="op">=</span> []</span>
<span id="cb118-16"><a href="#cb118-16" aria-hidden="true" tabindex="-1"></a><span class="co">#columns_to_remove = ['IndVomit_unknown', 'HadSeiz_unknown', 'GCSEye_nan', 'VomitStart_unknown', 'VomitLast_unknown', 'VomitNbr_unknown', 'HadSeiz_contradiction']</span></span>
<span id="cb118-17"><a href="#cb118-17" aria-hidden="true" tabindex="-1"></a>X_encoded <span class="op">=</span> X_encoded.drop(columns<span class="op">=</span>[col <span class="cf">for</span> col <span class="kw">in</span> columns_to_remove <span class="cf">if</span> col <span class="kw">in</span> X_encoded.columns], errors<span class="op">=</span><span class="st">'ignore'</span>)</span>
<span id="cb118-18"><a href="#cb118-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-19"><a href="#cb118-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop original categorical columns and add the encoded ones</span></span>
<span id="cb118-20"><a href="#cb118-20" aria-hidden="true" tabindex="-1"></a>df_encoded <span class="op">=</span> df_encoded.drop(columns<span class="op">=</span>candidate_features, errors<span class="op">=</span><span class="st">'ignore'</span>)</span>
<span id="cb118-21"><a href="#cb118-21" aria-hidden="true" tabindex="-1"></a>df_encoded <span class="op">=</span> pd.concat([df_encoded, X_encoded], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb118-22"><a href="#cb118-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-23"><a href="#cb118-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Define X and y</span></span>
<span id="cb118-24"><a href="#cb118-24" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df_encoded[X_encoded.columns]  <span class="co"># Use only one-hot encoded features</span></span>
<span id="cb118-25"><a href="#cb118-25" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df_encoded[target_variable]</span>
<span id="cb118-26"><a href="#cb118-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-27"><a href="#cb118-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply undersampling to balance classes</span></span>
<span id="cb118-28"><a href="#cb118-28" aria-hidden="true" tabindex="-1"></a>rus <span class="op">=</span> RandomUnderSampler(sampling_strategy<span class="op">=</span><span class="fl">1.0</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb118-29"><a href="#cb118-29" aria-hidden="true" tabindex="-1"></a>X_resampled, y_resampled <span class="op">=</span> rus.fit_resample(X, y)</span>
<span id="cb118-30"><a href="#cb118-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-31"><a href="#cb118-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the new class distribution</span></span>
<span id="cb118-32"><a href="#cb118-32" aria-hidden="true" tabindex="-1"></a>unique, counts <span class="op">=</span> np.unique(y_resampled, return_counts<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb118-33"><a href="#cb118-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Balanced class distribution after undersampling:"</span>, <span class="bu">dict</span>(<span class="bu">zip</span>(unique, counts)))</span>
<span id="cb118-34"><a href="#cb118-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-35"><a href="#cb118-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize greedy feature selection</span></span>
<span id="cb118-36"><a href="#cb118-36" aria-hidden="true" tabindex="-1"></a>selected_features <span class="op">=</span> []</span>
<span id="cb118-37"><a href="#cb118-37" aria-hidden="true" tabindex="-1"></a>best_score <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb118-38"><a href="#cb118-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-39"><a href="#cb118-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to force specific splits</span></span>
<span id="cb118-40"><a href="#cb118-40" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> force_splits(features_to_include):</span>
<span id="cb118-41"><a href="#cb118-41" aria-hidden="true" tabindex="-1"></a>    <span class="kw">global</span> selected_features</span>
<span id="cb118-42"><a href="#cb118-42" aria-hidden="true" tabindex="-1"></a>    selected_features <span class="op">=</span> [f <span class="cf">for</span> f <span class="kw">in</span> features_to_include <span class="cf">if</span> f <span class="kw">in</span> X_encoded.columns]</span>
<span id="cb118-43"><a href="#cb118-43" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Forcing split using features: </span><span class="sc">{</span>selected_features<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb118-44"><a href="#cb118-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-45"><a href="#cb118-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Force decision tree to split first on GCSEye_4.0 and then HadSeiz_1</span></span>
<span id="cb118-46"><a href="#cb118-46" aria-hidden="true" tabindex="-1"></a>force_splits([<span class="st">'IndVomit_1'</span>, <span class="st">'HadSeiz_1'</span>])</span>
<span id="cb118-47"><a href="#cb118-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-48"><a href="#cb118-48" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="bu">len</span>(selected_features) <span class="op">&lt;</span> <span class="bu">len</span>(X_encoded.columns):</span>
<span id="cb118-49"><a href="#cb118-49" aria-hidden="true" tabindex="-1"></a>    best_feature <span class="op">=</span> <span class="va">None</span></span>
<span id="cb118-50"><a href="#cb118-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> feature <span class="kw">in</span> X_encoded.columns:</span>
<span id="cb118-51"><a href="#cb118-51" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> feature <span class="kw">in</span> selected_features:</span>
<span id="cb118-52"><a href="#cb118-52" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb118-53"><a href="#cb118-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-54"><a href="#cb118-54" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Try adding this feature</span></span>
<span id="cb118-55"><a href="#cb118-55" aria-hidden="true" tabindex="-1"></a>        current_features <span class="op">=</span> selected_features <span class="op">+</span> [feature]</span>
<span id="cb118-56"><a href="#cb118-56" aria-hidden="true" tabindex="-1"></a>        X_subset <span class="op">=</span> X_resampled[current_features]</span>
<span id="cb118-57"><a href="#cb118-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-58"><a href="#cb118-58" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Use Balanced Bagging to balance class distribution</span></span>
<span id="cb118-59"><a href="#cb118-59" aria-hidden="true" tabindex="-1"></a>        model <span class="op">=</span> BalancedBaggingClassifier(</span>
<span id="cb118-60"><a href="#cb118-60" aria-hidden="true" tabindex="-1"></a>            estimator<span class="op">=</span>DecisionTreeClassifier(random_state<span class="op">=</span><span class="dv">42</span>, max_depth<span class="op">=</span><span class="va">None</span>),</span>
<span id="cb118-61"><a href="#cb118-61" aria-hidden="true" tabindex="-1"></a>            sampling_strategy<span class="op">=</span><span class="fl">1.0</span>,</span>
<span id="cb118-62"><a href="#cb118-62" aria-hidden="true" tabindex="-1"></a>            random_state<span class="op">=</span><span class="dv">42</span>,</span>
<span id="cb118-63"><a href="#cb118-63" aria-hidden="true" tabindex="-1"></a>            n_estimators<span class="op">=</span><span class="dv">50</span>,</span>
<span id="cb118-64"><a href="#cb118-64" aria-hidden="true" tabindex="-1"></a>            n_jobs<span class="op">=-</span><span class="dv">1</span></span>
<span id="cb118-65"><a href="#cb118-65" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb118-66"><a href="#cb118-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-67"><a href="#cb118-67" aria-hidden="true" tabindex="-1"></a>        score <span class="op">=</span> np.mean(cross_val_score(model, X_subset, y_resampled, cv<span class="op">=</span><span class="dv">5</span>, scoring<span class="op">=</span><span class="st">'accuracy'</span>))</span>
<span id="cb118-68"><a href="#cb118-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-69"><a href="#cb118-69" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> score <span class="op">&gt;</span> best_score:</span>
<span id="cb118-70"><a href="#cb118-70" aria-hidden="true" tabindex="-1"></a>            best_score <span class="op">=</span> score</span>
<span id="cb118-71"><a href="#cb118-71" aria-hidden="true" tabindex="-1"></a>            best_feature <span class="op">=</span> feature</span>
<span id="cb118-72"><a href="#cb118-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-73"><a href="#cb118-73" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> best_feature <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb118-74"><a href="#cb118-74" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span>  <span class="co"># No improvement found</span></span>
<span id="cb118-75"><a href="#cb118-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-76"><a href="#cb118-76" aria-hidden="true" tabindex="-1"></a>    selected_features.append(best_feature)</span>
<span id="cb118-77"><a href="#cb118-77" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Added feature: </span><span class="sc">{</span>best_feature<span class="sc">}</span><span class="ss">, New score: </span><span class="sc">{</span>best_score<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb118-78"><a href="#cb118-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-79"><a href="#cb118-79" aria-hidden="true" tabindex="-1"></a><span class="co"># Train final balanced bagging model with selected features</span></span>
<span id="cb118-80"><a href="#cb118-80" aria-hidden="true" tabindex="-1"></a>final_model <span class="op">=</span> BalancedBaggingClassifier(</span>
<span id="cb118-81"><a href="#cb118-81" aria-hidden="true" tabindex="-1"></a>    estimator<span class="op">=</span>DecisionTreeClassifier(random_state<span class="op">=</span><span class="dv">42</span>, max_depth<span class="op">=</span><span class="va">None</span>),</span>
<span id="cb118-82"><a href="#cb118-82" aria-hidden="true" tabindex="-1"></a>    sampling_strategy<span class="op">=</span><span class="fl">1.0</span>,</span>
<span id="cb118-83"><a href="#cb118-83" aria-hidden="true" tabindex="-1"></a>    random_state<span class="op">=</span><span class="dv">42</span>,</span>
<span id="cb118-84"><a href="#cb118-84" aria-hidden="true" tabindex="-1"></a>    n_estimators<span class="op">=</span><span class="dv">50</span>,</span>
<span id="cb118-85"><a href="#cb118-85" aria-hidden="true" tabindex="-1"></a>    n_jobs<span class="op">=-</span><span class="dv">1</span></span>
<span id="cb118-86"><a href="#cb118-86" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb118-87"><a href="#cb118-87" aria-hidden="true" tabindex="-1"></a>final_model.fit(X_resampled[selected_features], y_resampled)</span>
<span id="cb118-88"><a href="#cb118-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-89"><a href="#cb118-89" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict on the training data</span></span>
<span id="cb118-90"><a href="#cb118-90" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> final_model.predict(X_resampled[selected_features])</span>
<span id="cb118-91"><a href="#cb118-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-92"><a href="#cb118-92" aria-hidden="true" tabindex="-1"></a><span class="co"># Count occurrences of 0s and 1s in the predicted labels</span></span>
<span id="cb118-93"><a href="#cb118-93" aria-hidden="true" tabindex="-1"></a>unique, counts <span class="op">=</span> np.unique(y_pred, return_counts<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb118-94"><a href="#cb118-94" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Final predicted class distribution:"</span>, <span class="bu">dict</span>(<span class="bu">zip</span>(unique, counts)))</span>
<span id="cb118-95"><a href="#cb118-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-96"><a href="#cb118-96" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Final selected feature order: </span><span class="sc">{</span>selected_features<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Balanced class distribution after undersampling: {'0.0': np.int64(766), '1.0': np.int64(766)}
Forcing split using features: []
Added feature: AMS_1.0, New score: 0.8290
Added feature: SFxBas_1.0, New score: 0.8401
Added feature: SFxPalp_1.0, New score: 0.8473
Added feature: SFxPalp_2.0, New score: 0.8519
Added feature: IndVomit_nan, New score: 0.8577
Added feature: ActNorm_nan, New score: 0.8623
Added feature: LocLen_4.0, New score: 0.8656
Added feature: HASeverity_nan, New score: 0.8669
Added feature: LOCSeparate_1.0, New score: 0.8688
Final predicted class distribution: {'0.0': np.int64(713), '1.0': np.int64(819)}
Final selected feature order: ['AMS_1.0', 'SFxBas_1.0', 'SFxPalp_1.0', 'SFxPalp_2.0', 'IndVomit_nan', 'ActNorm_nan', 'LocLen_4.0', 'HASeverity_nan', 'LOCSeparate_1.0']</code></pre>
</div>
</div>
<div id="d4fbbd4a" class="cell" data-execution_count="115">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make predictions</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> final_model.predict(X[selected_features])</span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute confusion matrix</span></span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>tn, fp, fn, tp <span class="op">=</span> confusion_matrix(y, y_pred).ravel()</span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute proportions</span></span>
<span id="cb120-8"><a href="#cb120-8" aria-hidden="true" tabindex="-1"></a>total_positives <span class="op">=</span> tp <span class="op">+</span> fn  <span class="co"># Actual Positives</span></span>
<span id="cb120-9"><a href="#cb120-9" aria-hidden="true" tabindex="-1"></a>total_negatives <span class="op">=</span> tn <span class="op">+</span> fp  <span class="co"># Actual Negatives</span></span>
<span id="cb120-10"><a href="#cb120-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-11"><a href="#cb120-11" aria-hidden="true" tabindex="-1"></a>sensitivity <span class="op">=</span> tp <span class="op">/</span> total_positives <span class="cf">if</span> total_positives <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span>  <span class="co"># True Positive Rate (TPR)</span></span>
<span id="cb120-12"><a href="#cb120-12" aria-hidden="true" tabindex="-1"></a>specificity <span class="op">=</span> tn <span class="op">/</span> total_negatives <span class="cf">if</span> total_negatives <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span>  <span class="co"># True Negative Rate (TNR)</span></span>
<span id="cb120-13"><a href="#cb120-13" aria-hidden="true" tabindex="-1"></a>false_positive_rate <span class="op">=</span> fp <span class="op">/</span> total_negatives <span class="cf">if</span> total_negatives <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span>  <span class="co"># FPR</span></span>
<span id="cb120-14"><a href="#cb120-14" aria-hidden="true" tabindex="-1"></a>false_negative_rate <span class="op">=</span> fn <span class="op">/</span> total_positives <span class="cf">if</span> total_positives <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span>  <span class="co"># FNR</span></span>
<span id="cb120-15"><a href="#cb120-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-16"><a href="#cb120-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Print results</span></span>
<span id="cb120-17"><a href="#cb120-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"True Positives (TP): </span><span class="sc">{</span>tp<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>sensitivity<span class="sc">:.4f}</span><span class="ss"> of actual positives)"</span>)</span>
<span id="cb120-18"><a href="#cb120-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"True Negatives (TN): </span><span class="sc">{</span>tn<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>specificity<span class="sc">:.4f}</span><span class="ss"> of actual negatives)"</span>)</span>
<span id="cb120-19"><a href="#cb120-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"False Positives (FP): </span><span class="sc">{</span>fp<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>false_positive_rate<span class="sc">:.4f}</span><span class="ss"> of actual negatives)"</span>)</span>
<span id="cb120-20"><a href="#cb120-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"False Negatives (FN): </span><span class="sc">{</span>fn<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>false_negative_rate<span class="sc">:.4f}</span><span class="ss"> of actual positives)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>True Positives (TP): 694 (0.9060 of actual positives)
True Negatives (TN): 35566 (0.8346 of actual negatives)
False Positives (FP): 7050 (0.1654 of actual negatives)
False Negatives (FN): 72 (0.0940 of actual positives)</code></pre>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>